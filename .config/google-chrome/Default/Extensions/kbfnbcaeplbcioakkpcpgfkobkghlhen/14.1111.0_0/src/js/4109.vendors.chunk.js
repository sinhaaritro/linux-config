(self.webpackChunk=self.webpackChunk||[]).push([[4109],{6782:(e,t,n)=>{n.d(t,{Q:()=>r});var r,o=n(40327),i=n(5114);!function(e){e.group=function(e){return Object.values(e.reduce(((e,{group:t,category:n,categoryHuman:r,cost:o})=>(void 0===e[n]&&(e[n]={group:t,category:n,categoryHuman:r,count:0,lensName:"",bundleInfo:i.none}),e[n].count+=o,e)),{})).sort(((e,t)=>t.count-e.count))},e.groupByGroup=function(e){return Object.values(e.reduce(((e,{group:t,category:n,categoryHuman:r,cost:o,lensName:u="",bundleInfo:a=i.none})=>(void 0===e[u]&&(e[u]={group:t,category:n,categoryHuman:r,count:0,lensName:u,bundleInfo:a}),e[u].count+=o,e)),{})).sort(((e,t)=>t.count-e.count))},e.groupByBundleInfo=function(e){return Object.values(e.reduce(((e,{group:t,category:n,categoryHuman:r,cost:u,lensName:a="",bundleInfo:s=i.none})=>{const c=(0,o.pipe)(s,i.getOrElse((()=>r)));return void 0===e[c]&&(e[c]={group:t,category:n,categoryHuman:r,count:0,lensName:a,bundleInfo:s}),e[c].count+=u,e}),{})).sort(((e,t)=>t.count-e.count))}}(r||(r={}))},31668:(e,t,n)=>{n.d(t,{Z:()=>o});var r=n(22232);var o=function(){function e(t,n){void 0===n&&(n=new URLSearchParams),this.base=t,this.params=n;var o=e._toString(t,n).length;(0,r.kG)(o<e.MAX_URL_LENGTH,"url exceeded length limit",String(o))}return e.prototype.addParams=function(t){var n,r=Object.entries(t).reduce((function(e,t){var n=t[0],r=t[1];return e.append(n,r),e}),(n=this.params,new URLSearchParams(n.toString())));return new e(this.base,r)},e.prototype.toString=function(){return e._toString(this.base,this.params)},e._toString=function(e,t){var n=t.toString();return"".concat(e).concat(n.length?"?".concat(n):"")},e.MAX_URL_LENGTH=2083,e}()},31903:(e,t,n)=>{n.d(t,{Q:()=>s});var r=n(57050),o=n(37492),i=n(51072),u=n(81531);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._capiSDUIClient=t,this._log=u.C8.Logging.getLogger("SDUIFeedbackServiceImpl")}var t,n,s;return t=e,(n=[{key:"sendUserAction",value:function(e,t){var n=this;(0,r.zG)(this._capiSDUIClient.sendUserAction(e,t),i.Vi,(function(e){return e.catch((function(e){o.EP.isDroppedError(e)?n._log.debug("Stopped listening for sendUserAction message acknowledge",e):o.YG.isNotConnectedError(e)?n._log.warn("Failed to sendUserAction as CAPI was not connected",e):n._log.error("Failed to sendUserAction",e)}))}))}}])&&a(t.prototype,n),s&&a(t,s),e}()},78929:(e,t,n)=>{n.d(t,{G:()=>W});var r,o,i,u=n(64015),a=n(17889),s=n(57050),c=n(38983),d=n(19429),f=n(81670),l=n(92843),m=n(93756),v=n(5114),p=n(95195),h=n(71249),I=n(55415),g=n(83078),y=n(22232),w=n(8125),S=n(81531),b=n(46680),A=n(21038),R=n(12054),_=n(64681);function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],u=!0,a=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);u=!0);}catch(e){a=!0,o=e}finally{try{u||null==n.return||n.return()}finally{if(a)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return U(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(o=r||(r={})).iso=function(){return _.k4()},o.empty=function(){return{sduiQueue:new Map}},o.removeAllBySduiId=function(e){return function(t){return(0,s.zG)(r.toQueueValuesArray(t),h.hX((function(t){return 0===t.id.indexOf("".concat(e.event.sduiRootId,"_"))})),(function(e){return r.removeItems(e)(t),e}))}},o.removeEarlierItemsBySduiId=function(e){return function(t){return(0,s.zG)(r.toQueueValuesArray(t),h.hX((function(t){return 0===t.id.indexOf("".concat(e.event.sduiRootId,"_"))&&t.order<e.order})),(function(e){return r.removeItems(e)(t),e}))}},o.addItem=function(e){return function(t){t.sduiQueue.set(e.id,e)}},o.removeItems=function(e){return function(t){e.forEach((function(e){return t.sduiQueue.delete(e.id)}))}},o.toQueueValuesArray=function(e){return Array.from(e.sduiQueue.values())},function(e){var t=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)};t.QueueCounter=0;e.show={show:function(e){return Array.from(r.iso().unwrap(e).sduiQueue.entries()).map((function(e){var t=E(e,2),n=t[0],r=t[1];return"".concat(n," - { id: ").concat(r.id," sduiRootId: ").concat(r.event.sduiRootId,", kind: ").concat(r.event.kind)})).join(";\n")}};!function(e){var n;(n=e.Id||(e.Id={})).from=function(e){return"".concat(e)};e.fromEvent=function(e){return{id:n.from("".concat(e.sduiRootId,"_").concat(++t.QueueCounter)),order:t.QueueCounter,event:e}}}(e.Item||(e.Item={}));e.empty=function(){return r.iso().wrap(r.empty())},e.removeAllBySduiId=function(e){return function(t){return(0,s.zG)(r.iso().unwrap(t),r.removeAllBySduiId(e))}},e.addItem=function(e){return function(t){return(0,s.zG)(r.iso().unwrap(t),r.addItem(e))}},e.removeItems=function(e){return function(t){return(0,s.zG)(r.iso().unwrap(t),r.removeItems(e))}},e.removeEarlierItemsBySduiId=function(e){return function(t){return(0,s.zG)(r.iso().unwrap(t),r.removeEarlierItemsBySduiId(e))}},e.toQueueValuesArray=function(e){return(0,s.zG)(r.iso().unwrap(e),r.toQueueValuesArray)}}(i||(i={}));var D=n(28811),k=n(31539),O=n(32952),C=n(9922),G=n(24209),F=n(77843),z=n(93508),M=n(77176),j=n(2834),T=n(67434),x=n(60797),P=n(36919),V=n(85985),Q=n(41398),B=n(24055),L=n(26393);function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){K(e,t,n[t])}))}return e}function H(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],u=!0,a=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);u=!0);}catch(e){a=!0,o=e}finally{try{u||null==n.return||n.return()}finally{if(a)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return N(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return N(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var $,J,W=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.alertIdResolver=n,this._state=c.h.create(k.l.empty),this.state=this._state.view((function(e){return k.l.iso.wrap(e)})),this._onAlertsRefEmpty=new O.xQ,this._removedAlerts=new O.xQ,this._removedRoot=new O.xQ,this._switchView=new O.xQ,this._sessionEvents=new O.xQ,this._reviseSduiQueue=new O.xQ,this._flush=new O.xQ,this._flushViewSwitch=new O.xQ,this._subs=new C.w.Keeper,this._log=S.C8.Logging.getLogger("SDUIManager",b.i.TRACE,b.T.Manager.getColor()),this.loadItems=function(e){return(0,s.zG)(e,u.UI((function(e){return X({},e,{invalid:!0})})),r._arrayToDiff,k.l.applyDiff,d.UI(f.T.recover((function(e){return r._log.error("conflicts on diff apply",e)}))),(function(e){return r._state.modify(e)}))},this._arrayToDiff=function(e){return l.v.fromMutation((function(t){return u.UI((function(e){t.set(e.id,m.F2(e))}))(e)}))},this.findFirstCardWithContent=function(e){return(0,s.zG)(r.state.get(),D.a.get(e),v.map((function(e){var t=e.content;return L.a.reduce(t,(function(e,t){return(0,s.zG)(e,p.g_((function(e){return"strongAlertRef"===t.type?p.t$(v.some(t)):"assistantCard"===t.type||"inlineCard"===t.type?p.F2({card:t,parentStrongAlertRef:e}):p.t$(e)}),(function(e){return p.F2(e)})))}),L.a.TreeTraversal.PreOrder,p.t$(v.none))})),v.chain(v.fromEither))},this.notifyAlertsChanged=function(){return r._reviseSduiQueue.next()},this.onSessionStarted=function(){return r._sessionEvents.next(J.Start)},this.onFirstCheckingFinished=function(){return r._sessionEvents.next(J.FirstCheckingFinished)},this._processEvents=function(e){return function(t,n){var o=r,u=(0,s.zG)(n,p.g_((function(n){return(0,s.zG)(i.toQueueValuesArray(t),h.hX(e))}),(function(n){if(n.kind===B.e.SduiEventKind.Remove){o._log.debug("[IN - ".concat(n.kind,", {id: ").concat(n.sduiRootId,"}] removeAllBySduiId"));var r=i.Item.fromEvent(n);return i.removeAllBySduiId(r)(t),[r]}var u=i.Item.fromEvent(n);return e(u)?(o._log.debug("[IN - ".concat(u.event.kind," {sduiRootId: ").concat(u.event.sduiRootId,", id: ").concat(u.id," refs: ").concat(JSON.stringify(L.a.getAlertIds(u.event.sdui)),"}, ] hasAllAlerts")),[u]):(i.addItem(u)(t),o._log.debug("[IN - ".concat(u.event.kind," {sduiRootId: ").concat(u.event.sduiRootId,", id: ").concat(u.id," refs: ").concat(JSON.stringify(L.a.getAlertIds(u.event.sdui)),"}] add to queue, [queue]: ").concat(i.show.show(t))),[])})),(function(e){return o._log.debug("[completeItems] ".concat(e.map((function(e){return e.id})).join(", "),", [queue]: ").concat(i.show.show(t))),i.removeItems(e)(t),e.forEach((function(e){return i.removeEarlierItemsBySduiId(e)(t)})),e}),h.UI(I.ei("event")));return X({},t,{completeEvents:u})}},this._getAllAlertsIdsFromEvent=function(e,t){return(0,s.ls)((function(e){return e.sdui}),r._getAlertsIdsFromDSL(e,t))},this._getAlertsIdsFromAlertRef=function(e,t){return function(n){return(0,s.zG)(n,L.a.getAlertIds,g.ew((function(){return t===$.Silent?{}:r._log.error("Provided SDUI dsl doesn't contain alertIds array. StrongAlertRef: ".concat(JSON.stringify({id:n.id,type:n.type,name:n.name,alertIds:n.alertIds})))})),v.chain(v.fromPredicate((function(e){return Array.isArray(e)}))),v.fold((function(){return[]}),s.yR),r._resolveAlertIds(e,t))}},this._getAlertsIdsFromDSL=function(e,t){return function(n){return(0,s.zG)(n,L.a.getAllAlertIds,(function(e){return Array.from(new Set(e))}),(function(e){return u.xb(e)?(r._log.trace("Provided SDUI dsl doesn't contain any alertIds references. DSL id: ".concat(n.id)),e):e}),r._resolveAlertIds(e,t))}},this._resolveAlertIds=function(e,t){return function(n){return(0,s.zG)(n,u.UI((function(n){return(0,s.zG)(A.j.AlertId.from(n),e,g.ew((function(){return t===$.Silent?{}:r._log.error("Alert with raw id ".concat(n,", can not be found. It was either deleted or was not added yet."))})))})),u.vP(v.option))}},this._hasAllAlerts=function(e,t){return(0,s.ls)(r._getAllAlertsIdsFromEvent(e,t),v.isSome)},this._toInternalDiff=function(e){var t=r;return function(n){var r=H(n,2),o=r[0],i=r[1],u=t,c=k.l.MutableInternalDiff.empty();return(0,s.zG)(o,a.u4(c,(function(t,n){var r=u;return n.kind===B.e.SduiEventKind.Remove?u._handleSDUIRemove(n,i,t):(0,s.zG)(u._getAllAlertsIdsFromEvent(e,$.Silent)(n),v.map(u._toSDUIItem(n)),v.fold((function(){return r._log.trace(Z.internalDiffParsingError([L.a.getAllAlertIds(n.sdui).join(", "),n.sduiRootId]))}),(function(e){var o=n.kind;switch(o){case B.e.SduiEventKind.Add:r._handleSDUIAdd(e,i,t);break;case B.e.SduiEventKind.Update:r._handleSDUIUpdate(e,i,t);break;default:(0,y.vE)(o)}})),(function(e){return t}))})))}},this._preserveViewStackForCAPIUpdates=function(e){return(0,s.zG)(e,a.UI((function(e){return e.kind!==B.e.SduiEventKind.Update||e.source!==R.i5.CAPI?e:R.R6.of(e.sduiRootId,e.source,e.rev)(v.fold((function(){return v.some(e.sdui)}),(0,s.ls)(L.a.toContentMap,(function(t){return(0,s.zG)(t,Object.values,h.DZ((function(e){var t=e.content;return"viewStack"===t.type?v.some({type:"switchView",where:t.id,selected:t.selected}):v.none})),(function(n){return L.a.bulkSwitchView(e.sdui,n,t)}))}),v.some)))})))},this._normalizeSDUIEvents=function(e){var t=H(e,2),n=t[0],o=t[1],i=r;return(0,s.zG)(n,u.DZ((function(e){return"sdui_lazy_update"!==e.kind?v.some(e):i._handleSDUILazyUpdate(e,o)})))},this._toSDUIItem=function(e){return function(t){return{id:A.j.Item.Id.from(e.sduiRootId),content:e.sdui,alertIds:t}}},this._emitDomainEvent=function(e){var t=r;r._log.debug("internalDiff",k.l.InternalDiff.show.show(e)),(0,s.zG)(e,k.l.createDiff,f.T.recover((function(e){return t._log.error("conflicts on diff creating",e)})),(function(e){return t._log.debug("SDUIItemsCollectionDiff",k.l.diffShow.show(e)),e}),k.l.applyDiff,d.UI(f.T.recover((function(e){return t._log.error("conflicts on diff apply",e)}))),(function(e){return t._state.modify(e)}))},this._debugLogState=function(e){return r._log.debug("[SDUIManagerState] (SDUIItemsCollection)","_latestChangeDiff: ".concat(k.l.diffShow.show(e.latestChangeDiff),",\n _entriesIds: ").concat(k.l.InternalDiff.showMapKeys.show(e.entries),"}"))},this._getBufferObs=function(){return{bufferObsForSDUIEvents:G.T(F.F(100).pipe(z.O(0)),r._flush),bufferObsForViewSwitchEvents:G.T(F.F(100).pipe(z.O(0)),r._flushViewSwitch)}};var o=t.pipe(M.U(R.al.fromSource(R.i5.CAPI))),_=this._getBufferObs(),U=_.bufferObsForSDUIEvents,E=_.bufferObsForViewSwitchEvents,N=(0,R.yU)(this._removedAlerts.asObservable(),this._removedRoot.asObservable(),this.state,this._switchView.asObservable(),this._resolveAlertIds(this.alertIdResolver,$.Silent),this._log,E),q=N.emptyAlertsRefReasonTuple,K=N.optimisticRemoveSDUIEvent,W=N.emptyStrongAlertRefUpdate,Y=N.viewStackUpdates,ee=G.T(o,K,W).pipe(j.b((function(e){return r._log.debug("Received SDUI event: ".concat(R.al.show.show(e)," from: ").concat(e.source))})),j.b((function(e){return e})),T.R((function(e,t){var n=t.source;switch(n){case R.i5.RemoveAlertsSDUIAction:case R.i5.RemoveRootSDUIAction:case R.i5.TextChange:return t.kind===B.e.SduiEventKind.Remove&&e.optRemovedSDUIRootIds.add(t.sduiRootId),X({},e,{event:v.some(t)});case R.i5.CAPI:return(0,s.zG)(t,v.fromPredicate((function(t){return e.optRemovedSDUIRootIds.has(t.sduiRootId)})),g.bw((function(t){return e.optRemovedSDUIRootIds.delete(t.sduiRootId)})),v.chain(v.fromPredicate((0,w.Kg)(R.G0,R.eQ))),v.fold((function(){return X({},e,{event:v.some(t)})}),(function(t){return t.kind===B.e.SduiEventKind.Remove?X({},e,{event:v.none}):X({},e,{event:v.some(X({},t,{kind:B.e.SduiEventKind.Add}))})})));case R.i5.SwitchView:return X({},e,{event:v.some(t)});default:(0,y.vE)(n)}}),{optRemovedSDUIRootIds:new Set,event:v.none}),M.U(I.ei("event")),x.oA,M.U(p.F2)),te=(0,s.ls)(I.ei("event"),this._hasAllAlerts(this.alertIdResolver,$.Silent)),ne=G.T(ee,this._reviseSduiQueue.pipe(M.U(p.t$))).pipe(T.R(this._processEvents(te),X({},i.empty(),{completeEvents:[]})),M.U(I.ei("completeEvents"))),re=G.T(ne,Y).pipe(P.f(U),M.U((function(e){return u.xH(e)})),V.h(u.Od)).pipe(M.U(this._preserveViewStackForCAPIUpdates),Q.M(this._state),M.U(this._normalizeSDUIEvents),V.h(u.Od)),oe=this._sessionEvents.pipe(V.h((function(e){return e===J.Start})),Q.M(this._state),M.U((function(e){var t=H(e,2);t[0];return t[1]})),V.h((function(e){return e.entries.size>0})),M.U(k.l.MutableInternalDiff.fromState((function(e,t){var n=X({},t,{invalid:!0});return A.j.Item.eq.equals(t,n)||e.updated.set(t.id,[t,n]),e})))),ie=this._sessionEvents.pipe(V.h((function(e){return e===J.FirstCheckingFinished})),Q.M(this._state),M.U((function(e){var t=H(e,2);t[0];return t[1]})),V.h((function(e){return e.entries.size>0})),M.U(k.l.MutableInternalDiff.fromState((function(e,t){var n;return null!==(n=t.invalid)&&void 0!==n&&n&&e.removed.set(t.id,t),e})))),ue=G.T(oe,ie);this._subs.push(this._state.pipe(j.b(this._debugLogState)).subscribe(),q.subscribe((function(e){var t=H(e,1)[0];return r._onAlertsRefEmpty.next(t)})),re.pipe(Q.M(this._state),M.U(this._toInternalDiff(this.alertIdResolver)),V.h((0,s.ff)(k.l.InternalDiff.isEmpty)),M.U(this._emitDomainEvent)).subscribe(),ue.subscribe(this._emitDomainEvent))}var t,n,r;return t=e,(n=[{key:"onAlertsRefEmpty",get:function(){return this._onAlertsRefEmpty.asObservable()}},{key:"pushRemovedRoot",value:function(e){this._removedRoot.next(e)}},{key:"pushRemovedAlerts",value:function(e){this._removedAlerts.next(e)}},{key:"pushSwitchView",value:function(e){this._switchView.next(e)}},{key:"flush",value:function(){this._flush.next(),this._flushViewSwitch.next(),this._flush.next()}},{key:"resolveStrongAlertRefAlerts",value:function(e){var t=this;return(0,s.zG)(this._getAlertsIdsFromAlertRef(this.alertIdResolver,$.Error)(e),g.ew((function(){return t._log.error("Alert ids from the provided component were not removed, because AlertIds for the provided DSL was not resolved. SDUI content ".concat(JSON.stringify({id:e.id,type:e.type,name:e.name,alertIds:e.alertIds})))})))}},{key:"_handleSDUIAdd",value:function(e,t,n){var r=this;(0,s.zG)(t,k.l.get(e.id),v.fold((function(){if((0,y.kG)(!n.updated.has(e.id),"SDUI item can not be in the diff.updated until it gets to the collection"+k.l.InternalDiff.show.show(n)+k.l.diffShow.show(k.l.diff(k.l.empty,t))),n.removed.has(e.id))return r._log.trace(Z.actionOnRemovedItem([e.id,"added"]));n.added.set(e.id,e)}),(function(o){if((0,y.kG)(!n.added.has(e.id),"SDUI item can not be in the diff.added when it is already in the collection"+k.l.InternalDiff.show.show(n)+k.l.diffShow.show(k.l.diff(k.l.empty,t))),n.removed.has(e.id))return r._log.trace(Z.actionOnRemovedItem([e.id,"added"]));n.updated.set(e.id,[o,e])})));var o=u.Eh(A.j.AlertId.eq);return(0,s.zG)(t,k.l.find((function(t){return!0===t.invalid&&o.equals(t.alertIds,e.alertIds)})),g.bw((function(e){n.removed.set(e.id,e)}))),n}},{key:"_handleSDUIUpdate",value:function(e,t,n){var r=this;return(0,s.zG)(t,k.l.get(e.id),v.fold((function(){return(0,y.kG)(!n.updated.has(e.id),"SDUI item can not be in the diff.updated until it gets to the collection"+k.l.InternalDiff.show.show(n)+k.l.diffShow.show(k.l.diff(k.l.empty,t))),n.removed.has(e.id)?r._log.trace(Z.actionOnRemovedItem([e.id,"updated"])):n.added.has(e.id)?(r._log.trace(Z.updateIdMissingFound([e.id])),void n.added.set(e.id,e)):r._log.error(Z.updateIdMissingNotFound([e.id]))}),(function(o){return(0,y.kG)(!n.added.has(e.id),"SDUI item can not be in the diff.added when it is already in the collection"+k.l.InternalDiff.show.show(n)+k.l.diffShow.show(k.l.diff(k.l.empty,t))),n.removed.has(e.id)?r._log.trace(Z.actionOnRemovedItem([e.id,"update"])):A.j.Item.eq.equals(o,e)?r._log.trace(Z.updateItemsAreEqual([e.id])):void n.updated.set(e.id,[o,e])}))),n}},{key:"_handleSDUIRemove",value:function(e,t,n){var r=this,o=A.j.Item.Id.from(e.sduiRootId);return(0,s.zG)(t,k.l.get(o),v.fold((function(){if((0,y.kG)(!n.updated.has(o),"SDUI item can not be in the diff.updated until it gets to the collection"+k.l.InternalDiff.show.show(n)+k.l.diffShow.show(k.l.diff(k.l.empty,t))),!n.added.has(o))return r._log.trace(Z.removeIdMissingNotFound([o]));r._log.trace(Z.removeIdMissingFound([o])),n.added.delete(o)}),(function(e){(0,y.kG)(!n.added.has(e.id),"SDUI item can not be in the diff.added when it is already in the collection"+k.l.InternalDiff.show.show(n)+k.l.diffShow.show(k.l.diff(k.l.empty,t))),n.updated.delete(o)?r._log.trace(Z.idRemovedFrom([o,"diff.updated"])):(0,s.Q1)(),n.removed.set(o,e)}))),n}},{key:"_handleSDUILazyUpdate",value:function(e,t){var n=this;return(0,s.zG)(t,k.l.get(e.sduiRootId),g.ew((function(){return n._log.trace("SDUI Item with sduiRootId ".concat(e.sduiRootId,"  was not found"))})),v.fold((function(){return e.toContent(v.none)}),(function(t){var r=t.content;return(0,s.zG)(e.toContent(v.some(r)),v.filter((function(e){return!L.a.eq.equals(e,r)})),g.ew((function(){return n._log.trace("SDUI Update event ".concat(JSON.stringify(e)," will be skipped, because the new DSL is the same as an old one"))})))})),v.map((function(t){return{kind:B.e.SduiEventKind.Update,sdui:t,sduiRootId:B.e.RawSduiItem.Id.create(e.sduiRootId),rev:e.rev,source:e.source}})))}},{key:"dispose",value:function(){this._subs.dispose()}}])&&q(t.prototype,n),r&&q(t,r),e}(),Z={removeIdMissingFound:function(e){var t=H(e,1)[0];return"[Remove] SDUI item with ID ".concat(t," was found in the added messages. Removing it.")},removeIdMissingNotFound:function(e){var t=H(e,1)[0];return"[Remove] It is not possible to remove SDUI item with ID ".concat(t,". It is missing from SDUIItemsCollectionInternal and diff.add, probably it was deleted earlier. Skipping the message")},idRemovedFrom:function(e){var t=H(e,2),n=t[0],r=t[1];return"[Remove] SDUI item with ID ".concat(n," is going to be removed. ").concat(r," contains the item with ID ").concat(n," too. Remove ").concat(n," from ").concat(r)},actionOnRemovedItem:function(e){var t=H(e,2),n=t[0],r=t[1];return"[".concat(r,"] It is not possible to ").concat(r," SDUI item with ID ").concat(n,". Because it was already removed. Skipping the ").concat(r,".")},viewStackUpdateIdMissing:function(e){var t=H(e,1)[0];return"[ViewStackUpdate] SDUI item with ID ".concat(t," was found. Skipping the update.")},updateIdMissingFound:function(e){var t=H(e,1)[0];return"[Update] SDUI item with ID ".concat(t," was found in added messages. Updating it in added messages")},updateIdMissingNotFound:function(e){var t=H(e,1)[0];return"[Update] It is not possible to update SDUI item with ID ".concat(t,". It is missing from SDUIItemsCollectionInternal and diff.added, probably it was deleted earlier. Skipping the message")},updateItemsAreEqual:function(e){var t=H(e,1)[0];return"[Update] Received sdui item (sduiId: ".concat(t,") is the same as in the state. Skipping the update message")},internalDiffMissingAlertsIds:function(){return"missing AlertIDs"},internalDiffParsingError:function(e){var t=H(e,2),n=t[0],r=t[1];return"toInternalDiff, either can not resolve ".concat(n," for ").concat(r," or id of the sdui item is missing . The item will be skipped")}};!function(e){e.Silent="Silent",e.Error="Error"}($||($={})),function(e){e.Start="Start",e.FirstCheckingFinished="FirstCheckingFinished"}(J||(J={}))},12054:(e,t,n)=>{n.d(t,{al:()=>B,R6:()=>q,i5:()=>N,yU:()=>Q,eQ:()=>X,G0:()=>K});var r,o,i,u,a,s,c=n(26393),d=n(17889),f=n(64015),l=n(32243),m=n(57050),v=n(5114),p=n(71249),h=n(92843),I=n(21038),g=n(28811),y=n(64681),w=n(22232),S=n(40330);function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],u=!0,a=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);u=!0);}catch(e){a=!0,o=e}finally{try{u||null==n.return||n.return()}finally{if(a)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}o=r||(r={}),(i=o.EmptyMessage||(o.EmptyMessage={})).fromItem=function(e){return e.alertIds,R(e,["alertIds"])},i.show={show:function(e){var t=e.sduiId,n=e.sduiRootId;return JSON.stringify({sduiId:t,sduiRootId:n})}},(o.EmptyItem||(o.EmptyItem={})).isRootItem=function(e){return e.sduiId===e.sduiRootId},function(e){e.fromSDUI=function(e){return function(n){return"strongAlertRef"===n.content.type?v.some({sduiRootId:n.id,sduiId:n.id,emptyStrongAlertRef:n.content,alertIds:new Set(n.alertIds)}):c.a.reduce(n.content,(function(r,o){return"strongAlertRef"!==o.type||v.isSome(r)?r:t(e)(o,n.id)}),c.a.TreeTraversal.PreOrder,v.none)}};var t=e.fromStrongAlertRef=function(e){return function(t,n){return(0,m.zG)(e(t.alertIds),v.map((function(e){return{sduiRootId:n,sduiId:I.j.Item.Id.from(t.id),emptyStrongAlertRef:t,alertIds:new Set(e)}})))}};e.fromStrongAlertRefBehavior=function(e){return function(t,n,r){return(0,m.zG)(e(t.alertIds),v.map((function(e){return{sduiRootId:r,sduiId:n,emptyStrongAlertRef:t,alertIds:new Set(e)}})))}},e.show={show:function(e){return"StrAlertRef.Item: { sduiId: ".concat(e.sduiId,", sduiRootId: ").concat(e.sduiRootId,", alertIds: [").concat(Array.from(e.alertIds.values()).join(", "),"]}")}}}(u=o.Item||(o.Item={})),function(e){e.iso=y.k4(),e.empty=function(){return{alertRefMapping:new Map}},e.size=function(e){return e.alertRefMapping.size},e.show={show:function(e){return Array.from(e.alertRefMapping.entries()).map((function(e){var t=_(e,2),n=t[0],r=t[1];return"".concat(n,": [\n").concat(r.map(u.show.show).join("\n"),"\n]")})).join("\n")}};var t=function(e){return function(t){return(0,m.zG)(t.alertRefMapping.get(e),v.fromNullable)}},n=(e.get=function(e){return function(n){return(0,m.zG)(t(e)(n),v.map(p.UI((function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){A(e,t,n[t])}))}return e}({},e,{alertIds:new Set(e.alertIds)})}))))}},e.updateWithRemovedAlerts=function(e){return function(n){return(0,m.zG)(e,f.tS((function(e){return(0,m.zG)(n,t(e),v.map(p.hX((function(t){return t.alertIds.delete(e)&&0===t.alertIds.size}))),v.fold((function(){return[]}),(function(t){return n.alertRefMapping.delete(e),t.map(r.EmptyMessage.fromItem)})))})))}},e.add=function(e,t){return function(r){(0,w.kG)(S.uZ.isStrongAlertRefComponent(e.emptyStrongAlertRef),"add can only be called on a root alert ref component"),c.a.forEach(e.emptyStrongAlertRef,(0,m.ls)(n(e.sduiRootId,t),p.UI(o(r))),c.a.TreeTraversal.PostOrder)}},function(e,t){return function(n){switch(n.type){case"alternativeChoice":case"alternativeSlider":case"box":case"block":case"button":case"count":case"alertsCount":case"icon":case"image":case"row":case"slider":case"text":case"column":case"scroll":case"assistantFeed":case"assistantCard":case"gButton":case"nativeToneInsightsModal":case"nativeLearnMoreModal":case"nativeSettingsModal":case"nativeFeedbackModal":case"nativeKeyTakeawaysAssistantCard":case"nativeProofitModal":case"viewStack":case"proofitButton":case"dropDownMenuButton":case"lensesSwitchPanel":case"clickableText":case"nativeExperimentalGBToneInsightsUpsellFooter":case"nativeGetStartedChecklistModal":case"nativeExperimentalGBConsistencyUpsellFooter":case"nativeSkillsModal":case"nativeSkillsList":case"nativeSkillsView":case"radioButtonsGroup":case"collapsedCard":case"nativeInlineCardContent":case"progressBar":case"horizontalRule":return[];case"longFormCard":return(0,m.zG)(n.behaviors,p.hX(S.NO.isStrongAlertRef),p.UI((function(r){return u.fromStrongAlertRefBehavior(t)(r,I.j.Item.Id.from(n.id),e)})),p.oA);case"strongAlertRef":return(0,m.zG)(u.fromStrongAlertRef(t)(n,e),v.map(p.of),v.getOrElse((function(){return[]})));case"inlineCard":return Array.isArray(n.behaviors)?(0,m.zG)(n.behaviors,p.hX((function(e){return"behavior:strongAlertRef"===e.type})),p.UI((function(r){return u.fromStrongAlertRefBehavior(t)(r,I.j.Item.Id.from(n.id),e)})),p.oA):[];case"list":return(0,m.zG)(n.items,p.UI((function(e){return e.behaviors})),p.hX((function(e){return void 0!==e})),p.xH,p.hX(S.NO.isStrongAlertRef),p.UI((function(r){return u.fromStrongAlertRefBehavior(t)(r,I.j.Item.Id.from(n.id),e)})),p.oA);default:if((0,c.V)(n))return[];(0,w.vE)(n)}}}),o=function(e){var t=i(e);return function(e){e.alertIds.forEach((function(n){return t(n,[e])}))}},i=function(e){return function(t,n){var r=e.alertRefMapping.get(t);e.alertRefMapping.set(t,null!=r?r.concat(n):n)}};e.remove=function(e){return function(n){return(0,m.zG)(Array.from(e.alertIds.keys()),p.u4(new Array,(function(r,o){return(0,m.zG)(n,t(o),v.map(p.hX((function(t){return t.sduiRootId!==e.sduiRootId}))),v.fold((function(){r.push("failed to remove SDUI by alertId ".concat(o,", alertRefMapping doesn't contain alertId ").concat(o))}),(function(e){return function(e){return function(t,n){0===n.length?e.alertRefMapping.delete(t):i(e)(t,n)}}(n)(o,e)}))),r})))}}}(a||(a={})),(s=o.Collection||(o.Collection={})).empty=function(){return a.iso.wrap(a.empty())},s.size=function(e){return(0,m.zG)(a.iso.unwrap(e),a.size)},s.show={show:function(e){return(0,m.zG)(a.iso.unwrap(e),a.show.show)}},s.get=function(e){return function(t){return(0,m.zG)(a.iso.unwrap(t),a.get(e))}},s.add=function(e,t){return function(n){return(0,m.zG)(a.iso.unwrap(n),a.add(e,t))}},s.remove=function(e){return function(t){return(0,m.zG)(a.iso.unwrap(e),a.remove(t))}},s.updateWithRemovedAlerts=function(e){return function(t){return(0,m.zG)(a.iso.unwrap(t),a.updateWithRemovedAlerts(e))}};var U=n(24055),E=n(41398),D=n(2834),k=n(77176),O=n(66310),C=n(12126),G=n(38194),F=n(85985),z=n(24209),M=n(36919),j=n(16118),T=n(67434);function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function V(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],u=!0,a=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);u=!0);}catch(e){a=!0,o=e}finally{try{u||null==n.return||n.return()}finally{if(a)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Q=function(e,t,n,o,i,u,a){var s=function(e,t,n){var o=function(e,o){return(0,m.zG)(r.Item.fromSDUI(t)(o),v.fold((function(){return n.trace("SDUI item ".concat(I.j.Item.show.show(o)," does not contain AlertRef, skipping it"))}),(function(n){return r.Collection.add(n,t)(e)})),(function(t){return e}))},i=function(e,o){return(0,m.zG)(r.Item.fromSDUI(t)(o),v.fold((function(){return["SDUI item ".concat(I.j.Item.show.show(o)," does not contain AlertRef, skipping it")]}),r.Collection.remove(e)),(function(e){return 0===e.length?n.trace("removeSDUIItemFromCollection: ".concat(I.j.Item.show.show(o))):e.forEach((function(e){return n.info(e)}))}),(function(t){return e}))},u=function(e,t,n){return(0,m.zG)(i(e,t),(function(e){return o(e,n)}))};return e.pipe(j.G(),k.U((function(e){var t=V(e,2),n=t[0],r=t[1];return g.a.diff(n,r)})),T.R((function(e,t){return(0,m.zG)(t,h.v.reduce(e,i,u,o))}),r.Collection.empty()))}(n,i,u),y=e.pipe(E.M(s),D.b((function(e){var t=V(e,1),n=V(t[0],2),r=n[0],o=n[1];u.trace("[Optimistic update] emptyAlertsRefReasonTuple > Removed alerts. Reason: ".concat(o,", removedAlertIds: [").concat(r.join(", "),"]"))})),k.U((function(e){var t=V(e,2),n=V(t[0],2),o=n[0],i=n[1],u=t[1];return[r.Collection.updateWithRemovedAlerts(o)(u),i]})),D.b((function(e){var t=V(e,2),n=t[0],o=t[1];return u.trace("[Optimistic update] emptyAlertsRefReasonTuple > Reason: ".concat(o," found emptyAlertsRef: [").concat(n.map(r.EmptyMessage.show.show).join(", "),"]"))})),O.w((function(e){var t=V(e,2),n=t[0],r=t[1];return(0,m.zG)(n,f.UI((function(e){return[e,r]})),(function(e){return C.D(e)}))})),G.B()),w=y.pipe(F.h((function(e){var t=V(e,1)[0];return r.EmptyItem.isRootItem(t)})),k.U((function(e){var t=V(e,2),n=t[0],r=t[1];return B.toRemovedEvent(r)(U.e.RawSduiItem.Id.create(n.sduiRootId))}))),S=t.pipe(k.U((function(e){var t=V(e,2),n=t[0],r=t[1];return B.toRemovedEvent(r)(U.e.RawSduiItem.Id.create(n))}))),b=z.T(w,S),A=y.pipe(F.h((function(e){var t=V(e,1)[0];return!r.EmptyItem.isRootItem(t)})),E.M(n),k.U((function(e){var t=V(e,2),n=V(t[0],2),r=n[0],o=n[1],i=t[1],u=U.e.RawSduiItem.Id.create(r.sduiRootId);return(0,m.zG)(g.a.get(I.j.Item.Id.from(r.sduiRootId))(i),v.chain((function(e){return c.a.removeStrongAlertRef(e.content)([r.emptyStrongAlertRef])})),v.fold((function(){return B.toRemovedEvent(o)(U.e.RawSduiItem.Id.create(r.sduiRootId))}),(function(e){return B.toUpdatedEvent(o)(e,u)})))})));return{emptyAlertsRefReasonTuple:y,optimisticRemoveSDUIEvent:b,emptyStrongAlertRefUpdate:A,viewStackUpdates:o.pipe(M.f(a),F.h(p.Od),k.U((0,m.ls)(d.vM((function(e){return e.sduiRootId})),l.AO,f.UI((function(e){var t=V(e,2),n=t[0],r=t[1];return q.of(n,N.SwitchView)(v.fold((function(){return v.none}),(function(e){return(0,m.zG)(c.a.bulkSwitchView(e,r.map((function(e){return{where:e.where,selected:e.selected,type:"switchView"}}))),v.some)})))})))))}};var B,L,N,q,K=function(e){return e.kind==U.e.SduiEventKind.Update},X=function(e){return e.kind==U.e.SduiEventKind.Remove};(L=B||(B={})).fromSource=function(e){return function(t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){P(e,t,n[t])}))}return e}({},t,{source:e})}},L.toRemovedEvent=function(e){return function(t){return{kind:U.e.SduiEventKind.Remove,sduiRootId:t,source:e,rev:0}}},L.toUpdatedEvent=function(e){return function(t,n){return{kind:U.e.SduiEventKind.Update,sdui:t,sduiRootId:n,source:e,rev:0}}},L.show={show:function(e){return"SduiRootId: ".concat(e.sduiRootId,", Kind: ").concat(e.kind,", Source: ").concat(e.source)}},function(e){e.CAPI="capi",e.TextChange="textChange",e.RemoveAlertsSDUIAction="removeAlerts",e.RemoveRootSDUIAction="removeRoot",e.SwitchView="switchView"}(N||(N={})),(q||(q={})).of=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return function(r){return{kind:"sdui_lazy_update",toContent:r,sduiRootId:I.j.Item.Id.from(e),rev:n,source:t}}}},24055:(e,t,n)=>{var r,o,i,u;n.d(t,{e:()=>r}),o=r||(r={}),((i=o.RawSduiItem||(o.RawSduiItem={})).Id||(i.Id={})).create=function(e){return e.toString()},function(e){e.Add="sdui_add",e.Remove="sdui_remove",e.Update="sdui_update"}(u=o.SduiEventKind||(o.SduiEventKind={})),o.isSduiEvent=function(e){return e.kind===u.Add||e.kind===u.Remove||e.kind===u.Update}},50588:(e,t,n)=>{n.d(t,{t:()=>a});var r=n(57050),o=n(40154);function i(e,t){return{decode:e.decode,encode:t.encode}}function u(e){return{decode:e.decode,encode:r.yR}}o.Z_,o.Rx,o.O7,o.dX,o.mI;var a,s,c,d,f,l,m=n(85384),v=n(73915),p=n(73975),h=n(95195),I=n(22232),g=n(15646),y=n(98992);s=a||(a={}),c=s.Type=g.lY.Type.sduiCardAction,d=v.n(m.z2)(y.eX),s.eq=p.f7((function(e,t){return e.type===c&&e.type===t.type&&e.cardId===t.cardId&&d.equals(e.actions,t.actions)&&e.scope===t.scope})),f=i(v.n(o.z2)(y.eX),{encode:function(e){return e}}),l=(0,r.ls)(f.decode,h.Vn((function(e){return new Error(o.ii(e))}))),s.isSduiCardAction=function(e){return e.type===a.Type&&(n=e.actions,h.tO(l(n)))&&"object"==typeof(t=e.scope)&&null!=t&&Object.keys(t).every((function(e){var n=t[e];return"alertRefs"===e?Array.isArray(n):((0,I.L0)(e),!1)}));var t,n}},72812:(e,t,n)=>{n.d(t,{X:()=>F,x:()=>G});var r=n(57050),o=n(5114),i=n(22232),u=n(83078),a=n(95195),s=n(64015),c=n(81531),d=n(46680),f=n(33678),l=n(50588),m=n(9922),v=n(32952),p=n(41398),h=n(85985),I=n(77176),g=n(60797),y=n(19751),w=n(2834),S=n(28811),b=n(21038),A=n(12054),R=n(31668),_=n(26393);function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){k(e,t,n[t])}))}return e}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],u=!0,a=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);u=!0);}catch(e){a=!0,o=e}finally{try{u||null==n.return||n.return()}finally{if(a)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return U(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var G=function(){function e(t,n,r,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new f.A;E(this,e),this._sduiService=t,this._sduiManager=n,this._sduiFeedManager=r,this._focusedItem=o,this._platformEnvironment=i,this._log=c.C8.Logging.getLogger("SduiViewModelImpl",d.i.DEBUG),this._subs=new m.w.Keeper,this.sduiActionEvents=new v.xQ,this._sduiAlertIdResolver=F(this._sduiManager.alertIdResolver,this._log),this._subs.push(this._handleSduiActions(),this._handleSduiCardOnFocus(),this._handleSduiFeedRemove(),this._handleSduiFeedEmpty(),this._handleSduiOnEmptyEvents())}var t,n,s;return t=e,(n=[{key:"onAssistantClose",value:function(){var e=this;(0,r.zG)(this._sduiFeedManager.currentFeed,o.map((function(e){return e.feedId})),o.chain((function(t){return S.a.get(t)(e._sduiManager.state.get())})),o.chain((function(e){return(0,r.zG)(_.a.findFirst(e.content,"assistantFeed"),o.filter((function(e){return Array.isArray(e.onAssistantClose)&&e.onAssistantClose.length>0})),o.map((function(t){return[t,e]})))})),o.map((function(t){var n=C(t,2),r=n[0],o=n[1];return e.sduiActionEvents.next({type:l.t.Type,sourceId:r.id,cardId:o.id,actions:r.onAssistantClose,scope:{alertRefs:o.alertIds}})})))}},{key:"_handleSduiOnEmptyEvents",value:function(){var e=this;return this._sduiManager.onAlertsRefEmpty.pipe(p.M(this._focusedItem),h.h((function(e){var t=C(e,2),n=t[0].sduiRootId,i=t[1];return(0,r.zG)(i,o.filter((function(e){return e===n})),o.isSome)})),I.U((function(e){return C(e,1)[0]}))).subscribe((function(t){var n=t.sduiId,r=t.sduiRootId,o=t.emptyStrongAlertRef;return e.sduiActionEvents.next({type:l.t.Type,sourceId:n,cardId:r,actions:o.onEmpty,scope:{alertRefs:o.alertIds}})}))}},{key:"_handleSduiFeedRemove",value:function(){var e=this;return this._sduiFeedManager.onFeedRemove.subscribe((function(t){(0,i.kG)("assistantFeed"===t.content.type),e.sduiActionEvents.next({type:l.t.Type,sourceId:t.id,cardId:t.id,actions:t.content.onRemove,scope:{alertRefs:[]}})}))}},{key:"_handleSduiFeedEmpty",value:function(){var e=this;return this._sduiFeedManager.onFeedEmpty.subscribe((function(t){(0,i.kG)("assistantFeed"===t.content.type),t.content.onEmpty&&e.sduiActionEvents.next({type:l.t.Type,sourceId:t.id,cardId:t.id,actions:t.content.onEmpty,scope:{alertRefs:[]}})}))}},{key:"_handleSduiCardOnFocus",value:function(){var e=this;return this._focusedItem.pipe(g.oA,I.U((function(t){return(0,r.zG)(e._sduiManager.findFirstCardWithContent(t),o.map((function(e){return[e,t]})))})),g.oA).subscribe((function(t){var n=C(t,2),i=n[0],u=i.card,a=i.parentStrongAlertRef,s=n[1];e._sduiFeedManager.notifyCardFocused(s),e.sduiActionEvents.next({type:l.t.Type,sourceId:u.id,cardId:s,actions:u.onFocus,scope:{alertRefs:(0,r.zG)(a,o.map((function(e){return e.alertIds})),o.getOrElse((function(){return[]})))}})}))}},{key:"_handleSduiActions",value:function(){var e=this;return this.sduiActionEvents.pipe(y.skipBy(l.t.eq),w.b((function(t){var n=t.cardId,o=t.sourceId,s=t.actions,c=t.scope,d=e;e._log.info("sdui card action:",{cardId:n,actions:s,scope:c}),s.forEach((function(e){switch(e.type){case"notify":return void d._sduiService.sendUserAction(o,e.userAction);case"removeRoot":var t=d;return void requestAnimationFrame((function(){t._sduiManager.pushRemovedRoot([b.j.Item.Id.from(n),A.i5.RemoveRootSDUIAction])}));case"applyAlerts":var s=d;return(0,r.zG)(d._sduiAlertIdResolver(c.alertRefs),u.bw((function(e){var t=s;requestAnimationFrame((function(){t._sduiManager.pushRemovedAlerts([e,A.i5.RemoveAlertsSDUIAction])}))})));case"closeCard":case"highlightAlert":case"nextCard":case"prevCard":case"openSettings":case"openToneDetector":case"openFeedback":case"upgradeToPremium":case"openLearnMore":case"transition":case"openCreateSnippetModal":case"nativeOpenAssistant":case"showHighlights":case"hideHighlights":case"stopApplyingAlerts":case"selectAlternative":case"copyToClipboard":case"newRevision":return;case"removeAlerts":var f=d;return void(0,r.zG)(d._sduiAlertIdResolver(c.alertRefs),u.bw((function(e){var t=f;requestAnimationFrame((function(){t._sduiManager.pushRemovedAlerts([e,A.i5.RemoveAlertsSDUIAction])}))})));case"openLink":return void d._platformEnvironment.actions.openPopup(new R.Z(e.url));case"pushAssistantFeed":var l=d;return void requestAnimationFrame((function(){return(0,r.zG)(l._sduiFeedManager.pushFeed(b.j.Item.Id.from(e.feedId),e.cardId),a.Vn((function(e){return l._log.error(e),e})))}));case"popAssistantFeed":var m=d;return void requestAnimationFrame((function(){return m._sduiFeedManager.popFeed()}));case"focusAssistantCard":var v=d;return void requestAnimationFrame((function(){return v._sduiFeedManager.focusCard(e.cardId)}));case"switchView":var p={where:e.where,selected:e.selected,sduiRootId:b.j.Item.Id.from(n)};return d._switchCallerCard(p),d._switchActiveCard(p),void d._switchActiveFeed(p);default:(0,i.L0)(e)}}))}))).subscribe()}},{key:"_switchCallerCard",value:function(e){this._sduiManager.pushSwitchView(e)}},{key:"_switchActiveCard",value:function(e){var t=this;(0,r.zG)(this._focusedItem.get(),o.filter((function(t){return e.sduiRootId!==t})),u.bw((function(n){return t._sduiManager.pushSwitchView(O({},e,{sduiRootId:b.j.Item.Id.from(n)}))})))}},{key:"_switchActiveFeed",value:function(e){var t=this;(0,r.zG)(this._sduiFeedManager.currentFeed,o.filter((function(t){return t.feedId!==e.sduiRootId})),u.bw((function(n){var r=n.feedId;return t._sduiManager.pushSwitchView(O({},e,{sduiRootId:r}))})))}},{key:"dispose",value:function(){this._subs.dispose()}}])&&D(t.prototype,n),s&&D(t,s),e}();function F(e,t){return function(n){return(0,r.zG)(n,s.UI(e),s.vP(o.option),u.ew((function(){return t.error("Could not resolve strong alert ref for ".concat(JSON.stringify(n)))})),o.filter(s.Od),u.ew((function(){return t.error("Strong alert refs are empty")})))}}}}]);
/*! For license information please see Grammarly-check.js.LICENSE.txt */
var e={97924:(e,t,n)=>{var r=n(40382),i="chrome-extension://__MSG_@@extension_id__/",s="moz-extension://__MSG_@@extension_id__/",o="safari-web-extension://__MSG_@@extension_id__/",a=self.GR_RESOURCE_ROOT||i,c=self.GR_RESOURCE_ROOT||s,u=self.GR_RESOURCE_ROOT||o;e.exports={__css:r.toString().replace(new RegExp(i,"g"),a).replace(new RegExp(s,"g"),c).replace(new RegExp(o,"g"),u),...r.locals}},40382:(e,t,n)=>{var r=n(54933),i=n(93476)(r);i.push([e.id,"._cWTM9-animatedUnderline{visibility:hidden;position:fixed;}._cWTM9-animatedUnderline:after{content:'';position:absolute;visibility:visible;height:3px;bottom:0;border-radius:10px;background:#488cc8;animation:_Axb1F-showUnderline 1.3s ease forwards}._cWTM9-animatedUnderline._qSuCO-completeAnimation:after{animation:_Axb1F-showUnderline .2s ease forwards}@keyframes _Axb1F-showUnderline{0%{width:0%}100%{width:100%}}._hoLGP-checkAnimatedUnderline{animation:_Axb1F-showUnderline 2s ease forwards;}._hoLGP-checkAnimatedUnderline._qSuCO-completeAnimation{animation:_Axb1F-showUnderline .2s ease forwards}",""]),i.locals={animatedUnderline:"_cWTM9-animatedUnderline",showUnderline:"_Axb1F-showUnderline",completeAnimation:"_qSuCO-completeAnimation",checkAnimatedUnderline:"_hoLGP-checkAnimatedUnderline"},e.exports=i},93476:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,i,s){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(o[c]=!0)}for(var u=0;u<e.length;u++){var l=[].concat(e[u]);r&&o[l[0]]||(void 0!==s&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=s),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),i&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=i):l[4]="".concat(i)),t.push(l))}},t}},54933:e=>{e.exports=function(e){return e[1]}},47598:e=>{e.exports={animatedUnderline:"ymqHP",showUnderline:"JQguZ",completeAnimation:"ExcM8"}},27061:e=>{var t,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var a,c=[],u=!1,l=-1;function d(){u&&a&&(u=!1,a.length?c=a.concat(c):l=-1,c.length&&h())}function h(){if(!u){var e=o(d);u=!0;for(var t=c.length;t;){for(a=c,c=[];++l<t;)a&&a[l].run();l=-1,t=c.length}a=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||u||o(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=f,r.addListener=f,r.once=f,r.off=f,r.removeListener=f,r.removeAllListeners=f,r.emit=f,r.prependListener=f,r.prependOnceListener=f,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={id:r,exports:{}};return e[r](s,s.exports,n),s.exports}(()=>{function e(e){const t=[];let n;for(;!(n=e.next()).done;)t.push(n.value);return t}function t(e,t){return Object.prototype.hasOwnProperty.call(t,e)}function r(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}const i=function(){const e=Object.prototype.toString;return"[object Arguments]"===e.call(arguments)?function(t){return"[object Arguments]"===e.call(t)}:function(e){return t("callee",e)}}(),s=function(){const e=!{toString:null}.propertyIsEnumerable("toString"),n=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],r=function(){return arguments.propertyIsEnumerable("length")}(),s=function(e,t){for(var n=0;n<e.length;){if(e[n]===t)return!0;n+=1}return!1};return"function"!=typeof Object.keys||r?function(o){if(Object(o)!==o)return[];let a,c;const u=[],l=r&&i(o);for(a in o)!t(a,o)||l&&"length"===a||(u[u.length]=a);if(e)for(c=n.length-1;c>=0;)a=n[c],t(a,o)&&!s(u,a)&&(u[u.length]=a),c-=1;return u}:function(e){return Object(e)!==e?[]:Object.keys(e)}}();function o(e){return null===e?"Null":void 0===e?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}function a(e){return new Promise((t=>setTimeout(t,e)))}function c(){let e,t;return{promise:new Promise(((n,r)=>{e=n,t=r})),resolve:e,reject:t}}function u(e){return new Promise(((t,n)=>{e.then(n,t)}))}class l extends Error{}function d(e){return new Promise(((t,n)=>setTimeout((()=>n(new l("Promise timed out."))),e)))}const h=function n(i,a,c=[],u=[]){if(r(i,a))return!0;if(o(i)!==o(a))return!1;if(null==i||null==a)return!1;if("function"==typeof i.equals||"function"==typeof a.equals)return"function"==typeof i.equals&&i.equals(a)&&"function"==typeof a.equals&&a.equals(i);switch(o(i)){case"Arguments":case"Array":case"Object":if("function"==typeof i.constructor&&"Promise"===function(e){const t=String(e).match(/^function (\w*)/);return null==t?"":t[1]}(i.constructor))return i===a;break;case"Boolean":case"Number":case"String":if(typeof i!=typeof a||!r(i.valueOf(),a.valueOf()))return!1;break;case"Date":if(!r(i.valueOf(),a.valueOf()))return!1;break;case"Error":return i.name===a.name&&i.message===a.message;case"RegExp":if(i.source!==a.source||i.global!==a.global||i.ignoreCase!==a.ignoreCase||i.multiline!==a.multiline||i.sticky!==a.sticky||i.unicode!==a.unicode)return!1;break;case"Map":case"Set":if(!n(e(i.entries()),e(a.entries()),c,u))return!1;break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}const l=s(i);if(l.length!==s(a).length)return!1;let d=c.length-1;for(;d>=0;){if(c[d]===i)return u[d]===a;d-=1}for(c.push(i),u.push(a),d=l.length-1;d>=0;){const e=l[d];if(!t(e,a)||!n(a[e],i[e],c,u))return!1;d-=1}return c.pop(),u.pop(),!0};function p(e,t){return e.some((e=>e===t))?t:void 0}class f extends Error{constructor(e){super(`Matching not exhaustive: unexpected value ${JSON.stringify(e)}`)}}function g(e){throw new f(e)}function m(e){if("string"==typeof e){const t=parseInt(e,10);return isNaN(t)?void 0:t}return"number"==typeof e?e:void 0}function b(e,t){try{return e()}catch(e){return t(e)}}function _(){}function v(e){let t,n=!1;return(...r)=>(n||(n=!0,t=e(...r)),t)}function y(e,t,n){const r=new Set;let i;return(...s)=>{const o=t(...s);return r.has(o)||(r.add(o),i=e(...s)),null==n||n(...s),i}}async function w(e,t,n){const r=n();if(!(e>0))return r;try{return await r}catch(r){return await a(t),w(e-1,t,n)}}var x;!function(e){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}e.create=function(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}}(x||(x={}));void 0!==self.requestIdleCallback&&self.requestIdleCallback;class E extends Error{constructor(e){super(`Assertion failed: ${e?"string"==typeof e?e:e():"(unnamed)"}`)}}function S(e,t){if(!e)throw new E(t)}function I(e,t){if(null==e)throw new E((()=>t?`Expected ${t} to be non-null`:"Expected non-null"));return e}var T,A,R,k,F,O,C,P,N;function M(e,t){return e.filter((e=>!!e)).join(t)}!function(e){const t={chromiumWebExtension:"chromeExt",firefoxWebExtension:"firefoxExt",safariAppExtension:"safariExt",safariWebExtension:"safariWebExt",safariIOSWebExtension:"safariIOSExt"};function n(e,n,r){return"retail"===r&&"safariIOSWebExtension"===n?"safariIOSExt-retail":"edge"===e?"chromiumEdgeExt":t[n]}e.getAppName=n,e.create=function(e,t,r,i){return{appName:I(n(e,t,r),"gnar app name"),url:`https://gnar.${i}`,domain:`.${i}`,sendEmailInfoTracking:!0,sendFluidExperimentData:!1}}}(T||(T={})),function(e){const t={chromiumWebExtension:"extensionChrome",firefoxWebExtension:"extensionFirefox",safariAppExtension:"extensionSafari",safariWebExtension:"extensionSafariWeb",safariIOSWebExtension:"extensionSafariIOS"};e.create=function(e,n,r,i){return{appName:"retail"===r&&"safariIOSWebExtension"===n?"extensionSafariIOS-retail":"edge"===e?"extensionEdge":I(t[n],"felog app name"),sendUsageMetrics:!0,sendPerfMetricsType:"dev"===i?"local":Math.random()<=.01?"send":"off"}}}(A||(A={})),function(e){const t={chromiumWebExtension:"extension_chrome",firefoxWebExtension:"extension_firefox",safariAppExtension:"extension_safari",safariWebExtension:"extension_safari_web",safariIOSWebExtension:"extension_safari_ios"},n={regular:"inline",retail:"retail_demo"};e.create=(e,r,i)=>({clientType:"edge"===e?"extension_chromium_edge":I(t[r],"capi client type"),clientSubType:I(n[i],"capi client subType")})}(R||(R={})),function(e){e.create=function(e){return{urls:{fetchMessages:`${e}/api/v1/messages`,acknowledgeMessage:`${e}/api/v1/messages/acknowledge`,dismissMessage:`${e}/api/v1/messages/dismiss`}}}}(k||(k={})),function(e){e.create=function(e){return{urls:{getInAppMessages:`${e}/api/inApp/getMessages`,track:`${e}/api/events/track`,trackInAppOpen:`${e}/api/events/trackInAppOpen`,trackInAppClose:`${e}/api/events/trackInAppClose`,trackInAppConsume:`${e}/api/events/inAppConsume`,trackInAppClick:`${e}/api/events/trackInAppClick`}}}}(F||(F={})),function(e){e.create=function(e){return{urls:{getJWTToken:`${e}/token`}}}}(O||(O={})),function(e){const t={chromiumWebExtension:"chromeExt",firefoxWebExtension:"firefoxExt",safariAppExtension:"safariExt",safariWebExtension:"safariWebExt",safariIOSWebExtension:"safariIOSExt"};e.create=function(e,n){return{xClientType:"edge"===e?"chromiumEdgeExt":t[n]}}}(C||(C={})),function(e){let t;var n;n=t=e.GrStaticUrl||(e.GrStaticUrl={}),n.toGrStaticUrl=e=>"https://assets.extension.grammarly.com/"+e}(P||(P={})),function(e){e.create=function(t,n,r,i,s){const o="safari"===t?"disableAppsPromotion=true":"";function a(e){const t=`https://${e}.${n}`;return(e="",n="")=>{const r=M([o,n],"&");return M([t+e,r],"?")}}const c=a("www"),u=a("app"),l=a("account"),d=a("redirect"),h=e.GrStaticUrl.toGrStaticUrl,p=`https://data.${n}`,f=`https://auth.${n}/v3`,g=`https://auth.${n}/v4`,m=`https://capi.${n}/api/configuration/cheetah/v1/settings`,b=`https://capi.${n}`;return{accountSubscription:l("/subscription"),accountSubscriptionAddBillingInfo:l("/admin/subscription","popup=add_billing_info"),adminAccountSubscription:l("/admin/subscription"),accountAdminSubscriptionAddBillingInfoToUngatedTrial:l("/admin/subscription","popup=ungated_trial"),app:u(),appPersonalDictionary:l("/customize"),capi:`wss://capi.${n}/freews`,capiStatic:`wss://capi.${n}/freews`,capiGDocs:`wss://capi.${n}/gdocs`,dapi:p,cheetahSettings:m,editorDictionary:u("/profile/dictionary"),dictionary:`https://capi.${n}/api/defs`,docs:u("/docs"),docsApi:`https://dox.${n}/documents`,newDoc:u("/docs/new"),tokens:`${g}/api`,auth:f,userOrAnonymous:`${f}/user/oranonymous`,signin:c("/signin"),signup:c("/signup"),fbSignin:c("/signin","fromExtensionFb=true"),fbSignup:c("/signup","fromExtensionFb=true"),googleSignin:c("/signin","fromExtensionGoogle=true"),googleSignup:c("/signup","fromExtensionGoogle=true"),resetPassword:c("/resetpassword"),newFelog:r,sumoLogic:i,vmetrics:s,welcomeC:c("/extension-success"),afterInstall:c("/after_install_page/"),upgrade:c("/upgrade"),planComparison:c("/plans"),businessHomepage:c("/business"),businessPricing:c("/business/pricing"),businessStyleGuide:c("/business/styleguide"),businessBrandTones:c("/business/brand-tones"),uninstall:c("/extension-uninstall"),terms:c("/terms"),policy:c("/privacy-policy"),californiaPolicy:c("/privacy-policy#for-california-users"),extensionSuccess:c("/extension-success"),firefoxPrivatePolicy:"https://addons.mozilla.org/en-US/firefox/addon/grammarly-1/privacy/",dynamicConfigUrl:"https://config.extension.grammarly.com/dynamicConfig.json",pageConfigUrl:"https://config.extension.grammarly.com/browserplugin/config.json",grammarlyDomain:n,grammarlyProtocol:"https:",redirect:d("/redirect"),snippetsApi:`https://goldengate.${n}/snippets/v1/snippets`,snippetsNew:l("/admin/snippets","action=create"),snippetsAdmin:l("/admin/snippets"),snippetsSettings:l("/customize/snippets"),clientControlsApi:`https://goldengate.${n}/client-controls`,readerMailApi:{summaries:`${b}/api/v2/reader/process`,annotations:`${b}/api/v2/reader/annotate`,eventsV1:`${b}/api/v3/reader/events`},freeEmailDomainsSortedList:h("reader/free-email-domains.json"),suggestionsSettings:l("/customize/suggestions"),allSettings:l(),styleGuideSettings:l("/admin/style-guide"),writingStyleSettings:l("/admin/style-guide-writing-style"),brandTones:l("/admin/brand-tones"),grammarlyIdeasSelf:u("/ideas/grow/self"),grammarlyIdeasPeer:u("/ideas/grow/peer"),grammarlyIdeasSales:u("/ideas/sales"),iOSApp:"grammarly://home",standWithUkraine:c("/stand-with-ukraine"),standWithUkraineBlockedUserPing:"https://rwsgfy.grammarly.com/stand-with-ukraine",tourGdocs:c("/tour-gdocs"),assets:{assistantOnboardingTourGif:h("assets/assistant/assistant-onboarding-tour"),ownerActivationIPMHeader:h("assets/ipm/owner-activation-ipm-header"),graduationIpmSvg:h("assets/ipm/graduation-campaign-ipm"),writingProgressIpmGif:h("assets/ipm/writing-progress-ipm-header"),onboardingTour:{inlineSuggestionsPreviewImage:h("assets/onboarding/inline-suggestions-preview-image.jpg"),inlineSuggestionsAnimation:h("assets/onboarding/inline-suggestions.mp4"),clickToAcceptAnimation:h("assets/onboarding/click-to-accept.mp4"),happyWritingAnimation:h("assets/onboarding/happy-writing.mp4")},knowledgeHubOnboardingTour:{step1:h("assets/knowledgeHubOnboarding/kh-onboarding-step1.mp4"),step2:h("assets/knowledgeHubOnboarding/kh-onboarding-step2.mp4"),step3:h("assets/knowledgeHubOnboarding/kh-onboarding-step3.mp4")}},support:`https://support.${n}/hc/en-us/requests/new#/`}}}(P||(P={})),function(e){const t="grammarly.com",n="qagr.io",r="ppgr.io";e.create=function(e,i,s,o){const a=(e,t,n,r,i)=>"prod"===o?e:"qa"===o?t:"dev-qa"===o?n:"dev-preprod"===o?r:"dev"===o?i:void g(o),c="https://127.0.0.1:8000",u=a("https://f-log-extension.grammarly.io",c,c,c,c),l=a("https://endpoint2.collection.us2.sumologic.com/receiver/v1/http/ZaVnC4dhaV1OF-4ic11yqpre0casnyvs_ZoaCHciEYdRyBkrfwP6DMlsWt8tSVU76RPqgGvAGjXGQk_UNuxPx-pYbToJapM_Fr0CUcgKaA8_IVl-lhSr5Q==",c,c,c,c),d=a("https://femetrics.grammarly.io/batch/import","https://femetrics.qagr.io/batch/import","https://femetrics.qagr.io/batch/import","https://femetrics.ppgr.io/batch/import","https://femetrics.qagr.io/batch/import"),h=a(t,n,n,r,n),p=a(t,n,n,r,t),f=a("https://chipmunk.grammarly.com","https://chipmunk.qagr.io","https://chipmunk.qagr.io","https://chipmunk.ppgr.io","https://chipmunk.qagr.io");return{url:P.create(e,p,u,l,d),gnar:T.create(e,i,s,h),felog:A.create(e,i,s,o),capi:R.create(e,i,s),chipmunk:k.create("https://chipmunk.grammarly.com"),iterable:F.create("https://api.iterable.com"),mise:O.create(f),auth:C.create(e,i),extensionId:"87677a2c52b84ad3a151a4a72f5bd3c4"}}}(N||(N={}));const L=b((()=>browser),(()=>self.browser)),U=b((()=>browser),(()=>self.browser));self.chrome=self.chrome;var j,D,B,H,$,W,V,G,q,z,K;!function(e){e.create=function(e,t,n,r,i,s,o,a){const c=void 0!==s&&void 0!==o?s:"UNVERSIONED",u=`${e}.${t}.${n}`;return{version:u,fullVersion:`${u}-${[r,["prod"!==i?i:null,c!==r?c:null].filter((e=>!!e)).join(".")].filter((e=>""!==e)).join("/")}`,commitHash:o,gitBranch:s,manifestVersion:a}},e.getManifestVersion=function(e,t,n){switch(e){case"safariAppExtension":switch(t){case"bg":case"popup":return n.safari.extension.displayVersion;default:return}case"chromiumWebExtension":return n.chrome.runtime.getManifest().version;case"firefoxWebExtension":return L.runtime.getManifest().version;case"safariWebExtension":case"safariIOSWebExtension":return U.runtime.getManifest().version;default:return g(e)}}}(j||(j={})),function(e){e.create=function(e){return p(["chrome","safari","firefox","edge"],e)},e.isValidTargetBrowser=function(e){return["chrome","safari","firefox","edge"].includes(e)},e.detect=function(e){return e.chrome&&/google/i.test(e.navigator.vendor)?e.navigator.userAgent.indexOf("Edg")>-1?"edge":"chrome":-1!==e.navigator.userAgent.indexOf("Firefox")?"firefox":/^((?!chrome).)*safari/i.test(e.navigator.userAgent)?"safari":void 0}}(D||(D={})),function(e){e.create=function(e){return p(["dev","prod","qa","dev-qa","dev-preprod"],e)}}(B||(B={})),function(e){e.create=function(e){return p(["regular","retail"],e)}}(H||(H={})),function(e){e.create=function(e){return p(["chromiumWebExtension","firefoxWebExtension","safariAppExtension","safariWebExtension","safariIOSWebExtension"],e)}}($||($={})),function(e){e.create=function(e,t,n,r,i){return{browser:e,extensionType:t,deploymentType:n,env:r,context:i}}}(W||(W={})),function(e){e.create=function(e){return{type:D.detect(e)||"other"}}}(V||(V={})),function(e){e.create=function(e){return{isWindows:-1!==e.navigator.appVersion.indexOf("Win"),isMac:-1!==e.navigator.appVersion.indexOf("Mac"),isChromeOS:-1!==e.navigator.appVersion.indexOf("CrOS")}}}(G||(G={})),function(e){e.create=function(e){return{browser:V.create(e),os:G.create(e)}}}(q||(q={})),function(e){function t(e,t,n,r,i,s,o){return{env:e,major_number:t,build_number:n,release_number:r,git_branch:i,git_commit:s,manifest_version:o}}e.create=t,e.fromBrowserify=function(){return t("prod","14","1111","0","UNVERSIONED","UNVERSIONED","3")}}(z||(z={})),function(e){e.getTargetEnv=function(e){if(!e.env)throw new Error("processEnv.env is null or undefined");const t=B.create(e.env);if(!t)throw new Error(`Invalid processEnv.env: ${e.env}`);return t},e.create=function(e,t,n,r,i,s){const o=[i.major_number,i.build_number,i.release_number].map(m);let a;if(3===o.length&&o.every((e=>void 0!==e)))a=o;else{let e;try{e=j.getManifestVersion(t,r,self)}catch(e){}const n=(e||"").split(".").map(m);a=3===n.length&&n.every((e=>void 0!==e))?n:[0,0,0]}const[c,u,l]=a;return{buildInfo:j.create(c,u,l,e,s,i.git_branch,i.git_commit,i.manifest_version),bundleInfo:W.create(e,t,n,s,r),appConfig:N.create(e,t,n,s),systemInfo:q.create(self)}}}(K||(K={}));const J=new class{constructor(e){this._getFallbackValue=e}init(e){if(void 0!==this._value)throw new Error("Global value already initialized.");this._value=e}get(){if(void 0===this._value){if(void 0===this._getFallbackValue)throw new Error("Global value not initialized and no fallback value provided.");this._value=this._getFallbackValue()}return this._value}}((()=>{throw new Error("Global config not initialized")}));let Y=()=>J.get();function X(){return Y()}function Q(){return X().appConfig.extensionId}function Z(){return"edge"===X().bundleInfo.browser}function ee(){return X().bundleInfo.browser}function te(){return X().bundleInfo.env}function ne(){try{return self.parent!==self}catch(e){return!0}}const re=1e3,ie=36e5,se=24*ie;function oe(e){return e*se}function ae(e){return e*re}class ce{constructor(e){if(this.capacity=e,this._start=0,this._end=0,this._isFull=!1,e<=0)throw new Error("Invalid capacity "+e);this._buffer=new Array(e)}get size(){return this._isFull?this._buffer.length:(this._end-this._start+this._buffer.length)%this._buffer.length}get isEmpty(){return 0===this.size}get isFull(){return this._isFull}get head(){return this.isEmpty?null:this._buffer[this._start]}get tail(){return this.isEmpty?null:this._buffer[0===this._end?this.capacity-1:this._end-1]}enqueue(e){let t=null;return this.isFull&&(t=this._buffer[this._start],this._startInc()),this._buffer[this._end]=e,this._endInc(),this._start===this._end&&(this._isFull=!0),t}dequeue(){if(this.isEmpty)return null;const e=this._buffer[this._start];return this._buffer[this._start]=null,this._startInc(),this._isFull=!1,e}delete(e){const t=this._buffer.indexOf(e);if(t>=0){if(t<this._end){for(let e=t;e<this._end-1;e++)this._buffer[e]=this._buffer[e+1];this._buffer[--this._end]=null}else{for(let e=this._start;e<t;e++)this._buffer[e+1]=this._buffer[e];this._buffer[this._start]=null,this._startInc()}return this._isFull=!1,!0}return!1}_startInc(){this._start++,this._start===this.capacity&&(this._start=0)}_endInc(){this._end++,this._end===this.capacity&&(this._end=0)}clear(){this._buffer=new Array(this.capacity),this._start=this._end=0,this._isFull=!1}toArray(){let e;if(this.isEmpty)e=[];else if(this._start<this._end)e=this._buffer.slice(this._start,this._end);else{e=new Array(this.size);let t=0;for(let n=this._start;n<this.capacity;++n,++t)e[t]=this._buffer[n];for(let n=0;n<this._end;++n,++t)e[t]=this._buffer[n]}return e}}function ue(e,t){const n={};return Object.keys(t).forEach((r=>{e(r,t[r])&&(n[r]=t[r])})),n}const le=e=>e===Object(e)&&!Array.isArray(e);var de;!function(e){function t(e){return{message:e.message,stack:e.stack}}e.normalizeExeption=t,e.normalizeData=function e(n){try{return self.HTMLElement&&n instanceof self.HTMLElement?{type:(r=n).nodeName,html:r.outerHTML,attributes:Array.from(r.attributes).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{})}:n instanceof Error?t(n):Array.isArray(n)?n.map((t=>e(t))):le(n)?Object.keys(n).reduce(((t,r)=>({...t,[r]:e(n[r])})),{}):n}catch(e){return Xt.create("HistoryLogNormalizer").error("cannot normalize data",e,n),n}var r}}(de||(de={}));const he="common",pe=ae(5);function fe(e){return e===he?"common.":""}class ge{constructor(e){var t;this._historyArgs=e,this._historyBuffers={},this.isHistoryEnabled=()=>{var e;return Boolean("prod"!==te()||(null===(e=this._historyArgs.enabledInProd)||void 0===e?void 0:e.get()))},this.isAdvancedHistoryEnabled=()=>{var e,t;return Boolean("prod"!==te()||(null===(e=this._historyArgs.enabledInProd)||void 0===e?void 0:e.get())&&(null===(t=this._historyArgs.enableAdvancedInProd)||void 0===t?void 0:t.get()))},this.getLogs=()=>Object.entries(this._historyBuffers).map((([e,t])=>t.toArray().map((t=>({...t,data:de.normalizeData(t.data),loggerName:fe(e)+t.loggerName,exception:t.exception?de.normalizeExeption(t.exception):void 0}))))).flat(),this._initCliCommands(),this._historyBuffers.common=new ce(null!==(t=this._historyArgs.maxEventsToStore)&&void 0!==t?t:1e3)}_getBuffer(e){return e?(this._historyBuffers[e.name]||(this._historyBuffers[e.name]=new ce(e.settings.limit)),this._historyBuffers[e.name]):this._historyBuffers.common}pushLog(e,t){this._getBuffer(e).enqueue(t)}_initCliCommands(){self.GRIsDebugEnabled=()=>this.isHistoryEnabled(),self.GREnableHistoryLogger=(e=60)=>{var t,n;null===(n=(t=this._historyArgs).enableHistoryLoggerUntil)||void 0===n||n.call(t,Date.now()+60*e*1e3)},self.GRDisableHistoryLogger=()=>{var e,t;null===(t=(e=this._historyArgs).disableHistoryLogger)||void 0===t||t.call(e)}}static create(e){return e.isBG?new me(e):new be(e)}}class me extends ge{constructor(e){var t;super(e),this._historyArgs=e,this._setToBgSessionStorage=function(e,t){let n;return(...r)=>{null!==n&&clearTimeout(n),n=setTimeout((()=>{n=null,e(r)}),t)}}((()=>{var e;null===(e=this._historyArgs.bgSessionStorage)||void 0===e||e.set({bgHistoryDefaultLogs:this._getBuffer(null).toArray().slice(-100)})}),pe),null===(t=this._historyArgs.bgSessionStorage)||void 0===t||t.get("bgHistoryDefaultLogs").then((e=>{const t=e.bgHistoryDefaultLogs;if(!t)return;const n=this._getBuffer(null),r=n.toArray();n.clear(),t.forEach((e=>n.enqueue(e))),r.forEach((e=>n.enqueue(e))),this._setToBgSessionStorage()}))}pushLog(e,t){super.pushLog(e,t),this._setToBgSessionStorage()}}class be extends ge{}var _e;!function(e){e.TRACE="TRACE",e.DEBUG="DEBUG",e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR",e.FATAL="FATAL"}(_e||(_e={}));const ve={[_e.TRACE]:1,[_e.DEBUG]:2,[_e.INFO]:3,[_e.WARN]:4,[_e.ERROR]:5,[_e.FATAL]:6};function ye(e){return ve[e]||0}class we{constructor(e){this.name=e,this._isError=e=>{const t=e;return t&&(void 0!==t.message&&void 0!==t.name||void 0!==t.stack)}}trace(e,t,n){this._logMessage(_e.TRACE,e,t,n)}debug(e,t,n){this._logMessage(_e.DEBUG,e,t,n)}info(e,t,n){this._logMessage(_e.INFO,e,t,n)}warn(e,t,n){this._logMessage(_e.WARN,e,t,n)}error(e,t,n){this._logMessage(_e.ERROR,e,t,n)}fatal(e,t,n){this._logMessage(_e.FATAL,e,t,n)}_logMessage(e,t,n,r){const i={level:e,loggerName:this.name,message:t,timestamp:Date.now()};n&&(this._isError(n)?i.exception=n:i.data=n),i.data=i.data||r,this.handleEvent(i)}}class xe{constructor(e,t){this.name=e,this._createLogger=t}trace(e,t,n){void 0===this._logger&&(this._logger=this._createLogger(this.name)),this._logger.trace(e,t,n)}debug(e,t,n){void 0===this._logger&&(this._logger=this._createLogger(this.name)),this._logger.debug(e,t,n)}info(e,t,n){void 0===this._logger&&(this._logger=this._createLogger(this.name)),this._logger.info(e,t,n)}warn(e,t,n){void 0===this._logger&&(this._logger=this._createLogger(this.name)),this._logger.warn(e,t,n)}error(e,t,n){void 0===this._logger&&(this._logger=this._createLogger(this.name)),this._logger.error(e,t,n)}fatal(e,t,n){void 0===this._logger&&(this._logger=this._createLogger(this.name)),this._logger.fatal(e,t,n)}isHistoryEnabled(){return!1}isAdvancedHistoryEnabled(){return!1}}class Ee extends we{constructor(e,t,n,r){super(e),this._config=t,this._historyLogsService=n,this._historyBufferSettings=r,this._buffer=this._historyBufferSettings?{name:this.name,settings:this._historyBufferSettings}:null}handleEvent(e){this._config.filterFn(e)&&this._config.writer.write(e),this._historyLogsService.isHistoryEnabled()&&this._historyLogsService.pushLog(this._buffer,e)}isHistoryEnabled(){return this._historyLogsService.isHistoryEnabled()}isAdvancedHistoryEnabled(){return this._historyLogsService.isAdvancedHistoryEnabled()}}function Se(e){return new Proxy({},{get(t,n){const r=e[n];return r&&"function"==typeof r?r.bind(e):void 0}})}class Ie{constructor(){this._writeFunc=Ie._commonWriteFunc}write(e){try{const t=[`grm ${e.level} 【${e.loggerName}】░░ ${e.message}`];e.data&&t.push(e.data),e.exception&&t.push(e.exception),this._writeFunc[e.level].apply(null,t)}catch(e){}}}Ie._commonWriteFunc=function(){const{log:e,info:t,warn:n,error:r}=Se(console);return{[_e.TRACE]:e,[_e.DEBUG]:e,[_e.INFO]:t,[_e.WARN]:n,[_e.ERROR]:r,[_e.FATAL]:r}}();var Te=function(e,t){return Te=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Te(e,t)};function Ae(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Te(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}Object.create;Object.create;function Re(e){return"function"==typeof e}var ke=!1,Fe={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack;ke=e},get useDeprecatedSynchronousErrorHandling(){return ke}};function Oe(e){setTimeout((function(){throw e}),0)}var Ce={closed:!0,next:function(e){},error:function(e){if(Fe.useDeprecatedSynchronousErrorHandling)throw e;Oe(e)},complete:function(){}},Pe=function(){return Array.isArray||function(e){return e&&"number"==typeof e.length}}();function Ne(e){return null!==e&&"object"==typeof e}var Me=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),Le=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this,r=n._parentOrParents,i=n._ctorUnsubscribe,s=n._unsubscribe,o=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof e)r.remove(this);else if(null!==r)for(var a=0;a<r.length;++a){r[a].remove(this)}if(Re(s)){i&&(this._unsubscribe=void 0);try{s.call(this)}catch(e){t=e instanceof Me?Ue(e.errors):[e]}}if(Pe(o)){a=-1;for(var c=o.length;++a<c;){var u=o[a];if(Ne(u))try{u.unsubscribe()}catch(e){t=t||[],e instanceof Me?t=t.concat(Ue(e.errors)):t.push(e)}}}if(t)throw new Me(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof e){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}var s=this._subscriptions;return null===s?this._subscriptions=[n]:s.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();function Ue(e){return e.reduce((function(e,t){return e.concat(t instanceof Me?t.errors:t)}),[])}var je=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),De=function(e){function t(n,r,i){var s=e.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=Ce;break;case 1:if(!n){s.destination=Ce;break}if("object"==typeof n){n instanceof t?(s.syncErrorThrowable=n.syncErrorThrowable,s.destination=n,n.add(s)):(s.syncErrorThrowable=!0,s.destination=new Be(s,n));break}default:s.syncErrorThrowable=!0,s.destination=new Be(s,n,r,i)}return s}return Ae(t,e),t.prototype[je]=function(){return this},t.create=function(e,n,r){var i=new t(e,n,r);return i.syncErrorThrowable=!1,i},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(Le),Be=function(e){function t(t,n,r,i){var s,o=e.call(this)||this;o._parentSubscriber=t;var a=o;return Re(n)?s=n:n&&(s=n.next,r=n.error,i=n.complete,n!==Ce&&(Re((a=Object.create(n)).unsubscribe)&&o.add(a.unsubscribe.bind(a)),a.unsubscribe=o.unsubscribe.bind(o))),o._context=a,o._next=s,o._error=r,o._complete=i,o}return Ae(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;Fe.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=Fe.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):Oe(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;Oe(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};Fe.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),Fe.useDeprecatedSynchronousErrorHandling)throw e;Oe(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!Fe.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return Fe.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(Oe(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(De);var He=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function $e(e){return e}function We(e){return 0===e.length?$e:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var Ve=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,i=function(e,t,n){if(e){if(e instanceof De)return e;if(e[je])return e[je]()}return e||t||n?new De(e,t,n):new De(Ce)}(e,t,n);if(r?i.add(r.call(i,this.source)):i.add(this.source||Fe.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),Fe.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){Fe.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),!function(e){for(;e;){var t=e,n=t.closed,r=t.destination,i=t.isStopped;if(n||i)return!1;e=r&&r instanceof De?r:null}return!0}(e)?console.warn(t):e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Ge(t))((function(t,r){var i;i=n.subscribe((function(t){try{e(t)}catch(e){r(e),i&&i.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[He]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:We(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Ge(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function Ge(e){if(e||(e=Fe.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var qe=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),ze=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return Ae(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(Le),Ke=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return Ae(t,e),t}(De),Je=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return Ae(t,e),t.prototype[je]=function(){return new Ke(this)},t.prototype.lift=function(e){var t=new Ye(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new qe;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].next(e)},t.prototype.error=function(e){if(this.closed)throw new qe;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new qe;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new qe;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new qe;return this.hasError?(e.error(this.thrownError),Le.EMPTY):this.isStopped?(e.complete(),Le.EMPTY):(this.observers.push(e),new ze(this,e))},t.prototype.asObservable=function(){var e=new Ve;return e.source=this,e},t.create=function(e,t){return new Ye(e,t)},t}(Ve),Ye=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return Ae(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):Le.EMPTY},t}(Je),Xe=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return Ae(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new qe;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Je);function Qe(){}var Ze=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new et(e,this.nextOrObserver,this.error,this.complete))},e}(),et=function(e){function t(t,n,r,i){var s=e.call(this,t)||this;return s._tapNext=Qe,s._tapError=Qe,s._tapComplete=Qe,s._tapError=r||Qe,s._tapComplete=i||Qe,Re(n)?(s._context=s,s._tapNext=n):n&&(s._context=n,s._tapNext=n.next||Qe,s._tapError=n.error||Qe,s._tapComplete=n.complete||Qe),s}return Ae(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(De);function tt(){return function(e){return e.lift(new nt(e))}}var nt=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;n._refCount++;var r=new rt(e,n),i=t.subscribe(r);return r.closed||(r.connection=n.connect()),i},e}(),rt=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return Ae(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},t}(De),it=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return Ae(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new Le).add(this.source.subscribe(new ot(this.getSubject(),this))),e.closed&&(this._connection=null,e=Le.EMPTY)),e},t.prototype.refCount=function(){return tt()(this)},t}(Ve),st=function(){var e=it.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),ot=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return Ae(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(Ke);var at=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var n=this.selector,r=this.subjectFactory(),i=n(r).subscribe(e);return i.add(t.subscribe(r)),i},e}();function ct(){return new Je}function ut(){return function(e){return tt()((t=ct,function(e){var r;if(r="function"==typeof t?t:function(){return t},"function"==typeof n)return e.lift(new at(r,n));var i=Object.create(e,st);return i.source=e,i.subjectFactory=r,i})(e));var t,n}}function lt(e,t){return function(n){return n.lift(new ft(e,t))}}var dt,ht,pt,ft=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new gt(e,this.predicate,this.thisArg))},e}(),gt=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.thisArg=r,i.count=0,i}return Ae(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(De);function mt(e,t){return function(n,r){return t(n(e(r)),r)}}function bt(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}function _t(e,t){return Object.prototype.hasOwnProperty.call(t,e)}function vt(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}!function(e){e.optic=function(e,t){return{get:e,set:t,modify:mt(e,t)}}}(dt||(dt={})),function(e){e.create=function e(t,n){return{get:t,set:n,modify:mt(t,n),compose:function(r){return e((function(e){var n=t(e);return void 0!==n?r.get(n):void 0}),(function(e,i){var s=t(i);return void 0!==s?n(r.set(e,s),i):i}))}}}}(ht||(ht={})),function(e){function t(e,n){return{get:e,set:n,modify:mt(e,n),compose:function(r){return t((function(t){return r.get(e(t))}),(function(t,i){return n(r.set(t,e(i)),i)}))}}}e.create=t,e.compose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)throw new TypeError("Can not compose zero lenses. You probably want `Lens.identity`.");if(1===e.length)return e[0];var n=e[0];return e.slice(1).forEach((function(e){n=n.compose(e)})),n};var n=t((function(e){return e}),(function(e,t){return e}));e.identity=function(){return n};var r=ht.create((function(e){}),(function(e,t){return t}));e.nothing=function(){return r}}(pt||(pt={}));var yt,wt,xt,Et,St=function(){var e=Object.prototype.toString;return"[object Arguments]"===e.call(arguments)?function(t){return"[object Arguments]"===e.call(t)}:function(e){return _t("callee",e)}}(),It=(yt=!{toString:null}.propertyIsEnumerable("toString"),wt=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],xt=function(){return arguments.propertyIsEnumerable("length")}(),Et=function(e,t){for(var n=0;n<e.length;){if(e[n]===t)return!0;n+=1}return!1},"function"!=typeof Object.keys||xt?function(e){if(Object(e)!==e)return[];var t,n,r=[],i=xt&&St(e);for(t in e)!_t(t,e)||i&&"length"===t||(r[r.length]=t);if(yt)for(n=wt.length-1;n>=0;)_t(t=wt[n],e)&&!Et(r,t)&&(r[r.length]=t),n-=1;return r}:function(e){return Object(e)!==e?[]:Object.keys(e)});function Tt(e){return null===e?"Null":void 0===e?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}function At(e,t,n,r){if(void 0===n&&(n=[]),void 0===r&&(r=[]),vt(e,t))return!0;if(Tt(e)!==Tt(t))return!1;if(null==e||null==t)return!1;if("function"==typeof e.equals||"function"==typeof t.equals)return"function"==typeof e.equals&&e.equals(t)&&"function"==typeof t.equals&&t.equals(e);switch(Tt(e)){case"Arguments":case"Array":case"Object":if("function"==typeof e.constructor&&"Promise"===(i=e.constructor,null==(s=String(i).match(/^function (\w*)/))?"":s[1]))return e===t;break;case"Boolean":case"Number":case"String":if(typeof e!=typeof t||!vt(e.valueOf(),t.valueOf()))return!1;break;case"Date":if(!vt(e.valueOf(),t.valueOf()))return!1;break;case"Error":return e.name===t.name&&e.message===t.message;case"RegExp":if(e.source!==t.source||e.global!==t.global||e.ignoreCase!==t.ignoreCase||e.multiline!==t.multiline||e.sticky!==t.sticky||e.unicode!==t.unicode)return!1;break;case"Map":case"Set":if(!At(bt(e.entries()),bt(t.entries()),n,r))return!1;break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var i,s,o=It(e);if(o.length!==It(t).length)return!1;for(var a=n.length-1;a>=0;){if(n[a]===e)return r[a]===t;a-=1}for(n.push(e),r.push(t),a=o.length-1;a>=0;){var c=o[a];if(!_t(c,t)||!At(t[c],e[c],n,r))return!1;a-=1}return n.pop(),r.pop(),!0}var Rt=void 0!==n(27061)&&!1;function kt(e,t,n){if(e in n&&At(t,n[e]))return n;var r={};for(var i in n)r[i]=n[i];return r[e]=t,r}function Ft(e){return function(t,n){return function(e,t){return At(e,t)?t:e}(e(t,n),n)}}var Ot=new RegExp(["^","function","\\(","[^), ]+","\\)","\\{",'("use strict";)?',"return\\s","[^\\.]+\\.(\\S+?);?","\\}","$"].join("\\s*"));new RegExp(["^","function","\\(","[^), ]+","\\)","\\{",'("use strict";)?',"(\\$_\\$wf\\(\\d+\\);)?","return\\s","(\\$_\\$w\\(\\d+, \\d+\\),\\s)?","[^\\.]+\\.(\\S+?);?","\\}","$"].join("\\s*"));function Ct(e){return function(e){var t=Ot,n=e.match(t);if(n&&n[2])return n[2].split(".");throw new TypeError('Expected a property expression, got "'+e+'".\n\n      A property expression should be a referentially transparent (no side-effects),\n      single-expression "getter" function.\n\n      Correct example: "function (x) { return x.some }" or "x => x.some".\n      Incorrect example: "function (x) { var y = x.some; return y }" or "({some}) => some"')}(e.toString())}function Pt(e){return void 0===e?function(e){return pt.create((function(t){return t[e]}),(function(t,n){return kt(e,t,n)}))}:pt.create((function(t){return t[e]}),(function(t,n){return kt(e,t,n)}))}var Nt=0;function Mt(e){if(Nt<10){Nt++;var t="x."+e.join("."),n="'"+e.join("', '")+"'";!function(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error("[Focal]: "+e);try{throw new Error(e)}catch(e){}}("The property expression overload of Atom.lens and Lens.prop are deprecated and will be removed in next versions of Focal. Please use the key name overload for Atom.lens and Lens.key instead. You can convert your code by changing the calls:\n  a.lens(x => "+t+") to a.lens("+n+"),\n  Lens.prop((x: T) => "+t+") to Lens.key<T>()("+n+").")}}function Lt(e){return e&&"function"==typeof e.schedule}pt.key=Pt,pt.prop=function(e){var t=Ct(e);return Rt&&Mt(t),pt.compose.apply(pt,t.map(Pt()))},pt.index=function(e){if(e<0)throw new TypeError(e+" is not a valid array index, expected >= 0");return ht.create((function(t){return t[e]}),(function(t,n){return n.length<=e?n.concat(Array(e-n.length),[t]):At(t,n[e])?n:n.slice(0,e).concat([t],n.slice(e+1))}))},pt.withDefault=function(e){return pt.replace(void 0,e)},pt.replace=function(e,t){return pt.create((function(n){return At(n,e)?t:n}),Ft((function(n){return At(n,t)?e:n})))},pt.find=function(e){return t=function(t){var n=function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1}(t,e);return n<0?pt.nothing():pt.index(n)},pt.create((function(e){return t(e).get(e)}),(function(e,n){return t(n).set(e,n)}));var t};var Ut=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ae(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(De),jt=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i.index=0,i}return Ae(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(De),Dt=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}};function Bt(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var Ht=Bt(),$t=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Wt(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var Vt=function(e){if(e&&"function"==typeof e[He])return r=e,function(e){var t=r[He]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if($t(e))return Dt(e);if(Wt(e))return n=e,function(e){return n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,Oe),e};if(e&&"function"==typeof e[Ht])return t=e,function(e){for(var n=t[Ht]();;){var r=void 0;try{r=n.next()}catch(t){return e.error(t),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add((function(){n.return&&n.return()})),e};var t,n,r,i=Ne(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+i+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function Gt(e,t,n,r,i){if(void 0===i&&(i=new jt(e,n,r)),!i.closed)return t instanceof Ve?t.subscribe(i):Vt(t)(i)}function qt(e,t){return new Ve((function(n){var r=new Le,i=0;return r.add(t.schedule((function(){i!==e.length?(n.next(e[i++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}function zt(e,t){return t?qt(e,t):new Ve(Dt(e))}var Kt={};function Jt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=void 0,r=void 0;return Lt(e[e.length-1])&&(r=e.pop()),"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&Pe(e[0])&&(e=e[0]),zt(e,r).lift(new Zt(n))}var Yt,Xt,Qt,Zt=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new en(e,this.resultSelector))},e}(),en=function(e){function t(t,n){var r=e.call(this,t)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return Ae(t,e),t.prototype._next=function(e){this.values.push(Kt),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var r=e[n];this.add(Gt(this,r,void 0,n))}}},t.prototype.notifyComplete=function(e){0==(this.active-=1)&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n){var r=this.values,i=r[n],s=this.toRespond?i===Kt?--this.toRespond:this.toRespond:0;r[n]=t,0===s&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))},t.prototype._tryResultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(Ut),tn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),nn=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r},rn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return tn(t,e),t.prototype.view=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return void 0!==e[0]?"function"==typeof e[0]?new cn(this,e[0]):"string"==typeof e[0]?new cn(this,pt.compose.apply(pt,e.map(pt.key())).get):new cn(this,(function(t){return e[0].get(t)})):this},t}(Xe),sn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return tn(t,e),t.prototype.set=function(e){this.modify((function(){return e}))},t.prototype.lens=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new an(this,"function"==typeof e?pt.prop(e):"string"==typeof e?pt.compose.apply(pt,nn([pt.key(e)],t.map((function(e){return pt.key(e)})))):e,At)},t}(rn),on=function(e){function t(t){return e.call(this,t)||this}return tn(t,e),t.prototype.get=function(){return this.getValue()},t.prototype.modify=function(e){var t=this.getValue(),n=e(t);At(t,n)||this.next(n)},t.prototype.set=function(e){At(this.getValue(),e)||this.next(e)},t}(sn),an=function(e){function t(t,n,r){void 0===r&&(r=At);var i=e.call(this,void 0)||this;return i._source=t,i._lens=n,i._eq=r,i._subscription=null,i._refCount=0,i}return tn(t,e),t.prototype.get=function(){return this._subscription?this.getValue():this._lens.get(this._source.get())},t.prototype.modify=function(e){var t=this;this._source.modify((function(n){return t._lens.modify(e,n)}))},t.prototype.set=function(e){var t=this;this._source.modify((function(n){return t._lens.set(e,n)}))},t.prototype._onSourceValue=function(e){var t=this.getValue(),n=this._lens.get(e);this._eq(t,n)||this.next(n)},t.prototype._subscribe=function(t){var n=this;this._subscription||(this._subscription=this._source.subscribe((function(e){return n._onSourceValue(e)}))),this._refCount++;var r=new Le((function(){--n._refCount<=0&&n._subscription&&(n._subscription.unsubscribe(),n._subscription=null)}));return r.add(e.prototype._subscribe.call(this,t)),r},t.prototype.unsubscribe=function(){this._subscription&&(this._subscription.unsubscribe(),this._subscription=null),this._refCount=0,e.prototype.unsubscribe.call(this)},t}(sn),cn=function(e){function t(t,n,r){void 0===r&&(r=At);var i=e.call(this,void 0)||this;return i._source=t,i._getter=n,i._eq=r,i._subscription=null,i._refCount=0,i}return tn(t,e),t.prototype.get=function(){return this._subscription?this.getValue():this._getter(this._source.get())},t.prototype._onSourceValue=function(e){var t=this.getValue(),n=this._getter(e);this._eq(t,n)||this.next(n)},t.prototype._subscribe=function(t){var n=this;this._subscription||(this._subscription=this._source.subscribe((function(e){return n._onSourceValue(e)}))),this._refCount++;var r=new Le((function(){--n._refCount<=0&&n._subscription&&(n._subscription.unsubscribe(),n._subscription=null)}));return r.add(e.prototype._subscribe.call(this,t)),r},t.prototype.unsubscribe=function(){this._subscription&&(this._subscription.unsubscribe(),this._subscription=null),this._refCount=0,e.prototype.unsubscribe.call(this)},t}(rn),un=function(e){function t(t,n,r){void 0===r&&(r=At);var i=e.call(this,void 0)||this;return i._sources=t,i._combineFn=n,i._eq=r,i._subscription=null,i._refCount=0,i}return tn(t,e),t.prototype.get=function(){return this._subscription?this.getValue():this._combineFn(this._sources.map((function(e){return e.get()})))},t.prototype._onSourceValues=function(e){var t=this.getValue(),n=this._combineFn(e);this._eq(t,n)||this.next(n)},t.prototype._subscribe=function(t){var n=this;this._subscription||(this._subscription=Jt(this._sources).subscribe((function(e){return n._onSourceValues(e)}))),this._refCount++;var r=new Le((function(){--n._refCount<=0&&n._subscription&&(n._subscription.unsubscribe(),n._subscription=null)}));return r.add(e.prototype._subscribe.call(this,t)),r},t.prototype.unsubscribe=function(){this._subscription&&(this._subscription.unsubscribe(),this._subscription=null),this._refCount=0,e.prototype.unsubscribe.call(this)},t}(rn);!function(e){e.create=function(e){return new on(e)},e.log=function(e,t){var n=function(e,t,n){return console.log("%c"+e,"color: "+t+"; font-weight: bold",n)},r=e.get();return e.subscribe((function(e){"function"==typeof t?t(r,e):(console.group("UPDATE "+(t?"TYPE: "+t+" ":"")+"@ "+(new Date).toTimeString()),n("prev state","#9E9E9E",r),n("next state","#4CAF50",e),console.groupEnd()),r=e})),e},e.combine=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new un(e.slice(void 0,-1),(function(t){return e[e.length-1].apply(e,t)}))},e.fromObservable=function(t){var n,r,i,s=new Xe(null),o=t.pipe((n=function(t){var n=s.value;null===n?s.next(e.create(t)):n.set(t)},function(e){return e.lift(new Ze(n,r,i))}),ut());return new Ve((function(e){var t=new Le;return t.add(s.pipe(lt((function(e){return!!e}))).subscribe(e)),t.add(o.subscribe(void 0,(function(t){return e.error(t)}),(function(){return e.complete()}))),t}))}}(Yt||(Yt={}));class ln{static getInstance(){if(void 0===this._instanceShared)throw new Error("Env not inited yet");return this._instanceShared}static initShared(e){if(void 0!==this._instanceShared)throw new Error("Env already inited");this._instanceShared=e}constructor(e,t=Yt.create(!1),n=Yt.create(!1)){this._enableHistoryLoggerInProd=t,this._enableAdvancedHistoryLoggerInProd=n,this.enableHistoryLoggerInProd=(e=!0)=>{e&&!this._enableHistoryLoggerInProd.get()?(console.warn("Debug reports have been enabled"),this._enableHistoryLoggerInProd.set(!0)):!e&&this._enableHistoryLoggerInProd.get()&&(console.warn("Debug reports have been disabled"),this._enableHistoryLoggerInProd.set(!1))},this.enableAdvancedHistoryLoggerInProd=(e=!0)=>{e&&!this._enableAdvancedHistoryLoggerInProd.get()?(console.warn("Advanced logging has been enabled"),this._enableAdvancedHistoryLoggerInProd.set(!0)):!e&&this._enableAdvancedHistoryLoggerInProd.get()&&(console.warn("Advanced logging has been disabled"),this._enableAdvancedHistoryLoggerInProd.set(!1))};const r=e.testArgs,i=r&&r.processEnv?r.processEnv:z.fromBrowserify(),s=K.getTargetEnv(i);this._initLogger(e,s);const o=function(e,t,n,r,i,s){const o=K.create(e,t,n,r,i,s);return J.init(o),self.GR_CFG=J.get(),o}(e.browser,e.extensionType,e.deploymentType,e.context,i,s);this.context=e.context,this.config=o}_initLogger(e,t){this.historyLogsService=ge.create({...e.historyLoggerExtraArgs,enabledInProd:this._enableHistoryLoggerInProd,enableAdvancedInProd:this._enableAdvancedHistoryLoggerInProd});const n="prod"!==t||"cs"!==e.context,r={create:(e,t)=>{return new Ee(e,{writer:new Ie,filterFn:n?e=>!0:(r=_e.ERROR,e=>ye(e.level)>=ye(r))},this.historyLogsService,t);var r}};this.logger=r}}function dn(){return ln.getInstance()}!function(e){e.create=function(e,t){return new xe(e,(()=>dn().logger.create(e,t)))}}(Xt||(Xt={})),function(e){e.lessThan1Week="lessThan1Week",e.weekTo4Weeks="weekTo4Weeks",e.moreThan4weeks="moreThan4weeks",e.moreThan3Months="moreThan3Months"}(Qt||(Qt={}));new Map([[Date.now(),Qt.lessThan1Week],[Date.now()-oe(7),Qt.weekTo4Weeks],[Date.now()-oe(28),Qt.moreThan4weeks],[Date.now()-oe(90),Qt.moreThan3Months]]);const hn={stats:"ex_perfstats",csInit:"ex_csInitPerf",viewInjection:"viewInjectionPerf"};function pn(e){const{_tag:t,...n}=e;return{[hn[e._tag]]:n}}var fn;function gn(e){return"object"==typeof e&&null!==e&&"message"in e&&"string"==typeof e.message}!function(e){e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR"}(fn||(fn={}));const mn=(e,t)=>{if(0===e.length)return 0;const n=[...e].sort(((e,t)=>e-t));if(t<=0)return n[0];if(t>=1)return n[n.length-1];const r=(n.length-1)*(100*t)/100,i=Math.floor(r),s=i+1,o=r%1;return n[i]*(1-o)+n[s]*o},bn=e=>e.reduce(((e,t,n)=>e+(t-e)/(n+1)),0),_n=(e,t)=>{const n=void 0===t?bn(e):t;return e.length>1?Math.sqrt(e.reduce(((e,t)=>e+(t-n)**2),0)/(e.length-1)):0};var vn,yn,wn;!function(e){function t(){return{dummy:!0,startMeasure:()=>({endMeasure:()=>{},cancelMeasure:_}),measure:e=>e(),measureAsync:e=>e(),custom:_}}e.dummy=t,e.dummyFactoryInitialization=()=>()=>t()}(vn||(vn={})),function(e){e.dummy={flushMeasures:e=>[],measure:(e,t)=>t(),startMeasure:e=>({endMeasure(){},cancelMeasure(){}})}}(yn||(yn={})),function(e){let t;!function(e){let t;!function(e){let t;!function(e){e.stats="stats",e.csInit="csInit",e.viewInjection="viewInjection"}(t=e.Types||(e.Types={}))}(t=e.Tagged||(e.Tagged={}))}(t=e.Data||(e.Data={})),e.getStats=function(e){if(0===e.length)return{ct:0};{const t=e.reduce(((e,t)=>Math.min(e,t)),Number.MAX_VALUE),n=e.reduce(((e,t)=>Math.max(e,t)),Number.MIN_VALUE),r=e.length>=6?bn(e):void 0;return{ct:e.length,min:t,max:n,range:n-t,avg:r,stddev:void 0!==r&&e.length>1?_n(e,r):void 0}}}}(wn||(wn={}));const xn=e=>e.replace("www.","");function En(e){const t=e&&e.ownerDocument||document,n=t.location||t.defaultView.location;return n?xn(n.hostname):""}function Sn(e){return"firefox"===X().bundleInfo.browser&&/^about:/.test(e)?e:""===e?"":xn(new URL(e).hostname)}function In(e){return An.includes(e)}function Tn(e=En(),t="other"){var n;return In(e)?null!==(n=function(e){return An.getTopSiteId(e)}(e))&&void 0!==n?n:"null":t}const An=new class{constructor(e){function t(e){return`Invalid pattern "${e}": "*" is allowed only at start and/or end position`}this._equal=new Set,this._prefix=[],this._suffix=[],this._infix=[],this._domain=[];for(const n of e)if(n.startsWith("**."))this._domain.push(n.substring(3));else{const e=n.indexOf("*");if(-1===e)this._equal.add(n);else if(e===n.length-1)this._prefix.push(n.substring(0,e));else{if(0!==e)throw new Error(t(n));{const e=n.indexOf("*",1);if(-1===e)this._suffix.push(n.substring(1));else{if(e!==n.length-1)throw new Error(t(n));this._infix.push(n.substring(1,e))}}}}}getTopSiteId(e){var t,n,r,i,s,o,a;return null!==(o=null!==(s=null!==(i=null!==(r=null!==(n=null!==(t=this._equal.has(e)?e:void 0)&&void 0!==t?t:this._domain.find((t=>t===e)))&&void 0!==n?n:(a=this._domain.find((t=>e.endsWith("."+t))))?"**."+a:void 0)&&void 0!==r?r:this._prefix.find((t=>e.startsWith(t))))&&void 0!==i?i:this._suffix.find((t=>e.endsWith(t))))&&void 0!==s?s:this._infix.find((t=>e.includes(t))))&&void 0!==o?o:null}includes(e){return null!==this.getTopSiteId(e)}}(["mail.google.com","translate.google.*","docs.google.com","web.whatsapp.com","facebook.com","outlook.*","linkedin.com","zendesk.*","youtube.com","twitter.com","messenger.com","*.slack.*","*canvas*","*instructure*","trello.com","editor.wix.com","quizlet.com","mail.yahoo.com","*.force.*","keep.google.com","vk.com","fanyi.baidu.com","app.bullhornstaffing.com","app.qa-world.com","calendar.google.com","papago.naver.com","wordcounter.net","blogger.*","wattpad.com","wordpress.com","amazon.*","smallseotools.com","create.kahoot.it","apps.rackspace.com","basecamp.com","varsitytutors.com","canva.com","fanyi.youdao.com","reverso.net","message.alibaba.com","*schoology*","*.blackboard.*","classroom.google.com","*upwork*","business.facebook.com","medium.com","mail.aol.com","workhub.transcribeme.com","github.com","**.salesforce.com","**.force.com","**.zendesk.com","**.microsoftonline.com","**.outlook.com","**.facebook.com","**.messenger.com","**.genesys.com","**.cisco.com","**.avaya.com","**.oraclecloud.com","**.five9.com","**.tawk.to","**.helpscout.com","**.livechat.com","**.intercom.com","**.freshdesk.com","**.liveagent.com","**.hubspot.com"]);class Rn{constructor(e){this._onMeasure=e}measure(e){const t=performance.now();let n=!1;try{const r=e();return n=!0,r}finally{this._onMeasure(performance.now()-t,n)}}async measureAsync(e){const t=performance.now();let n=!1;try{const r=await e();return n=!0,r}finally{this._onMeasure(performance.now()-t,n)}}}function kn(e){try{return JSON.stringify(e)}catch(e){return JSON.stringify({json_error:"Cannot json stringify"})}}function Fn(e,t){return{json:kn(e),exception:t?{name:t.name,message:t.message,stack:t.stack?Pn(t.stack):void 0,...le(t.extra)?t.extra:{}}:void 0}}function On(){return dn().browserApi.baseUri}const Cn={chromium:["<anonymous>","native","unknown location"],firefox:[],safari:["[native code]"]};function Pn(e,{browser:t=dn().config.bundleInfo.browser,extensionBaseUri:n=On()}={}){if(!e)return e;const r=Cn["chrome"===t||"edge"===t?"chromium":t],i=e=>r.some((t=>e.startsWith(t)))||n&&e.startsWith(n),s=e.split("\n");if("chrome"===t||"edge"===t){const e=[];let t=0;for(;t<s.length&&!s[t].startsWith("    at ");)e.push(s[t]),t++;for(;t<s.length;){const n=(o=s[t],a=void 0,c=void 0,u=void 0,null===(u=null!==(c=null!==(a=Nn.exec(o))&&void 0!==a?a:Mn.exec(o))&&void 0!==c?c:Ln.exec(o))||void 0===u?void 0:u[1]);n?i(n)?e.push(s[t]):e.push("    at <hidden>"):e.push("    <unparsed>"),t++}return e.join("\n")}if("firefox"===t||"safari"===t)return s.map((e=>[e,"firefox"===t?Un(e):jn(e)])).map((([e,t])=>void 0===t?"<unparsed>":i(t)?e:"<hidden>")).join("\n");var o,a,c,u;g(t)}const Nn=/^ {4}at ([^(]*)$/,Mn=/^ {4}at [^(]* \(([^()]*)\)$/,Ln=/^ {4}at eval \([^(]* \(([^()]*)\)\)$/;function Un(e){return e.split("@",2)[1]}function jn(e){var t;return null!==(t=e.split("@",2)[1])&&void 0!==t?t:e}const Dn=Xt.create("lib.tracking.telemetry"),Bn=.1,Hn=.01,$n=e=>e.substring(0,5),Wn=(e,t)=>{let n;try{n=JSON.stringify(t)}catch(t){n=`stringify fail: '${String(t)}', '${gn(t)?t.message:"undefined"}'`,Dn.warn(n,e)}return n};class Vn{constructor(e=_,t=_,n=_,r=_,i=!1,s=vn.dummyFactoryInitialization,o=_,a=_,c=(e=>.01),u=_,l=s(((e,{hideUserInfo:t,...n})=>{this._sendEvent({logger:e,level:fn.INFO,hideUserInfo:t,...pn(n)})})),d=_,h=_,p=_,f=_,g=_){this._sendFelog=e,this._sendFelogUsage=t,this._setUserInfo=n,this._setContainerId=r,this._sendUsageMetrics=i,this._sendFelogEvent=o,this._sendFelogCrashLogs=a,this._getUsageMetricsRate=c,this._enableDataSharing=u,this._createPerfLogger=l,this._sendFelogMetricEvent=d,this._sendFemetricsRate=h,this._startFemetricsTimer=p,this._endFemetricsTimer=f,this._sendFemetricsTimer=g,this._sendEvent=e=>{try{this._sendFelogEvent(e)}catch(t){Dn.warn(`Failed to send felog for ${JSON.stringify(e)}`,t)}},this._sendException=e=>(t,n,r)=>this._sendEvent({message:r||(gn(t)?t.message:String(t)),...e,extra:{...e.extra,...Fn(n,t)}}),this._sendUsageMetricsSamplingRatio=this._getUsageMetricsRate(X().bundleInfo.browser),this.sendFemetricsRate=(e,t)=>{this._sendFemetricsRate(e,t)},this.startFemetricsTimer=(e,t,n)=>{this._startFemetricsTimer(e,t,performance.now(),n)},this.endFemetricsTimer=(e,t,n)=>{this._endFemetricsTimer(e,t,performance.now(),n)},this.restoredBgConnection=e=>{this._send("cs.connection.bg.restored",fn.INFO,{timeWithoutConnection:e})},this.initWithoutBgConnection=()=>{this._send("cs.connection.bg.disconnected",fn.INFO)},this.fetchDefinitionsFail=()=>{this._send("cs.connection.api.definition.failed",fn.WARN)},this.tooLongPageConfigInit=e=>{this._send("cs.pageConfig.init.exceeded",fn.WARN,{initTime:e})},this.tooLongUserUpdateTime=e=>{this._send("bg.state.user.update.exceeded",fn.WARN,{updateTime:e})},this.lostBgPageConnection=()=>{this._send("cs.gbutton.bgСonnection.lost",fn.INFO)},this.restoreBgPageConnection=e=>{this._send("cs.gbutton.bgСonnection.restored",fn.INFO,{time:e})},this.dynamicConfigLoadFromPrefsError=e=>{this._sendSampled(Hn,"bg.dynamicConfig.prefs.load.error",fn.ERROR,{message:e})},this.dynamicConfigSaveToPrefsError=e=>{this._sendSampled(Hn,"bg.dynamicConfig.prefs.save.error",fn.ERROR,{message:e})},this.dynamicConfigLoadFromServerError=e=>{this._sendSampled(Hn,"bg.dynamicConfig.server.load.error",fn.ERROR,{message:e})},this.pageConfigCDNError=e=>{this._send("cs.pageConfig.cdn.error",fn.ERROR,{message:e})},this.pageConfigLocalStorageError=(e,t)=>{this._send("cs.pageConfig.localStorage.error",fn.INFO,{message:e,name:t})},this.pageConfigUpdated=(e,t)=>{this._send("cs.pageConfig.updated",fn.INFO,{oldVersion:e,newVersion:t})},this.settingsPopupTimeout=()=>{this._send("settings.popup.init.timeout",fn.WARN)},this.settingsUsupportedShow=e=>{this._send("settings.popup.state.unsupported.show",fn.INFO,{popupType:e})},this.gnarClientInitFail=e=>{this._send("gnar.bg.tracking.gnar.init.fail",fn.WARN,{message:e})},this.bgTrackingInitFail=()=>{this._send("debug.tracking.init.fail",fn.INFO)},this.userUpgradeClick=e=>{this._send("cs.ui.action.upgradeClick",fn.INFO,{placement:e})},this.gGbUpHookClick=()=>{this._send("cs.ui.gb.uphook.click",fn.INFO)},this.gButtonClick=()=>{this._send("cs.ui.gbutton.click",fn.INFO)},this.unexpectedAnonymous=e=>{this._send("debug.bg.session.unexpectedAnonymous",fn.INFO,e)},this.getDapiPropError=(e,t)=>{const n="bg.connection.dapi.getProp.error",r=Wn(n,{statusCode:e,message:t});this._sendEvent({logger:n,level:fn.WARN,extra:{json:r},sendToFemetrics:!0})},this.getCheetahStatusError=(e,t)=>{const n="bg.connection.cheetahSettings.getStatus.error",r=Wn(n,{statusCode:e,message:t});this._sendEvent({logger:n,level:fn.WARN,extra:{json:r},sendToFemetrics:!0})},this.bgApiServiceRequestSuccess=(e,t="GET",n)=>{this.sendFemetricsRate("info",{domain:e,context:n?"accessToken enabled":"accessToken not enabled",logger:"bg.api.service.request.success",message:`[${t.toUpperCase()}]`})},this.bgApiServiceRequestFailed=(e,t="GET",n,r)=>{this.sendFemetricsRate("warn",{domain:e,context:r?"accessToken enabled":"accessToken not enabled",message:`[${t.toUpperCase()}] ${n}`,logger:"bg.api.service.request.failed"})},this.setDapiPropError=(e,t)=>{const n="bg.connection.dapi.setProp.error",r=Wn(n,{statusCode:e,message:t});this._sendEvent({logger:n,level:fn.WARN,extra:{json:r},sendToFemetrics:!0})},this.toggleExtensionDefs=e=>{this._send("bg.settings.definitions.toggle",fn.INFO,{enabled:e})},this.toggleExtension=(e,t,n)=>{const r={enabled:e,placement:t,domain:n};this._sendEvent({logger:"bg.settings.extension.toggle",level:fn.INFO,sendToFemetrics:!0,extra:{json:kn(r)},femetricsExtra:r})},this.disableUntilNextVisit=()=>{this._send("cs.gbutton.disableUntilNextVisit",fn.INFO)},this.disableButtonClick=()=>{this._send("cs.gbutton.disableButtonClick",fn.INFO)},this.cookieOverflow=(e,t)=>{this._send("debug.bg.state.cookie.overflow",fn.INFO,{size:e,biggestCookie:t})},this.externalChangePlan=()=>{this._send("bg.api.external.changePlan",fn.INFO)},this.externalChangeDialect=()=>{this._send("bg.api.external.changeDialect",fn.INFO)},this.externalChangeUser=()=>{this._send("bg.api.external.changeUsed",fn.INFO)},this.externalLogout=()=>{this._send("bg.api.external.logout",fn.INFO)},this.safariLogoutFail=e=>{this._sendEvent({logger:"bg.safari.logout.error",level:fn.INFO,message:e,sendToFemetrics:!0})},this.bgPageStartFail=this._sendException({logger:"bg.start.fail",level:fn.ERROR}),this.acceptDataControl=()=>{this._send("bg.dataControl.accepted",fn.INFO)},this.bgPageInitTimeout=e=>{this._send("bg.state.start.timeout",fn.WARN,{initTime:e})},this.bgPageInitFail=e=>{this._send("bg.state.init.fail",fn.ERROR,{initAttempts:e})},this.bgPage={bgPageStarted:(e,t)=>{this._sendFemetricsRate("bgPageStarted",{context:e,time:t})}},this.popup={popupInitFail:(e,t)=>{this._sendEvent({logger:"popup.init.fail",level:fn.ERROR,message:e,extra:t,femetricsMessage:$n(e)})},fetchTreatmentsFail:e=>{this._sendFemetricsRate("popupFetchTreatmentsFails",{message:$n(e)})},popupStateInitFail:e=>{this._sendEvent({logger:"popup.state.init.fail",level:fn.ERROR,message:e,femetricsMessage:$n(e)})}},this.extensionUpdated=(e,t)=>{this._send("bg.state.updated",fn.INFO,{currentVersion:e,previousVersion:t})},this.extensionUpdateFail=e=>{this._send("bg.state.update.fail",fn.INFO,{previousVersion:e})},this.cannotGetInstallSource=()=>{this._send("bg.getSource.fail",fn.WARN)},this.extensionInstall=e=>{this._sendEvent({logger:"bg.state.install",level:fn.INFO,extra:{json:JSON.stringify({source:e})},sendToFemetrics:!0})},this.chromeContentScriptLoadError=(e,t)=>{this._send("bg.chrome.cs.load.error",fn.WARN,{message:e,type:t})},this.reloadNotificationShow=()=>{this._send("bg.ui.notification.tabsReload.show",fn.WARN)},this.reloadNotificationClick=()=>{this._send("bg.ui.notification.tabsReload.click",fn.INFO)},this.fetchUserFail=(e,t,n)=>{const r="bg.user.fetch.fail",i=Wn(r,{body:t,statusCode:n,reason:e});this._sendEvent({logger:r,level:fn.WARN,extra:{json:i},sendToFemetrics:!0})},this.getAccessTokenError=(e,t)=>this.sendFemetricsRate("warn",{logger:"bg.api.service.accessToken.error",level:fn.WARN,message:String(e),context:t?"ignoreCache":"withCache"}),this.getAccessTokenSuccess=e=>this.sendFemetricsRate("info",{logger:"bg.api.service.accessToken.success",level:fn.INFO,context:e?"ignoreCache":"withCache"}),this.frequentCookieChanges=e=>{this._send("debug.cookie.onChange.error",fn.INFO,{canceled:e})},this.initializePropFromDapi=e=>{this._send("bg.state.dapi.prop.initialize",fn.INFO,{name:e})},this.onboardingPopupShow=()=>{this._send("cs.onboarding.popup.show",fn.INFO)},this.onboardingPopupCancel=()=>{this._send("cs.onboarding.popup.cancel",fn.INFO)},this.onboardingTutorialShow=()=>{this._send("cs.onboarding.tutorial.show",fn.INFO)},this.loginReminderPopupShow=()=>{this._send("cs.gbutton.popup.loginReminder.show",fn.INFO)},this.loginReminderBadgeShow=()=>{this._send("bg.state.user.loginReminder.enable",fn.INFO)},this.unhandledExceptions={unhandledBgPageException:(e,t)=>{const n="bg.unhandledException";Dn.error(n,new Error(e),t),this._sendSampledEvent(.05,{logger:n,level:fn.ERROR,message:e,extra:t})},unhandledBgPageRejection:(e,t)=>{const n="bg.unhandledRejection";Dn.error(n,new Error(e),t),this._sendSampledEvent(.05,{logger:n,level:fn.ERROR,message:e,extra:t})},unhandledPopupException:(e,t)=>{const n="popup.unhandledException";Dn.error(n,new Error(e),t),this._sendEvent({logger:n,level:fn.ERROR,message:e,extra:t,femetricsMessage:$n(e)})},unhandledPopupRejection:(e,t)=>{const n="popup.unhandledRejection";Dn.error(n,new Error(e),t),this._sendEvent({logger:n,level:fn.ERROR,message:e,extra:t,femetricsMessage:$n(e)})}},this.csUnhandled=(e,t)=>{const n="cs.unhandled";Dn.error(n,new Error(e)),this._sendEvent({logger:n,level:fn.ERROR,message:e,femetricsMessage:$n(e),femetricsExtra:t})},this.csCrash=v(((e,t)=>{Dn.error("cs.crash",new Error(e)),this._sendEvent({logger:"cs.crash",level:fn.ERROR,message:e,femetricsExtra:t})})),this.storageMigrationSucceeded=()=>{this._send("bg.storageMigration.success",fn.INFO,{})},this.storageMigrationFailed=this._sendException({logger:"bg.storageMigration.failure",level:fn.ERROR}),this.storageApplyChangesFailed=this._sendException({logger:"bg.storage.applyChanges.failure",level:fn.ERROR}),this.cardShowAction=()=>{this._sendSampled(Bn,"cs.editor.card.show",fn.INFO)},this.cardHideAction=()=>{this._sendSampled(Bn,"cs.editor.card.hide",fn.INFO)},this.cardReplacementAction=()=>{this._sendSampled(Bn,"cs.editor.card.replacement",fn.INFO)},this.cardAddToDictAction=()=>{this._sendSampled(Bn,"cs.editor.card.addToDict",fn.INFO)},this.cardIgnoreAction=()=>{this._sendSampled(Bn,"cs.editor.card.ignore",fn.INFO)},this.synonymCardShowAction=e=>{this._sendSampled(Bn,"cs.editor.synonym.show",fn.INFO,{notFoundCard:e})},this.synonymCardHideAction=e=>{this._sendSampled(Bn,"cs.editor.synonym.hide",fn.INFO,{notFoundCard:e})},this.synonymReplacementAction=()=>{this._sendSampled(Bn,"cs.editor.synonym.replacement",fn.INFO)},this.dictCardShowAction=()=>{this._sendSampled(Bn,"cs.editor.dict.show",fn.INFO)},this.dictCardHideAction=()=>{this._sendSampled(Bn,"cs.editor.dict.hide",fn.INFO)},this.couldNotParseTransform=(e,t)=>{this._send("cs.cards.transforms.parse.error",fn.WARN,{transformHTML:e,fallbackParseSuccessful:t})},this.disabledTabLoad=e=>{this._sendUsage("usage.loadOnDisabledTab",fn.INFO,{accountType:e})},this.disabledTabByUserLoad=e=>{this._sendUsage("usage.loadOnDisabledByUserTab",fn.INFO,{accountType:e})},this.initSession=(e,t,n,r)=>{this._sendUsage("usage.session.init",fn.INFO,{isTopSite:In(e),accountType:t,fieldType:n,fieldSupported:r}),this._sendMetric("usage.session.init",{domain:e,accountType:t,fieldType:n,fieldSupported:r})},this.cardFirstInteraction=(e,t)=>{this._sendUsage("usage.card.interaction",fn.INFO,{accountType:e,fieldType:t})},this.gnar={nextPingDateWriteError:e=>this._send("bg.gnarTracker.nextPingDateWriteError",fn.ERROR,{error:e}),sendError:this._sendException({logger:"bg.gnarTracker.sendError",level:fn.ERROR}),trackBeforeSetUser:e=>this._send("bg.gnarTracker.trackBeforeSetUser",fn.INFO,{millisSinceInit:e}),errorSetUser:this._sendException({logger:"bg.gnarTracker.errorSetUser",level:fn.ERROR})},this.fluidGdocs={sidebarFail:v(((e,t)=>this._sendException({logger:"cs.gdocs.fluid.getSidebarFail",level:fn.ERROR})(e,{type:t}))),noPage:v((()=>this._send("cs.gdocs.fluid.noPage",fn.ERROR))),getFullTextFailed:v((e=>this._send("cs.gdocs.fluid.getFullTextFailed",fn.INFO,{type:e}))),getFullTextSuccess:()=>{this._sendSampled(1e-4,"cs.gdocs.getFullTextSuccess",fn.INFO)},contentMonitoringFailed:v(this._sendException({logger:"cs.gdocs.fluid.contentMonitoringFailed",level:fn.WARN})),pageToTextMapFail:v((()=>this._send("cs.gdocs.fluid.pageToTextMapFail",fn.INFO))),nestedTablesAppearance:v((()=>this._send("cs.gdocs.fluid.nestedTablesAppearance",fn.INFO))),mapTableIssue:v((e=>this._send("cs.gdocs.fluid.mapTableIssue",fn.INFO,{type:e}))),treeStructureFailure:v((()=>this._send("cs.gdocs.fluid.treeStructureFailure",fn.INFO))),textFragmentMapFail:v((()=>this._send("cs.gdocs.fluid.textFragmentMapFail",fn.INFO))),createMapFail:v(this._sendException({logger:"cs.gdocs.fluid.createMapFail",level:fn.ERROR})),eventTargetFail:v(this._sendException({logger:"cs.gdocs.fluid.eventTargetFail",level:fn.ERROR})),updateMapFail:v(this._sendException({logger:"cs.gdocs.fluid.updateMapFail",level:fn.ERROR})),shiftMapFail:v(this._sendException({logger:"cs.gdocs.fluid.shiftMapFail",level:fn.ERROR})),init:()=>this._sendEvent({logger:"cs.gdocs.fluid.init",level:fn.INFO,hideUserInfo:!0}),initOnCanvasAttempt:()=>this._send("cs.gdocs.fluid.canvas",fn.INFO),getTextPerf:this._createPerfLogger("cs.gdocs.fluid.perf.getText",30),buildTextMapPerf:this._createPerfLogger("cs.gdocs.fluid.perf.textMap",30),updateTextMapPerf:this._createPerfLogger("cs.gdocs.fluid.perf.updateTextMap",30)},this._sendGdocsPageExecutionException=this._sendException({logger:"cs.gdocs.pageExecution.exception",level:fn.ERROR}),this.gdocs={pageExecutionException:(e,t)=>this._sendGdocsPageExecutionException(e,{isGDocsCanvas:t}),disabledBeforeForceEnable:v((e=>this._send("cs.gdocs.disabledBeforeForceEnable",fn.INFO,{disabledDate:e}))),enabledBeforeForceEnable:v((()=>this._send("cs.gdocs.enabledBeforeForceEnable",fn.INFO))),replacementValidation:e=>{this._sendFemetricsRate("gdocsReplacementValidation",e)}},this.canvasGdocs={injectedException:v(this._sendException({logger:"cs.gdocs.canvas.injected.exception",level:fn.ERROR})),injectedError:y(((e,t,n,r)=>this._sendEvent({logger:"cs.gdocs.canvas.injected.error",level:fn.ERROR,message:t,extra:{json:kn({context:e,data:n})},gdocsExtra:r,femetricsExtra:{context:e}})),(e=>e)),injectedInfo:y(((e,t,n)=>this._sendEvent({logger:"cs.gdocs.canvas.injected.info",eventContext:e,level:fn.INFO,sendToFemetrics:!0,gdocsExtra:t,extra:{json:kn({context:e,data:n})},femetricsExtra:{context:e}})),(e=>e)),initializationException:v(((e,t,n)=>this._sendException({logger:"cs.gdocs.canvas.init.exception",level:fn.ERROR,gdocsExtra:n,femetricsExtra:{type:t}})(e,{type:t}))),initializationTimeout:v(((e,t,n)=>this._sendEvent({logger:"cs.gdocs.canvas.init.timeout",level:fn.ERROR,message:`Initialization for ${t} timeout: ${e}ms`,extra:{json:kn({type:t})},gdocsExtra:n,femetricsExtra:{type:t}}))),creatingException:v(((e,t)=>this._sendEvent({logger:"cs.gdocs.canvas.creating.exception",level:fn.ERROR,message:e,gdocsExtra:t}))),initInterrupted:v((e=>this._sendEvent({logger:"cs.gdocs.canvas.interrupted",level:fn.ERROR,message:"Interrupted",gdocsExtra:e}))),dataSourceException:v(((e,t)=>this._sendException({logger:"cs.gdocs.canvas.dataSource.exception",level:fn.ERROR,femetricsExtra:{type:t}})(e,{type:t}))),error:y(((e,t,n,r,i)=>this._sendEvent({logger:"cs.gdocs.canvas.error",level:fn.ERROR,message:t,extra:Fn({type:e,message:t,data:r},n),femetricsExtra:{type:e,mappingName:null==i?void 0:i.mappingName}})),(e=>e),((e,t,n,r,i)=>{this._sendFemetricsRate("gdocsError",{type:e,message:t&&t.substring(0,20)||"other",mappingName:null==i?void 0:i.mappingName})})),warning:y(((e,t,n)=>this._sendEvent({logger:"cs.gdocs.canvas.warning",level:fn.WARN,message:t,extra:Fn({type:e,message:t,data:n})})),(e=>e)),started:e=>this._sendEvent({logger:"cs.gdocs.canvas.started",level:fn.INFO,sendToFemetrics:!0,gdocsExtra:e}),creating:e=>this._sendEvent({logger:"cs.gdocs.canvas.creating",level:fn.INFO,sendToFemetrics:!0,gdocsExtra:e}),showLongDocPopup:e=>this._sendEvent({logger:"cs.gdocs.canvas.longDocPopup",level:fn.INFO,sendToFemetrics:!0,gdocsExtra:e}),showSharedDocPopup:e=>this._sendEvent({logger:"cs.gdocs.canvas.sharedDocPopup",level:fn.INFO,sendToFemetrics:!0,gdocsExtra:e}),debugPageSearchFail:v((e=>this._sendEvent({logger:"cs.gdocs.canvas.pageSearch.debug",level:fn.INFO,extra:{json:kn({data:e})}}))),debugMappingFail:v((e=>this._sendEvent({logger:"cs.gdocs.canvas.mapping.debug",level:fn.INFO,extra:{json:kn({data:e})}}))),buildTextMapPerf:this._createPerfLogger("cs.gdocs.canvas.perf.textMap",30),findPage:this._createPerfLogger("cs.gdocs.canvas.perf.findPage",100),mappingPerf:e=>new Rn((t=>{1e-4>Math.random()&&this._sendFemetricsTimer("gdocsMapping",t,{...e,mapPageCount:void 0===e.mapPageCount?void 0:e.mapPageCount>10?"10+":e.mapPageCount})})),fullTextNotFound:v((()=>this._send("cs.gdocs.canvas.fullTextNotFound",fn.WARN))),mapping:({mapPageCount:e,attempts:t,mode:n,tableMode:r})=>{this._sendFemetricsRate("gdocsMapping",{mappingMode:n,tableMode:r,mapPageCount:e>10?"10+":e,mappingAttempts:t.length,...t.reduce(((e,t,n)=>({...e,[`mapping${n}_name`]:t.name,[`mapping${n}_success`]:t.success,[`mapping${n}_mappedPages`]:"number"==typeof t.mappedPageCount&&t.mappedPageCount>10?"10+":t.mappedPageCount})),{})})},mappingStats:e=>{this._sendFemetricsRate("gdocsMappingStats",e)},mappingPageStats:e=>{this._sendFemetricsRate("gdocsMappingPageStats",e)},mappingStatsByTextLength:e=>{this._sendFemetricsRate("gdocsMappingStatsByTextLength",e)},mappingPageStatsByTextLength:e=>{this._sendFemetricsRate("gdocsMappingPageStatsByTextLength",e)},mappingStatsByTableMode:e=>{this._sendFemetricsRate("gdocsMappingStatsByTableMode",e)},mappingPageStatsByTableMode:e=>{this._sendFemetricsRate("gdocsMappingPageStatsByTableMode",e)},mappingMinPageGapsStats:e=>{this._sendFemetricsRate("gdocsMappingMinPageGapsStats",e)},mappingMaxPageGapsStats:e=>{this._sendFemetricsRate("gdocsMappingMaxPageGapsStats",e)}},this.canvasGdocsSVG={error:y(((e,t,n,r,i)=>this._sendEvent({logger:"cs.gdocs.svg.error",level:fn.ERROR,message:t,extra:Fn({type:e,message:t,data:r},n),femetricsExtra:{type:e,mappingName:null==i?void 0:i.mappingName}})),(e=>e)),buildTextMapPerf:this._createPerfLogger("cs.gdocs.svg.perf.textMap",30)},this.gmailThreadContext={warning:y(((e,t,n)=>this._sendEvent({logger:"cs.threadContext.gmail.warning",level:fn.WARN,message:t,extra:{json:kn({type:e,message:t,data:n})}})),(e=>e))},this.readerGmail={warning:y(((e,t,n)=>this._sendEvent({logger:"cs.reader.gmail.warning",level:fn.WARN,message:t,extra:{json:kn({type:e,message:t,data:n})}})),(e=>e))},this.knowledgeHub={error:y(((e,t,n,r)=>this._sendEvent({logger:"cs.knowledgeHub.error",level:fn.ERROR,message:t,extra:{json:kn({type:e,message:t,domain:n,data:r})}})),(e=>e))},this.cheetah={info:y(((e,t,n)=>this._sendEvent({logger:"cs.cheetah.info",level:fn.INFO,message:e.name,extra:{json:kn({...e,sessionUuid:n,domain:t})},hideUserInfo:!0,sendToFemetrics:!0})),(e=>e.name)),error:y(((e,t,n)=>this._sendEvent({logger:"cs.cheetah.error",level:fn.ERROR,message:e.name,extra:{json:kn({...e,sessionUuid:n,domain:t})},hideUserInfo:!0,sendToFemetrics:!0})),(e=>e.name)),sessionRestartTimeout:(e,t,n)=>this._sendEvent({logger:"cs.cheetah.error",level:fn.ERROR,message:"sessionRestartTimeout",extra:{json:kn({name:"sessionRestartTimeout",sessionUuid:n,domain:t,waitingFor:e})},hideUserInfo:!0,sendToFemetrics:!0})},this._cbLog=e=>y(((t,n,r,i)=>this._sendEvent({logger:"cs.citationBuilder",level:e,citationBuilderExtra:r,message:n,extra:Fn(void 0,i)})),(e=>e)),this.citationBuilder={error:this._cbLog(fn.ERROR),warning:this._cbLog(fn.WARN),info:this._cbLog(fn.INFO)},this.performance={processInput:this._createPerfLogger("cs.fluid.processInput",100),processAlerts:this._createPerfLogger("cs.fluid.processAlerts",10),processFilterChange:this._createPerfLogger("cs.fluid.processFilterChange",10),csInitialized:(e,t,n,r,i)=>{this._createPerfLogger("cs.initialized").custom({_tag:wn.Data.Tagged.Types.csInit,domain:self.location.host,hideUserInfo:!0,loadTime:e,initTime:t,pageLoadTime:n,injectTime:r,error:i?{message:i.message,stack:i.stack}:void 0})},viewInjection:e=>{this._createPerfLogger("cs.viewInjection").custom({_tag:wn.Data.Tagged.Types.viewInjection,...e})}},this.autocorrect={responseTime:this._createPerfLogger("cs.autocorrect.responseTime",10),predictTime:this._createPerfLogger("cs.autocorrect.predictTime",10)},this.assistant={initTime:this._createPerfLogger("cs.assistant.initTime",1),renderTime:this._createPerfLogger("cs.assistant.renderTime",1),openTime:this._createPerfLogger("cs.assistant.openTime",1),alertManagerError:this._sendException({logger:"cs.assistant.alertManagerError",level:fn.ERROR})},this.attentionHeatmap={textChangeProcessingTime:this._createPerfLogger("cs.attentionHeatmap.textChangeProcessingTime",100),responseProcessingTime:this._createPerfLogger("cs.attentionHeatmap.responseProcessingTime",10),highlightUpdateTime:this._createPerfLogger("cs.attentionHeatmap.highlightUpdateTime",100),highlightGeometryUpdateTime:this._createPerfLogger("cs.attentionHeatmap.highlightGeometryUpdateTime",100),responseTime:this._createPerfLogger("cs.attentionHeatmap.responseTime",10),canvasRenderTime:this._createPerfLogger("cs.attentionHeatmap.canvasRenderTime",100)},this.proofit={availabilityQuotaError:e=>{this._sendEvent({logger:"cs.proofit.availability_quota_error",level:fn.ERROR,extra:{json:JSON.stringify(e)}})},submitResponseError:e=>{this._sendEvent({logger:"cs.proofit.submit_response_error",level:fn.ERROR,extra:{json:JSON.stringify(e)}})},progressError:e=>{this._sendEvent({logger:"cs.proofit.progress_error",level:fn.ERROR,extra:{json:JSON.stringify(e)}})},progressRejected:e=>{this._sendEvent({logger:"cs.proofit.progress_rejected",level:fn.WARN,extra:{json:JSON.stringify(e)}})}},this.oauthExchangeError=e=>{this._send("bg.oauth.exchange.error",fn.ERROR,{message:e})},this.chipmunkAPIError=e=>{this._send("bg.chipmunk.api.error",fn.ERROR,{message:e})},this.getIterableError=e=>{this._sendEvent({logger:"bg.iterable.api.error",level:fn.WARN,extra:{json:e},sendToFemetrics:!0})},this.getMiseError=e=>{this._sendEvent({logger:"bg.mise.api.token.error",level:fn.WARN,extra:{json:e},sendToFemetrics:!0})},this.alerts={inconsistentAlertWithText:e=>{this._sendFemetricsRate("inconsistentAlertWithText",{context:e})},cannotShowInlineCard:e=>{this._sendFemetricsRate("cannotShowInlineCard",{context:e})}},this.upgradeHooks={showUpgradeHook:(e,t)=>{this._sendFemetricsRate("showPremiumButton",{upgradeHookName:e,upgradeHookSlot:t})},clickUpgradeHook:(e,t)=>{this._sendFemetricsRate("clickPremiumButton",{upgradeHookName:e,upgradeHookSlot:t})}},this.upgradeHooksExp={upgradeHookExperimentPeek:(e,t,n)=>{this._sendFemetricsRate("upgradeHookExperiment",{experimentName:e,experimentGroup:t,domain:Tn(n)})},upgradeHookFirstHiddenPremiumAlertReceived:(e,t,n)=>{this._sendFemetricsRate("upgradeHookFirstHiddenPremiumAlertReceived",{experimentName:e,experimentGroup:t,domain:Tn(n)})},upgradeHookFirstSDUIReceivedFromCAPI:(e,t,n)=>{this._sendFemetricsRate("upgradeHookFirstSDUIReceivedFromCAPI",{experimentName:e,experimentGroup:t,domain:Tn(n)})},upgradeHookFeedRendered:(e,t,n)=>{this._sendFemetricsRate("upgradeHookFeedRenderedWithUpgradeCard",{experimentName:e,experimentGroup:t,domain:Tn(n)})},upgradeHookCardShown:(e,t,n)=>{this._sendFemetricsRate("upgradeHookCardShown",{experimentName:e,experimentGroup:t,domain:Tn(n)})}},this.createDocument=()=>{this._sendEvent({logger:"lib.bg.create.document",level:fn.INFO,sendToFemetrics:!0})},this.debugReports={downloadSuccessfuly:(e,t)=>{const n="debugReports.downloadSussessfyly",r=Wn(n,{envContext:e,downloadEnvContext:t});this._sendEvent({logger:n,level:fn.INFO,extra:{json:r},sendToFemetrics:!0})},downloadTimeout:(e,t)=>{const n="debugReports.downloadTimeout",r=Wn(n,{envContext:e,downloadEnvContext:t});this._sendEvent({logger:n,level:fn.WARN,extra:{json:r},sendToFemetrics:!0})},downloadError:(e,t)=>{const n="debugReports.downloadError",r=Wn(n,{envContext:e,downloadEnvContext:t});this._sendEvent({logger:n,level:fn.WARN,extra:{json:r},sendToFemetrics:!0})}}}_send(e,t,n){const r=Wn(e,n);try{this._sendFelog(e,String(null==n?void 0:n.message),t,n?{json:r}:void 0)}catch(t){Dn.warn(`Failed to send felog for ${e}: '${gn(t)?t.message:"undefined"}'`,t)}}_sendUsage(e,t,n){if(this._sendUsageMetrics&&this._sendUsageMetricsSamplingRatio>Math.random())try{this._sendFelogUsage(e,"",t,n)}catch(t){Dn.warn(`Failed to send usage felog for ${e}: '${gn(t)?t.message:"undefined"}'`,t)}}_sendSampled(e,t,n,r){e>Math.random()&&this._send(t,n,r)}_sendSampledEvent(e,t){e>Math.random()&&this._sendEvent(t)}_sendMetric(e,t){this._sendFelogMetricEvent({metricName:e,data:t})}sendCrashLogs(e,t){try{this._sendFelogCrashLogs(t)}catch(t){Dn.warn(`Failed to send crash data data for ${e}: '${gn(t)?t.message:"undefined"}'`,t)}}setUserInfo(e){this._setUserInfo(e)}setContainerId(e){this._setContainerId(e)}enableDataSharing(){this._enableDataSharing()}notificationShown(e){this._send("cs.notification.show",fn.INFO,{type:e})}notificationHide(e){this._send("cs.notification.hide",fn.INFO,{type:e})}}!function(e){let t;!function(e){e.fromPartial=e=>e}(t=e.Mock||(e.Mock={}))}(Vn||(Vn={}));class Gn{constructor(e,t,n=_){this.name=e,this._source=t,this._saveAction=n,this.dummy=!1,this.data=[],this.customBuffer=[],this._flush=()=>{this.data.push(...this._source.flushMeasures(this.name)),this._saveAction(this.data)},this.custom=e=>{this.customBuffer.push(e)},this.startMeasure=()=>{const e=this._source.startMeasure(this.name),t=()=>this._flush();return{endMeasure(){try{const n=e.endMeasure();return t(),n}catch(e){return}},cancelMeasure:()=>e.cancelMeasure()}},this.measure=e=>{const t=this._source.measure(this.name,e);try{this._flush()}catch(e){}return t},this.measureAsync=e=>{const t=this._source.startMeasure(this.name);return e().then((e=>{try{t.endMeasure(),this._flush()}catch(e){}return e}))}}getStats(){return this.data.length>0?{...wn.getStats(this.data),median:(e=this.data,mn(e,.5)),p90:mn(this.data,.9),p99:mn(this.data,.99)}:{};var e}}class qn{constructor(e){this._perf=e,this._log=Xt.create("cs.telemetry.PerformanceMetricsImpl")}flushMeasures(e){try{const t=this._perf.getEntriesByName(e,"measure");return this._perf.clearMeasures(e),t.map((e=>e.duration))}catch(e){return this._log.warn("failed to retrieve perf measurements",e),[]}}startMeasure(e){const t=Math.random(),n=`__${e}_${t}-start`,r=`__${e}_${t}-end`;try{this._perf.mark(n)}catch(e){return this._log.warn("could not start measure – ignoring measurement",e),{endMeasure:()=>{},cancelMeasure:_}}let i=!1;return{endMeasure:()=>{if(!i){i=!0;try{return this._perf.mark(r),this._perf.measure(e,n,r),this._perf.getEntriesByName(e,"measure")[0]}catch(e){return void this._log.warn("could not complete measure",e)}}},cancelMeasure:()=>{this._perf.clearMarks(n),this._perf.clearMarks(r)}}}measure(e,t){const n=`__${e}-start`,r=`__${e}-end`;try{this._perf.mark(n)}catch(e){return this._log.warn("could not start measure – ignoring measurement",e),t()}try{return t()}finally{try{this._perf.mark(r),this._perf.measure(e,n,r)}catch(e){this._log.warn("could not complete measure",e)}}}}!function(e){e.create=function(t){return void 0!==t?new e(t):yn.dummy}}(qn||(qn={}));const zn=Xt.create("tracking.telemetry.performance.felog");class Kn{constructor(e,t,n,r=0,i=6e4){this.name=e,this._sendMetrics=t,this._source=n,this._minBufferSize=r,this._throttleTimeMs=i,this.dummy=!1,this._buffer=[],this._flush=function(e,t){let n,r,i=!0;function s(e,n){return i&&(i=!1,r=c(),setTimeout((()=>{try{r.resolve(t(...n))}catch(e){r.reject(e)}finally{i=!0}}),e)),r.promise}return(...t)=>{const r=n;return n=Date.now(),s(void 0===r||n-r>=e?0:e-(n-r),t)}}(this._throttleTimeMs,(()=>{if(this._buffer.push(...this._source.flushMeasures(this.name)),this._buffer.length>=this._minBufferSize){const e=wn.getStats(this._buffer);this._buffer=[],zn.info(`sending perf stats for ${this.name}`,e),this._sendMetrics(this.name,{_tag:wn.Data.Tagged.Types.stats,...e})}})),this.custom=e=>{this._sendMetrics(this.name,e)},this.startMeasure=()=>{const e=this._source.startMeasure(this.name),t=()=>this._flush();return{endMeasure(){try{const n=e.endMeasure();return t(),n}catch(e){return}},cancelMeasure:()=>e.cancelMeasure()}},this.measure=e=>{const t=this._source.measure(this.name,e);try{this._flush()}catch(e){}return t},this.measureAsync=e=>{const t=this._source.startMeasure(this.name);return e().then((e=>{try{t.endMeasure(),this._flush()}catch(e){}return e}))}}}Xt.create("lib.tracking.logger");let Jn;function Yn(){if(!Jn){const e=dn().telemetryCallProvider;Jn=new Vn(e.sendFelog,e.sendFelogUsageEvent,e.setUserInfo,e.setContainerId,X().appConfig.felog.sendUsageMetrics,function(){const e=X().appConfig.felog.sendPerfMetricsType;return"local"===e?(t=qn.create(self.performance),e=>e=>{const n=self.__GR_PERFORMANCE_STORE__||{};if(self.__GR_PERFORMANCE_STORE__=n,e in n)return n[e];{const r=new Gn(e,t);return n[e]=r,r}}):((e,t,n=6e4)=>r=>(i,s)=>e?new Kn(i,r,t,s,n):vn.dummy())("send"===e,qn.create(self.performance));var t}(),e.sendFelogEvent,e.sendFelogCrashLogs,void 0,(()=>{var t;return null===(t=e.enableDataSharing)||void 0===t?void 0:t.call(e)}),void 0,e.sendFelogMetricEvent,e.sendFemetricsRate,e.startFemetricsTimer,e.endFemetricsTimer,e.sendFemetricsTimer)}return Jn}function Xn(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new Qn(e,t))}}var Qn=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new Zn(e,this.project,this.thisArg))},e}(),Zn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return Ae(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(De);function er(e,t,n,r){return Re(n)&&(r=n,n=void 0),r?er(e,t,n).pipe(Xn((function(e){return Pe(e)?r.apply(void 0,e):r(e)}))):new Ve((function(r){tr(e,t,(function(e){arguments.length>1?r.next(Array.prototype.slice.call(arguments)):r.next(e)}),r,n)}))}function tr(e,t,n,r,i){var s;if(function(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(e)){var o=e;e.addEventListener(t,n,i),s=function(){return o.removeEventListener(t,n,i)}}else if(function(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}(e)){var a=e;e.on(t,n),s=function(){return a.off(t,n)}}else if(function(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(e)){var c=e;e.addListener(t,n),s=function(){return c.removeListener(t,n)}}else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var u=0,l=e.length;u<l;u++)tr(e[u],t,n,r,i)}r.add(s)}var nr=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return Ae(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,r=void 0;try{this.work(e)}catch(e){n=!0,r=!!e&&e||new Error(e)}if(n)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,n){return e.call(this)||this}return Ae(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(Le)),rr=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),ir=function(e){function t(n,r){void 0===r&&(r=rr.now);var i=e.call(this,n,(function(){return t.delegate&&t.delegate!==i?t.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return Ae(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(rr),sr=new ir(nr);function or(e,t){var n;return void 0===e&&(e=0),void 0===t&&(t=sr),(Pe(n=e)||!(n-parseFloat(n)+1>=0)||e<0)&&(e=0),t&&"function"==typeof t.schedule||(t=sr),new Ve((function(n){return n.add(t.schedule(ar,e,{subscriber:n,counter:0,period:e})),n}))}function ar(e){var t=e.subscriber,n=e.counter,r=e.period;t.next(n),this.schedule({subscriber:t,counter:n+1,period:r},r)}var cr=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),ur=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),lr=new Ve((function(e){return e.complete()}));function dr(e){return e?function(e){return new Ve((function(t){return e.schedule((function(){return t.complete()}))}))}(e):lr}function hr(e){return function(t){return 0===e?dr():t.lift(new pr(e))}}var pr=function(){function e(e){if(this.total=e,this.total<0)throw new ur}return e.prototype.call=function(e,t){return t.subscribe(new fr(e,this.total))},e}(),fr=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return Ae(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(De);function gr(e){return void 0===e&&(e=null),function(t){return t.lift(new mr(e))}}var mr=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new br(e,this.defaultValue))},e}(),br=function(e){function t(t,n){var r=e.call(this,t)||this;return r.defaultValue=n,r.isEmpty=!0,r}return Ae(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(De);function _r(e){return void 0===e&&(e=wr),function(t){return t.lift(new vr(e))}}var vr=function(){function e(e){this.errorFactory=e}return e.prototype.call=function(e,t){return t.subscribe(new yr(e,this.errorFactory))},e}(),yr=function(e){function t(t,n){var r=e.call(this,t)||this;return r.errorFactory=n,r.hasValue=!1,r}return Ae(t,e),t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)},t}(De);function wr(){return new cr}function xr(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?lt((function(t,n){return e(t,n,r)})):$e,hr(1),n?gr(t):_r((function(){return new cr})))}}var Er=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new Sr(e,this.value))},e}(),Sr=function(e){function t(t,n){var r=e.call(this,t)||this;return r.value=n,r}return Ae(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(De);function Ir(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return Lt(n)?(e.pop(),qt(e,n)):zt(e)}function Tr(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[He]}(e))return function(e,t){return new Ve((function(n){var r=new Le;return r.add(t.schedule((function(){var i=e[He]();r.add(i.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}(e,t);if(Wt(e))return function(e,t){return new Ve((function(n){var r=new Le;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}(e,t);if($t(e))return qt(e,t);if(function(e){return e&&"function"==typeof e[Ht]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new Ve((function(n){var r,i=new Le;return i.add((function(){r&&"function"==typeof r.return&&r.return()})),i.add(t.schedule((function(){r=e[Ht](),i.add(t.schedule((function(){if(!n.closed){var e,t;try{var i=r.next();e=i.value,t=i.done}catch(e){return void n.error(e)}t?n.complete():(n.next(e),this.schedule())}})))}))),i}))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}function Ar(e,t){return t?Tr(e,t):e instanceof Ve?e:new Ve(Vt(e))}var Rr=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,n}return Ae(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(De),kr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ae(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(De);function Fr(e,t){if(!t.closed)return e instanceof Ve?e.subscribe(t):Vt(e)(t)}function Or(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(r){return r.pipe(Or((function(n,r){return Ar(e(n,r)).pipe(Xn((function(e,i){return t(n,e,r,i)})))}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new Cr(e,n))})}var Cr=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new Pr(e,this.project,this.concurrent))},e}(),Pr=function(e){function t(t,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=e.call(this,t)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return Ae(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t)},t.prototype._innerSub=function(e){var t=new Rr(this),n=this.destination;n.add(t);var r=Fr(e,t);r!==t&&n.add(r)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(kr);function Nr(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),Or($e,e)}function Mr(){return Nr(1)}function Lr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Mr()(Ir.apply(void 0,e))}function Ur(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return Lt(n)?(e.pop(),function(t){return Lr(e,t,n)}):function(t){return Lr(e,t)}}function jr(e,t){return function(n){return n.lift(new Dr(e,t))}}var Dr=function(){function e(e,t){this.compare=e,this.keySelector=t}return e.prototype.call=function(e,t){return t.subscribe(new Br(e,this.compare,this.keySelector))},e}(),Br=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.keySelector=r,i.hasKey=!1,"function"==typeof n&&(i.compare=n),i}return Ae(t,e),t.prototype.compare=function(e,t){return e===t},t.prototype._next=function(e){var t;try{var n=this.keySelector;t=n?n(e):e}catch(e){return this.destination.error(e)}var r=!1;if(this.hasKey)try{r=(0,this.compare)(this.key,t)}catch(e){return this.destination.error(e)}else this.hasKey=!0;r||(this.key=t,this.destination.next(e))},t}(De);class Hr{constructor(){this._storage=this._storage||{}}get _storage(){return self.__CS_SHARE_STORAGE__}set _storage(e){self.__CS_SHARE_STORAGE__=e}clean(){this._storage={}}set(e,t){this._storage[e]=t}get(e){return this._storage[e]}getOnce(e){const t=this._storage[e];return this.remove(e),t}remove(e){delete this._storage[e]}}var $r,Wr,Vr,Gr;!function(e){e.syncDevtoolsInitialStateWithTab="syncDevtoolsInitialStateWithTab"}($r||($r={})),function(e){class t extends Error{constructor(e,t=1e3){super(`SafePromiseError: ${e}`),this.stack=(super.stack||"").slice(t)}}function n(e){return e.catch((e=>e instanceof Error&&!e.stack?Promise.reject(new t(e.message)):Promise.reject(e)))}e.fromPromise=n,e.fromAsync=function(e){return(...t)=>n(e(...t))},e.noop=e.fromPromise(Promise.resolve()),e.create=function(e){return n(new Promise(e))},e.sync=function(e){return n(new Promise(((t,n)=>t(e()))))},e.createCompletionSource=c,e.delay=a}(Wr||(Wr={}));class qr{constructor(e,t){this._transport=e,this._log=t,this._calls=new Map,this._sub=this._transport.inbound.subscribe((e=>{var t;const n=this._calls.get(e.id);if(n)try{"err"in e?n.reject(e.err):n.resolve(e.res)}finally{this._calls.delete(e.id)}else null===(t=this._log)||void 0===t||t.warn(`received rpc call response for unregistered call ${e.id}`)})),this.api=new Proxy({},{get:(e,t)=>"then"===t?void 0:(...e)=>this._handleCall(t,e)})}_handleCall(e,t){let n=x.create();for(;this._calls.has(n);)n=x.create();const r=Wr.createCompletionSource();return this._calls.set(n,r),this._transport.outbound({id:n,method:e,args:t}),r.promise}dispose(){this._sub.unsubscribe()}}class zr{constructor(e,t,n=x.create(),r=e){this._rpcMessageName=e,this._message=t,this._clientId=n,this._inboundMessageName=r,this.inbound=new Ve((e=>{const t=t=>{t.clientId===this._clientId&&e.next(t.data)};return this._message.on(this._inboundMessageName,t),()=>this._message.off(this._inboundMessageName,t)})),this.outbound=e=>{this._message.sendBackground(this._rpcMessageName,{clientId:this._clientId,data:e})}}}class Kr extends qr{constructor(e){super(new zr("cs-to-bg-rpc-1557421403805",e))}}function Jr(e){return"tunnel"!==e.tag}!function(e){e.rpcLegacyMessageName="cs-to-bg-rpc-1587687052565",e.rpcLegacyObservableName="cs-to-bg-observable-rpc-1587687052565"}(Vr||(Vr={})),function(e){e.isSubscribe=e=>"action"in e.data&&"subscribe"===e.data.action,e.isUnsubscribe=e=>"action"in e.data&&"unsubscribe"===e.data.action,e.isDispose=e=>"action"in e.data&&"dispose"===e.data.action,e.isPong=e=>"pong"in e.data,e.isPing=e=>"ping"in e.data,e.isObservableResult=e=>"subscribableId"in e}(Gr||(Gr={}));const Yr=Symbol();var Xr,Qr;function Zr(e){return e instanceof Ve?e:new Ve((t=>e.subscribe(t)))}!function(e){e.measure=e=>t=>new Ve((n=>t.subscribe((t=>e((()=>n.next(t)))),(e=>n.error(e)),(()=>n.complete())))),e.using=(e,t)=>function(e,t){return new Ve((function(n){var r,i;try{r=e()}catch(e){return void n.error(e)}try{i=t(r)}catch(e){return void n.error(e)}var s=(i?Ar(i):lr).subscribe(n);return function(){s.unsubscribe(),r&&r.unsubscribe()}}))}(e,t),e.doNothing=e=>e}(Xr||(Xr={}));class ei{constructor(e,t,n=Xt.create(ei.name),r){this._transport=e,this._observableTransport=t,this._log=n,this._serverId=r,this._calls=new Map,this._subscribeRelatedCalls=new Map,this._observables=new Map,this._subscribers=new Map,this._transportSubscription=Zr(this._transport.inbound).pipe(lt(Jr)).subscribe((e=>{this._processResponse(e)})),this._observableTransportSubscription=Zr(this._observableTransport.inbound).pipe(lt(Jr)).subscribe((e=>{this._processObservableMessage(e)})),this.api=new Proxy({},{get:(e,t)=>"then"===t?void 0:(...e)=>this._handleCall(t,e)})}_processResponse(e){const t=this._calls.get(e.id);if(t)try{if("err"in e)t.reject(e.err);else if(Gr.isObservableResult(e))try{const n=new Ve((t=>this._createSubscribeHandler(e.subscribableId,t)));this._observables.set(e.subscribableId,n),t.resolve(n)}catch(t){this._observables.delete(e.subscribableId)}else t.resolve(this.transformResult(e.res))}finally{this._calls.delete(e.id)}else this._log.warn(`received rpc call response for unregistered call ${e.id}`)}transformResult(e){return e}_processObservableMessage(e){if("subscribed"in e){const t=this._subscribeRelatedCalls.get(e.id);if(t)try{t.resolve()}finally{this._subscribeRelatedCalls.delete(e.id)}else this._log.warn(`received rpc call subscribed response for unregistered subscribe call ${e.id}`)}else if("unsubscribed"in e){const t=this._subscribeRelatedCalls.get(e.id);if(t)try{t.resolve()}finally{this._subscribeRelatedCalls.delete(e.id),this._subscribers.delete(e.id)}else this._log.warn(`received rpc call unsubscribed response for unregistered unsubscribe call ${e.id}`)}else if("next"in e)try{const t=this._subscribers.get(e.subscriptionId);t?t.subscriber.next(e.next):this._log.warn(`received observable next message for unregistered subscription ${e.subscriptionId}`)}catch(t){this._subscribers.delete(e.subscriptionId)}else if("complete"in e)try{const t=this._subscribers.get(e.subscriptionId);t?(t.subscriber.complete(),this._subscribers.delete(e.subscriptionId)):this._log.warn(`received observable complete for unregistered subscription ${e.subscriptionId}`)}catch(t){this._subscribers.delete(e.subscriptionId)}else if("err"in e)try{const t=this._subscribers.get(e.subscriptionId);t?t.subscriber.error(e.err):this._log.warn(`received observable error for unregistered subscription  ${e.subscriptionId}`)}finally{this._subscribers.delete(e.subscriptionId)}else if("subErr"in e){const t=this._subscribeRelatedCalls.get(e.id);try{const n=this._subscribers.get(e.id);n?n.subscriber.error(e.subErr):this._log.warn(`received subscription error response for unregistered call ${e.id}`)}finally{t&&(t.reject(e.subErr),this._subscribeRelatedCalls.delete(e.id)),this._observables.delete(e.subscribableId),this._subscribers.delete(e.id)}}else if("ping"in e)try{this._observables.get(e.ping)?this._observableTransport.outbound({pong:e.ping}):this._log.warn(`received ping for unregistered observable ${e.ping}`)}finally{}}_handleCall(e,t){let n=x.create();for(;this._calls.has(n);)n=x.create();const r=Wr.createCompletionSource();this._calls.set(n,r);const i=t.map((e=>{return t=e,Boolean(t)&&t._tag===Yr?e.toJSON():e;var t}));return this._transport.outbound({id:n,method:e,args:i,serverId:this._serverId}),r.promise}_createSubscribeHandler(e,t){let n=x.create();for(;this._subscribeRelatedCalls.has(n);)n=x.create();const r=Wr.createCompletionSource();return this._subscribeRelatedCalls.set(n,r),this._observableTransport.outbound({id:n,subscribableId:e,action:"subscribe"}),this._subscribers.set(n,{subscribableId:e,subscriber:t}),()=>{this._handleUnsubscribe(n,e)}}_handleUnsubscribe(e,t){let n=x.create();for(;this._subscribeRelatedCalls.has(n);)n=x.create();const r=Wr.createCompletionSource();return this._subscribeRelatedCalls.set(n,r),this._observableTransport.outbound({id:n,subscriptionId:e,subscribableId:t,action:"unsubscribe"}),this._subscribers.delete(e),r.promise}dispose(){for(const e of this._observables.keys())this._observableTransport.outbound({id:x.create(),subscribableId:e,action:"dispose"});this._observables.clear(),this._transportSubscription.unsubscribe(),this._observableTransportSubscription.unsubscribe(),this._calls.clear(),this._subscribeRelatedCalls.clear()}}class ti extends ei{constructor(e){super(new zr(Vr.rpcLegacyMessageName,e),new zr(Vr.rpcLegacyObservableName,e))}}!function(e){e.rpcLegacyMessageName="cs-to-bg-static-capi-rpc-1668544923207",e.rpcLegacyObservableName="cs-to-bg-static-capi-observable-rpc-1668544923207"}(Qr||(Qr={}));class ni extends ei{constructor(e){super(new zr(Qr.rpcLegacyMessageName,e),new zr(Qr.rpcLegacyObservableName,e))}}class ri extends ln{static getInstance(){if(void 0===this._instanceCSShared)throw new Error("Env not inited yet");return this._instanceCSShared}static get isInited(){return void 0!==this._instanceCSShared}static initShared(e){if(void 0!==this._instanceCSShared)throw new Error("Env already inited");this._instanceCSShared=e,ln.initShared(e)}}function ii(){return ri.getInstance()}const si=Xt.create("extension-api");class oi{constructor(e){this._baseApi=e,this._log=Xt.create(oi.name),this._initializedListenerEvents=new Set,this._listeners={},this._logError=e=>{this._log.error(`${oi.name} handle an error: ${e.message}`)},this.on=(e,t)=>{var n;this._listeners[e]=null!==(n=this._listeners[e])&&void 0!==n?n:[],this._listeners[e].push(t),this._initializedListenerEvents.has(e)||(this._initializedListenerEvents.add(e),this._baseApi.listen(e,((...t)=>{var n;const r=null!==(n=this._listeners[e])&&void 0!==n?n:[];for(const e of r)try{e(...t)}catch(e){this._logError(e)}})))},this.once=(e,t)=>{const n=(...r)=>{this.off(e,n);try{t(...r)}catch(e){this._logError(e)}};this.on(e,n)},this.off=(e,t)=>{if(!this._listeners[e])return;const n=this._listeners[e].indexOf(t);-1!==n&&this._listeners[e].splice(n,1),0===this._listeners[e].length&&delete this._listeners[e]}}}class ai extends oi{constructor(e){super(e),this._api=e,this.sendBackground=(e,t)=>{try{this._api.broadcastBackground(e,t)}catch(e){this._logError(e)}}}}const ci="tracking/RPC";class ui extends ri{static get isInited(){return void 0!==this._instance}static getInstance(){if(void 0===this._instance)throw new Error("Env not inited yet");return this._instance}static init(e){if(void 0!==this._instance)throw new Error("Env already inited");const t=new ui(e);return this._instance=t,ri.initShared(t),t.browserApi.message.start&&t.browserApi.message.start(),t}constructor(e){var t;super({browser:e.browser,extensionType:e.extensionType,deploymentType:e.deploymentType,context:"cs",historyLoggerExtraArgs:{enableHistoryLoggerUntil:e=>{var t;null===(t=this.bgRpc)||void 0===t||t.api.enableHistoryLoggerUntil(e)},getBGLogs:()=>{var e;return null===(e=this.bgRpc)||void 0===e?void 0:e.api.getBGLogs()},disableHistoryLogger:()=>{var e;null===(e=this.bgRpc)||void 0===e||e.api.disableHistoryLogger()}}}),this.browserApi=e.browserApi,this.message=new ai(e.browserApi.message),e.skipInitExtensionApi||(t=e.browserApi,self.extensionContentScriptApi&&si.warn("Content Script Extension Api init called more than once"),self.extensionContentScriptApi=self.extensionContentScriptApi||t),this.bgRpc=new Kr(this.message),this.csShareStorage=new Hr,this.capiBgRpc=new ti(this.message),this.staticCapiBgRpc=new ni(this.message),this.telemetryCallProvider=function(e,t=Xt.create("lib.tracking.call.transport")){return new Proxy({},{get:(n,r)=>{if("enableDataSharing"!==r)return(...n)=>{Promise.race([e.api.trackCall(ci,[r,...n]).then((()=>null)),a(1e4).then((()=>new Error("timeout call through bg page")))]).then((e=>e&&t.warn("tracking call timeout",e))).catch((e=>t.warn("tracking call failed, reason:",e)))}}})}(this.bgRpc)}}const li=2147483642;var di;!function(e){function t(e,t){try{for(const n of Object.keys(t))if(t[n]&&t[n](e))return n;return null}catch(e){return null}}e.isSpecific={draftJs:e=>!(!e.hasAttribute("contenteditable")||!e.querySelector('[data-contents="true"] > [data-editor], [data-block]')),quill:e=>e.classList.contains("ql-editor")||e.classList.contains("ql-container"),redactor:e=>e.className.indexOf("redactor")>-1,prosemirror:e=>e.hasAttribute("pm-container")||e.classList.contains("ProseMirror"),scribe:e=>e.className.indexOf("scribe")>-1,trix:e=>e.className.indexOf("trix")>-1,"medium-editor":e=>e.className.indexOf("medium-editor")>-1,tinymce:e=>{if("IFRAME"!==e.tagName)return!1;const t=e;return t.id.indexOf("mce")>-1||!!(t.contentDocument&&t.contentDocument.querySelectorAll("#tinymce, .mce-content-body").length>0)},ckeditor4:e=>e.matches("iframe.cke_wysiwyg_frame")||e.classList.contains("cke_editable"),ckeditor5:e=>e.classList.contains("ck-editor__editable"),slate:e=>"true"===e.getAttribute("data-slate-editor"),mobiledoc:e=>e.classList.contains("__mobiledoc-editor")},e.isGeneric={contenteditable:e=>{const t=e.attributes.getNamedItem("contenteditable");return!(!function(e){return!(e instanceof HTMLSelectElement)}(e)||!t||"true"!==t.value&&""!==t.value&&"plaintext-only"!==t.value)},textarea:e=>"TEXTAREA"===e.tagName,iframe:t=>{if("IFRAME"===t.tagName){const n=t;return!!(n.contentDocument&&n.contentDocument.body&&e.isGeneric.contenteditable(n.contentDocument.body))}return!1},iframeHost:t=>{if("IFRAME"===t.tagName){const n=t;return!(n.contentDocument&&n.contentDocument.body&&e.isGeneric.contenteditable(n.contentDocument.body))}return!1}},e.get=function(n){return{generic:t(n,e.isGeneric),specific:t(n,e.isSpecific)}}}(di||(di={}));var hi=1,pi=function(){return Promise.resolve()}(),fi={};function gi(e){return e in fi&&(delete fi[e],!0)}var mi,bi=function(e){var t=hi++;return fi[t]=!0,pi.then((function(){return gi(t)&&e()})),t},_i=function(e){gi(e)},vi=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return Ae(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=bi(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(_i(n),t.scheduled=void 0)},t}(nr),yi=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ae(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(ir))(vi);function wi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Number.POSITIVE_INFINITY,r=null,i=e[e.length-1];return Lt(i)?(r=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(n=e.pop())):"number"==typeof i&&(n=e.pop()),null===r&&1===e.length&&e[0]instanceof Ve?e[0]:Nr(n)(zt(e,r))}function xi(e,t,n){return n?xi(e,t).pipe(Xn((function(e){return Pe(e)?n.apply(void 0,e):n(e)}))):new Ve((function(n){var r,i=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.next(1===e.length?e[0]:e)};try{r=e(i)}catch(e){return void n.error(e)}if(Re(t))return function(){return t(i,r)}}))}function Ei(e){var t=e.error;e.subscriber.error(t)}mi||(mi={});var Si=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){var e,t;switch(this.kind){case"N":return Ir(this.value);case"E":return e=this.error,new Ve(t?function(n){return t.schedule(Ei,0,{error:e,subscriber:n})}:function(t){return t.error(e)});case"C":return dr()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}();function Ii(e,t){return void 0===t&&(t=0),function(n){return n.lift(new Ai(e,t))}}var Ti,Ai=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new Ri(e,this.scheduler,this.delay))},e}(),Ri=function(e){function t(t,n,r){void 0===r&&(r=0);var i=e.call(this,t)||this;return i.scheduler=n,i.delay=r,i}return Ae(t,e),t.dispatch=function(e){var t=e.notification,n=e.destination;t.observe(n),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new ki(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(Si.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(Si.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(Si.createComplete()),this.unsubscribe()},t}(De),ki=function(){return function(e,t){this.notification=e,this.destination=t}}();function Fi(e,t){return Or(e,t,1)}function Oi(e,t){var n,r,i;const s=null===(i=null===(r=null===(n=null==t?void 0:t.citationBuilder)||void 0===n?void 0:n.domains)||void 0===r?void 0:r[e])||void 0===i?void 0:i.disabled;return void 0!==s?!s:void 0}function Ci(e,t){return Ui(t).some((t=>new RegExp(t.domain).test(e)))}function Pi(e){var t,n;return!(null!==(n=null===(t=e.citationBuilder)||void 0===t?void 0:t.disabled)&&void 0!==n&&n)}function Ni(e,t){return Ui(t).some((t=>{const n=new RegExp(t.domain),r=new RegExp(t.pathname);return n.test(e.hostname)&&r.test(e.pathname)}))}function Mi(e,t,n){const r=Oi(e,n);return Pi(t)&&(void 0===r&&Ci(e,t)||!0===r)}!function(e){const t=Xt.create("universal.cs.integration.observables"),n=e=>er(e,"focus",{capture:!0});function r(e){return e instanceof Element&&e.shadowRoot&&e.shadowRoot.activeElement?r(e.shadowRoot.activeElement):e}function i(e,t){return{document:e,frame:t}}e.createFocusObservable=function(e,s,o=n){return function(e,n){const r=i(e),s=Ar(e.getElementsByTagName("iframe")),o=n.pipe(Fi((e=>Array.from(e.addedNodes))),lt((e=>"IFRAME"===e.nodeName)));return Lr(s,o).pipe(lt((n=>function(e,n){try{const t=e.src;if(t&&"about:blank"!==t&&!t.startsWith("javascript")){return new URL(t,n.baseURI).origin===n.location.origin}return!0}catch(e){return t.warn("Error converting iframe's src to url",e),!0}}(n,e))),Or((e=>{try{return function(e){const t=e.contentDocument;return t&&"complete"===t.readyState}(e)?Ir(e):xi((t=>e.addEventListener("load",t,!0)),(t=>e.removeEventListener("load",t))).pipe(Xn((()=>e)),hr(1))}catch(e){return t.warn("failed to receive iframes document",e),Ir(null)}})),Xn((e=>{try{if(null!==e&&null!==e.contentDocument)return i(e.contentDocument,e)}catch(e){t.warn("failed to receive iframes document",e)}return null})),lt((e=>null!==e))).pipe(Ur(r))}(e,s).pipe(Or((e=>function(e,t,n){const i=e.document,s=or(re),o=e.frame?lr:(l=()=>Ir(i.activeElement).pipe(lt((e=>e&&i.defaultView&&i.defaultView.HTMLElement&&e instanceof i.defaultView.HTMLElement))),new Ve((function(e){var t;try{t=l()}catch(t){return void e.error(t)}return(t?Ar(t):dr()).subscribe(e)}))),a=t(i).pipe(Xn((e=>e.target))),c=e.frame?lr:wi(s,n).pipe(lt((e=>!!i.defaultView&&"visible"===i.visibilityState&&!!i.activeElement)),Xn((e=>i.activeElement)),jr()),u=wi(c,a).pipe(lt((e=>i.defaultView&&i.defaultView.HTMLElement&&e instanceof i.defaultView.HTMLElement)),Xn((e=>r(e))));var l;return Lr(o,u).pipe(jr())}(e,o,s).pipe(Xn((t=>({element:t,owner:e})))))),jr(),Ii(yi))},e.docInfo=i}(Ti||(Ti={}));const Li={name:"samples.extension.grammarlyaws.com",domain:"^samples.extension.grammarlyaws.com$",pathname:".*"};function Ui(e){var t,n;return(null!==(n=null===(t=e.citationBuilder)||void 0===t?void 0:t.sources)&&void 0!==n?n:[]).concat(Li)}v((()=>Sn(document.location.href))),v((e=>{const t=document.location.href;return{url:t,domain:Sn(t),isUrlAllowlisted:Ni(document.location,e)}})),v((()=>x.create()));var ji,Di;!function(e){function t(e,t){if(!e||!t)return!0;return!t.includes(e)}function n(e,t){var n;return Boolean((null==t?void 0:t.isDesktopIntegrationEnabled)&&(null===(n=e.llamaIntegration)||void 0===n?void 0:n.enabled))}function r(e,n,r,i){var s,o;const a=i?Sn(i):void 0,c=n.isLlamaInstalled&&(null===(s=r.llamaIntegration)||void 0===s?void 0:s.enabled);return t(a,null===(o=r.llamaIntegration)||void 0===o?void 0:o.disabledByDomain)&&(c||"true"===e.showDesktopIntegrationExtensionToggle)}e.isEnabled=n,e.showSettingPopupToggle=r,e.showGrayGButton=function(e,t,i,s){return r(t,e,i,s)&&n(i,e)},e.isIntegrationEnabled=function(e,r,i){var s;return!(!e||!i)&&(t(r,null===(s=i.llamaIntegration)||void 0===s?void 0:s.disabledByDomain)&&n(i,e))}}(ji||(ji={})),function(e){e.full="full",e.limited="limited"}(Di||(Di={}));const Bi="grammarly-desktop-integration";var Hi,$i;!function(e){class t{get integration(){if(this._integration)return this._integration;return Boolean(document.querySelector(Bi))?(this._log.debug("hidden field is already initialized"),null):(this._integration=function(e=Bi){var t,n;const r=`\n  div.${e} {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    padding: 0;\n    margin: -1px;\n    overflow: hidden;\n    clip: rect(0, 0, 0, 0);\n    white-space: nowrap;\n    border: 0;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select:none;\n    user-select:none;\n  }\n\n  div.${e}:before {\n    content: attr(data-content);\n  }\n`,i=document.createElement("style");i.textContent=r;const s=document.createElement("div");s.setAttribute("aria-label","grammarly-integration"),s.setAttribute("role","group"),s.setAttribute("tabindex","-1"),s.setAttribute("class",e);const o=document.createElement(e);return o.attachShadow({mode:"open"}),o.setAttribute("data-grammarly-shadow-root","true"),null===(t=o.shadowRoot)||void 0===t||t.appendChild(i),null===(n=o.shadowRoot)||void 0===n||n.appendChild(s),document.documentElement.appendChild(o),{activate:(e,t,n)=>{null==s||s.setAttribute("data-content",JSON.stringify(t?{mode:t,isActive:e,isUserDisabled:n}:{isActive:e}))},remove:()=>{var e;null===(e=null==o?void 0:o.parentNode)||void 0===e||e.removeChild(o)}}}(Bi),this._log.debug("new field is injected"),this._integration)}constructor(){this._integration=null,this._state=Yt.create(null),this._log=Xt.create(t.name),this._state.pipe(lt(Boolean)).subscribe((e=>{this._log.debug("update hiden field state",e)}))}updateState(e,t,n,r){var i;const s=!ji.isIntegrationEnabled(r,e,t),o=ji.isEnabled(t,r)?Di.limited:Di.full,a=!n;this._state.set({isActive:s,mode:o,isUserDisabled:a}),a?this.dispose():null===(i=this.integration)||void 0===i||i.activate(s,o,a)}dispose(){this._integration&&(this._integration.remove(),this._integration=null)}}e.init=function(){return new t}}(Hi||(Hi={})),function(e){function t(e,t){return n(e,t).pipe(ut(),Ii(yi))}function n(e,t){return new Ve((n=>{const r=new MutationObserver((e=>n.next(e)));return r.observe(e,t),()=>r.disconnect()}))}e.create=t,e.createUnsafe=n,e.createFlattenHot=function(e,t){return n(e,t).pipe(Fi((e=>e)),ut())},e.observeAttribute=function(e,n){return t(e,{attributes:!0,attributeFilter:[n],subtree:!1,childList:!1}).pipe(Xn((t=>e.getAttribute(n))))},e.observeStyle=function(e){return t(e,{attributes:!0,attributeFilter:["style"],subtree:!1,childList:!1}).pipe(Xn((t=>e.style)))},e.observeChildList=function(e){return t(e,{attributes:!1,subtree:!1,childList:!0}).pipe(Xn((t=>e.childNodes)))}}($i||($i={}));const Wi="data-enable-grammarly",Vi=["data-gramm_editor","data-gramm","data-gramm_id","gramm_editor","readonly","disabled"],Gi=["pm-container",{name:"class",value:"ProseMirror"},"data-synchrony",{name:"data-gramm",value:"false"},{name:Wi,value:"false"},{name:"aria-label",value:"Search Facebook"}],qi=["changed-user","changed-plan","changed-dialect","cleanup","editor-fix","llama-action"];function zi(e,t){let n=e.parentNode;for(;null!==n;){if(Ji(n,t))return n;n=n.parentNode}return!1}function Ki(e){return"true"===e.contentEditable||"plaintext-only"===e.contentEditable}function Ji(e,t){if(!e)return!1;const n=e.matches||e.msMatchesSelector||e.matchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector;return!!n&&n.apply(e,[t])}function Yi(e,t=null,n){return this.addEventListener(e,t,n),{off:()=>Xi.apply(this,[e,t,n])}}function Xi(e,t,n){this.removeEventListener(e,t||null,n)}var Qi,Zi,es,ts,ns;!function(e){e.init=function(e,t){const n=Xt.create("lib.external");!function(e,t,n,r=document,i=!1,s=!1,o,a){const c=e,u=r.documentElement;if(i){const e=r.createElement("link");e.href=c,e.rel="preload",e.as="script",e.onload=()=>{e.remove()},u.prepend(e)}const l=r.createElement("script");l.async=!1,l.defer=!1,l.src=c,l.type="text/javascript",t&&l.setAttribute("data-ext-id",t),n&&l.setAttribute("data-ext-version",n),s&&l.setAttribute("data-ext-minimal","true"),l.onload=()=>{null==o||o(),l.remove()},l.onerror=()=>{null==a||a()},u.prepend(l)}(t("src/js/Grammarly-externalEventsInjectedCs.js"),Q());const r=qi.map((t=>{const r=`external:${t}`;return Yi.call(document,r,(({detail:t})=>{n.trace("external event",{event:r,detail:t}),e.sendBackground(r,t)}))}));return{dispose:()=>{r.forEach((e=>e.off()))}}}}(Qi||(Qi={})),function(e){const t=Xt.create("Reports");async function n(n,r,i){try{const s=await Promise.race([n(),a(e.GET_DEBUG_REPORTS_TIEMOUT).then((()=>{Yn().debugReports.downloadTimeout(i,r),t.warn(`get ${r} logs timeout`)}))]);return s?(Yn().debugReports.downloadSuccessfuly(i,r),t.debug(`successfully get ${r} logs`),s.map((e=>({...e,loggerName:`${r}.${e.loggerName}`})))):void t.warn(`${r} logs is not defined`)}catch(e){return Yn().debugReports.downloadError(i,r),void t.warn(`fail to get ${r} logs`,e)}}function r(e){var t;const n=null===(t=self.document)||void 0===t?void 0:t.createElement("a");n.href="data:application/octet-stream,"+encodeURIComponent(function(e){const t=e=>{try{return JSON.stringify(e)}catch(t){return String(e)}};return[["Level","Logger","Timestamp","Message"].join("\t"),...e.map((e=>{const n=[e.level,e.loggerName,new Date(e.timestamp).toISOString(),e.message];return e.data&&n.push(t(e.data)),e.exception&&n.push(t(e.exception)),n.join("\t")}))].join("\n")}(e)),n.target="_blank",n.download="grammarly-logs.tsv",n.click()}async function i(i){if(t.debug("start download debug reports"),!ii().historyLogsService.isHistoryEnabled())return t.debug("debug reports feature is not enabled"),alert("Logging is not enabled");if(!self.confirm(e.CONSENT_TEXT))return;t.debug("confirm download debug reports");const o=ii().context,a=[],c=Object.keys(i).sort((e=>e===ii().context?1:-1));try{await(u=re,l=s(),Promise.race([d(u),l]))}catch(e){t.warn("cannot get latest app state",e)}var u,l;for(const e of c){const t=i[e];if(t){const r=await n(t,e,o);a.push(...null!=r?r:[])}}a.sort(((e,t)=>e.timestamp-t.timestamp)),r(a)}async function s(){t.info("latest experiments state",await ii().bgRpc.api.getExperimentTreatment()),t.info("latest storage state",await ii().browserApi.preferences.getAll())}e.CONSENT_TEXT='Click on "OK," will attempt to download a file with the information needed to investigate the issue you are experiencing. This archive may include domains you have recently visited and the text from the document you are typing in. To minimize the amount of sensitive information you share with us, we recommend that you (1) open a new browser window, (2) visit only the website where you can reproduce this issue, and (3) type in a document that includes only text you are comfortable sharing. For more details, see our Privacy Policy (https://www.grammarly.com/privacy-policy).',e.GET_DEBUG_REPORTS_TIEMOUT=ae(3),e.getDebugReportsByEnvContext=n,e.download=i,e.initKeyboradShortcutHandler=function(e){return er(self,"keydown").pipe(lt((e=>"KeyS"===e.code&&e.altKey&&e.shiftKey&&(e.ctrlKey||e.metaKey)))).subscribe((()=>{i(e)}))},e.logLatestState=s}(Zi||(Zi={})),function(e){let t;!function(e){e.disableOnTab="disableOnTab",e.reloadTab="reloadTab",e.showOnboardingDialog="showOnboardingDialog",e.hideGdocsSigninPopupMessage="hideGdocsSigninPopupMessage",e.sendCsLogsToPopup="sendCsLogsToPopup"}(t=e.Kind||(e.Kind={}))}(es||(es={})),function(e){let t;!function(e){e.sendCsLogs="sendCsLogs"}(t=e.Kind||(e.Kind={}))}(ts||(ts={})),function(e){function t(e){const t=()=>{e.bgRpc.api.sendToPopup({kind:ts.Kind.sendCsLogs,option:{logs:e.historyLogsService.getLogs(),isIframeIntegration:ne()}})};return e.message.on(es.Kind.sendCsLogsToPopup,t),{dispose(){e.message.off(es.Kind.sendCsLogsToPopup,t)}}}function n(e){const t=ne()?new Le:Zi.initKeyboradShortcutHandler({bg:()=>e.bgRpc.api.getBGLogs(),cs:()=>Promise.resolve(e.historyLogsService.getLogs())});return{dispose(){t.unsubscribe()}}}e.initSendLogsToPopupHandler=t,e.initKeyboradShortcutHandler=n,e.init=function(e){const r=t(e),i=n(e);return{dispose(){r.dispose(),i.dispose()}}}}(ns||(ns={}));var rs=n(47598);function is(e,t){const n=e.anchorNode;if(!n)return!1;const r=Vi.map((e=>Array.isArray(e)?`[${e[0]}="${e[1]}"]`:`[${e}]`)).join(","),i=t.activeElement,s=e.toString().trim(),o="TEXTAREA"!==n.tagName&&"INPUT"!==n.tagName,a=!i||"INPUT"!==i.tagName&&"TEXTAREA"!==i.tagName,c=!Ki(n),u=!zi(n,r)&&!Ji(n,r),l=!zi(n,"[contenteditable=true],[contenteditable=plaintext-only]")&&!function(e){let t=e.parentNode;for(;null!==t;){if(Ki(t))return t;t=t.parentNode}return!1}(n);return!!(s&&o&&a&&c&&u&&l)}var ss=function(){function e(e,t){this.dueTime=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new os(e,this.dueTime,this.scheduler))},e}(),os=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.dueTime=n,i.scheduler=r,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}return Ae(t,e),t.prototype._next=function(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(as,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var e=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}},t.prototype.clearDebounce=function(){var e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)},t}(De);function as(e){e.debouncedNext()}function cs(e,t){return"function"==typeof t?function(n){return n.pipe(cs((function(n,r){return Ar(e(n,r)).pipe(Xn((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new hs(e))}}var us,ls,ds,hs=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new ps(e,this.project))},e}(),ps=function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.index=0,r}return Ae(t,e),t.prototype._next=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this._innerSub(t)},t.prototype._innerSub=function(e){var t=this.innerSubscription;t&&t.unsubscribe();var n=new Rr(this),r=this.destination;r.add(n),this.innerSubscription=Fr(e,n),this.innerSubscription!==n&&r.add(this.innerSubscription)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(kr);!function(e){e.anonymous="anonymous",e.registered="registered",e.premium="premium"}(us||(us={})),function(e){function t(e){return!e.anonymous&&e.premium}function n(e){var t;return["BUSINESS","NGO","GOV"].includes((null===(t=e.institutionInfo)||void 0===t?void 0:t.organizationType)||"")}function r(e){return!!e.institutionInfo}function i(e){var t;return(null===(t=e.roles)||void 0===t?void 0:t.map((e=>e.type)).includes("WORKSPACE"))||!1}e.getType=function(e){return e.premium?us.premium:e.anonymous?us.anonymous:us.registered},e.isFree=function(e){return!e.anonymous&&!e.premium},e.isPremium=t,e.isFreeTrial=function(e){return!!(t(e)&&e.customFields&&e.customFields.frontend_premiumTrialEndDate)&&new Date<new Date(e.customFields.frontend_premiumTrialEndDate)},e.getUserRole=function(e,t){var n;return null===(n=e.roles)||void 0===n?void 0:n.find((e=>e.type===t))},e.isEdcBlocked=function(e){return!!e.edc&&!e.edc.compliant},e.isDocsDisabled=function(e){var t,n;return null!==(n=null===(t=e.editorFeatures)||void 0===t?void 0:t.docsDisabled)&&void 0!==n&&n},e.hasRole=function(e){return!!e.customFields&&(void 0!==e.customFields.frontend_role&&""!==e.customFields.frontend_role)},e.hasSoundFluentGoals=function(e){return!!e.customFields&&(void 0!==e.customFields.frontend_soundFluent&&""!==e.customFields.frontend_soundFluent)},e.hasPrimaryLanguage=function(e){return!!e.customFields&&(void 0!==e.customFields.frontend_primaryLanguage&&""!==e.customFields.frontend_primaryLanguage)},e.isBusinessAdmin=function(e){var t;return Boolean(n(e)&&(null===(t=null==e?void 0:e.institutionInfo)||void 0===t?void 0:t.admin))},e.doesUserBelongToBusinessInstitution=n,e.doesUserBelongToInstitution=r,e.doesUserBelongToEDUInstitution=function(e){var t;return"EDU"===(null===(t=e.institutionInfo)||void 0===t?void 0:t.organizationType)},e.doesUserBelongToNGOInstitution=function(e){var t;return"NGO"===(null===(t=e.institutionInfo)||void 0===t?void 0:t.organizationType)},e.doesUserBelongToWorkspace=i,e.doesUserBelongToInstitutionOrWorkspace=function(e){return r(e)||i(e)},e.isClaimed=function(e){return e.groups.includes("claimed-invitation")};e.isGrammarlyEmployee=function(e){var t;return e.email.endsWith("@grammarly.com")&&624392205===(null===(t=e.institutionInfo)||void 0===t?void 0:t.id)},e.isTestUser=function(e){return e.email.endsWith("@bh.exacttarget.com")},e.isConsumerUser=function(e){return!r(e)},e.defaultUser={anonymous:!0,groups:[],id:"",premium:!1,isTest:!1,settings:{},subscriptionFree:!1,type:"anonymous",email:"",registrationDate:(new Date).toString(),firstName:""}}(ls||(ls={})),function(e){e.empty="empty",e.local="local",e.server="server",e.localOverride="localOverride"}(ds||(ds={}));const fs={source:ds.local,version:"0",newRichTextFieldsEnabled:!0,fluidDisabledForFirefox:!1,fluidDisabledForSafari:!1,fullSentenceRewritesDisabled:!1,overrideKey:"dynamicConfigOverrideKey",ungatingRenewalNotificationEnabled:!1,quillJSCatchAllDisabled:!1};const gs=(e,t)=>{const n={getAll:async()=>await r.getAll(),get:async e=>await r.get(e),view:()=>{throw new Error("not_implemented")},patch:async e=>await r.set(e),changes:(r=e.browserApi.preferences).changes};var r;const i=Jt(Ar(n.changes).pipe(Ur(null),(o=200,void 0===a&&(a=sr),function(e){return e.lift(new ss(o,a))}),cs((()=>n.getAll()))),Ar(w(5,(s=2,re/s),(()=>e.bgRpc.api.getPageConfig(t,self.location.href))).catch((e=>null))).pipe(Ur(null)),((e,n)=>{var r,i,s,o,a,c;const u=null!==(i=null===(r=e.extensionSettings)||void 0===r?void 0:r[t])&&void 0!==i?i:{},l=(null===(s=null==u?void 0:u.enabled)||void 0===s||s)&&(null===(o=null==n?void 0:n.enabled)||void 0===o||o);return{user:null!==(a=e.user)&&void 0!==a?a:ls.defaultUser,settings:e.extensionSettings,dynamicConfig:null!==(c=e.dynamicConfig)&&void 0!==c?c:fs,dapi:e.dapi,enabled:l}}));var s,o,a;return{storeLite:n,viewStoreLite:i}};var ms=n(97924);const bs="grExtInstalled",_s="grExtDisabled";function vs(e){null===e&&"next"===document.body.dataset[_s]||(null===e?delete document.body.dataset[_s]:document.body.dataset[_s]=e)}class ys{constructor(e,t,n,r=Xt.create(ys.name)){this._csShareStorage=e,this._loadContentScript=t,this._log=r,this._pageEnable=!0,this._citationBuilderEnable=!1,this._enabledDefs=!1,this._isAnonymous=!0,this._wasLoaded=!1,this._isDesktopIntegrationEnable=!1,this._mutations=$i.createFlattenHot(self.document,{childList:!0,subtree:!0}),this._textFieldsObservable=Ti.createFocusObservable(self.document,this._mutations),this._subs=[this._textFieldsObservable.subscribe((e=>{const t=e.owner.frame||e.element,n=di.get(t);this._log.debug("detected click",{field:t,fieldType:n}),this._pageEnable&&(n.generic||n.specific)&&this.load()})),ys.clickObserver.subscribe((e=>{2===e.detail&&this._enabledDefs&&this._pageEnable&&!this._isAnonymous&&xs.isValid()&&(this._log.debug("dictionary event executed",e),this._csShareStorage.set("extensionDictionaryEvent",e),this._subs.push(xs.animation()),this.load())}))],n&&!ne()&&this.load()}load(){this._wasLoaded&&!this._isDesktopIntegrationEnable||(this._log.debug("load main content script"),this._wasLoaded=!0,Es.callExecuteContentScript(),this.dispose(),this._loadContentScript())}dispose(){this._subs.forEach((e=>e.unsubscribe()))}updateState(e,t,n,r,i){this._isDesktopIntegrationEnable=r,(!this._pageEnable&&t||!this._citationBuilderEnable&&i)&&this.load(),this._citationBuilderEnable=i,this._isAnonymous=e,this._pageEnable=t,this._enabledDefs=n,vs(this._pageEnable?null:"forever")}}var ws,xs,Es;function Ss(){return self.chrome&&self.chrome.runtime&&self.chrome.runtime.lastError}function Is(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function Ts(){return Is()+Is()+"-"+Is()+"-"+Is()+"-"+Is()+"-"+Is()+Is()+Is()}!function(e){e.clickObserver=er(self.document,"click",{capture:!0}),e.start=async function(t,n=!0,r,i=!1){Es.checkScriptInitStart();const s=En(),o=ui.init({...t,skipInitExtensionApi:n}),a=Xt.create("universal.check"),c=[],u=new e(o.csShareStorage,(()=>{(null!=r?r:o.bgRpc.api.loadContentScript)(),c.forEach((e=>e&&e.dispose()))}),i),l=Hi.init(),d=ws.init(o.browserApi,o.message,o.config,s),{viewStoreLite:h}=gs(o,s),p=v((e=>{Yn().sendFemetricsRate("checkScriptInitialized",{domain:Tn(),isExtensionEnabled:e,isIframe:ne()})})),f=h.subscribe((e=>{var t,n,r,i;a.debug("check script state is updated",e);const o=null===(t=e.settings)||void 0===t?void 0:t.common;u.updateState(null===(r=null===(n=e.user)||void 0===n?void 0:n.anonymous)||void 0===r||r,e.enabled,null!==(i=null==o?void 0:o.enabledDefs)&&void 0!==i&&i,ji.isIntegrationEnabled(o,s,e.dynamicConfig),Mi(s,e.dynamicConfig,o)),l.updateState(s,e.dynamicConfig,e.enabled,o),p(e.enabled)})),g=[u,d,l];o.message.once("contentScript-disconnected",(()=>{f.unsubscribe(),o.csShareStorage.clean(),g.forEach((e=>e&&e.dispose()))})),o.message.once(es.Kind.disableOnTab,(()=>{l.dispose()})),ns.initSendLogsToPopupHandler(o),c.push(ns.initKeyboradShortcutHandler(o)),Es.checkScriptInitEnd(o.bgRpc),(e=>{if(self.location.href.includes("grammarly.com/extension-success")){const t=document.getElementById("click-to-run");t&&(t.onclick=()=>{var t,n;confirm("Always allow Grammarly to run on every website")?(e.api.enableClickToRunOnAllWebsites(),null===(t=document.getElementById("click-to-run-success"))||void 0===t||t.click()):null===(n=document.getElementById("click-to-run-fail"))||void 0===n||n.click()})}})(o.bgRpc),a.debug("Check script initialized!")}}(ys||(ys={})),function(e){function t(e){or(10).pipe(lt((()=>!!document.body)),xr()).subscribe((()=>{document.body.dataset.newGrCSCheckLoaded=e.buildInfo.version,document.body.dataset[bs]=""}))}e.init=function(e,n,r,i){const s=[];return t(r),self.location.protocol===r.appConfig.url.grammarlyProtocol&&i.match(`^([a-z\\-0-9]+\\.)*${r.appConfig.url.grammarlyDomain}$`)&&s.push(Qi.init(n,e.getUrl)),{dispose:()=>{s.forEach((e=>e.dispose()))}}}}(ws||(ws={})),function(e){const t="important";function n(e){return String(e)+"px"}e.isValid=function(){const e=self.document.getSelection();return!(!e||e.toString().match(/[0-9_±!@#$%^&*:"|<>?~().,:}{’='-/ /]/))&&is(e,self.document)},e.animation=function(){const e=document.createElement("div"),r=e.attachShadow({mode:"open"}),i=document.createElement("style");i.innerHTML=ms.__css,r.appendChild(i);const s=self.document.getSelection().getRangeAt(0).getBoundingClientRect(),o=document.createElement("div");o.style.setProperty("top",n(s.top),t),o.style.setProperty("left",n(s.left),t),o.style.setProperty("height",n(s.height),t),o.style.setProperty("max-width",n(s.width),t),o.style.setProperty("z-index",li.toString(),t),o.classList.add(ms.animatedUnderline,ms.checkAnimatedUnderline),r.appendChild(o),document.body.appendChild(e);const a=or(10),c=Jt(ys.clickObserver.pipe(xr(),(u=!1,function(e){return e.lift(new Er(u))}),Ur(!0),jr()),a.pipe(Xn((()=>{const e="."+rs.completeAnimation;if(document.querySelector(e))return!0;const t=Array.from(document.querySelectorAll("grammarly-extension"));for(const n of t)if(n.shadowRoot&&n.shadowRoot.querySelector(e))return!0;return!1})),Ur(!1),jr())).pipe(lt((([e,t])=>!e||t)),jr()).subscribe(l);var u;return{unsubscribe:l};function l(){c.unsubscribe(),e.remove()}}}(xs||(xs={})),function(e){const t=Date.now(),n=e=>self.performance.mark("@grammarly-extension:"+e);e.callExecuteContentScript=()=>n("callExecuteContentScript"),e.checkScriptInitEnd=e=>{const r=Math.random()<.01;if(n("checkScriptInitEnd"),r){const n=Date.now();e.api.trackCall(ci,["sendFelogEvent",{ex_csInitPerf:{domain:self.location.host,initTime:n-t,pageLoadTime:n-self.performance.timing.responseEnd},hideUserInfo:!0,level:"INFO",logger:"checkScript.initialized"}])}},e.checkScriptInitStart=()=>n("checkScriptInitStart")}(Es||(Es={}));const As="%appName%",Rs={extensionSettingsToolbar:"%appName%SettingsToolbar",gdocsSidebarCardList:"%appName%AdvancedIssues",assistantCardList:"%appName%AdvancedIssues",extensionSettingsAssistant:"%appName%AssistantSettings",gdocsGoals:"%appName%AssistantGoals",extensionBusinessUphookPopup:"gb%appName%UphookPopup",gbExtensionSettingsToolbar:"gb%appName%SettingsToolbar",gbExtensionSettingsAssistant:"gb%appName%AssistantSettings",extensionGButton:"%appName%GButton",extPreviewsPopup:"%appName%PreviewsPopup",toneSuggestion:"%appName%ToneDetector"};function ks(e,t){return{key:e,value:t}}function Fs(e){const t=Rs[e];return t?t.replace(As,((e,t)=>{const n=T.getAppName(ee(),X().bundleInfo.extensionType,X().bundleInfo.deploymentType);return 0===t?n:(r=n).charAt(0).toUpperCase()+r.slice(1);var r})):e}function Os(e,t){return ks(e,t)}function Cs(e){return e.map((e=>[e.key,e.value].map(encodeURIComponent).join("="))).join("&")}function Ps(e,t){if(0===t.length)return e;const n=e.includes("?");return[e,Cs(t)].join(n?"&":"?")}function Ns(e){const t=[];return void 0!==e.medium&&t.push(Os("utm_medium",e.medium)),void 0!==e.source&&t.push(Os("utm_source",e.source)),void 0!==e.campaign&&t.push(Os("utm_campaign",Fs(e.campaign))),e.clickToRun&&t.push(Os("click_to_run","true")),t}function Ms(e){return Ns(e)}ks("fromExtension","true");Ns({medium:"internal"})[0];function Ls(e,t){return Ps(X().appConfig.url.planComparison,Ms({medium:"internal",source:e,campaign:t}))}function Us(e){const t=e.reduce(((e,t)=>{const n=e.get(t.category),r=t.group;return n?n.count++:e.set(t.category,{group:r,categoryHuman:t.categoryHuman,count:1}),e}),new Map);return Array.from(t.values()).sort(((e,t)=>t.count-e.count))}function js(e){const t=new Map;for(const{isFree:n,cardLayout:{group:r}}of e){t.has(r)||t.set(r,{lensName:r,free:0,premium:0});const e=t.get(r);e&&(e[n?"free":"premium"]+=1)}return Array.from(t.values()).sort(((e,t)=>t.premium-e.premium))}function Ds(e){return btoa(JSON.stringify(e))}const Bs="docs.google.com";function Hs(e,t){return(n,r)=>{return"extensionSettings"===n&&((i=r)&&"object"==typeof i&&"common"in i)?function(e,t,n){const r=e[Bs];if(!1!==(null==r?void 0:r.enabled)||(null==r?void 0:r.forcedEnabledDate_1639893688790))return n(),e;{const{disabledDate:n,...i}=r;return t(n),{...e,[Bs]:{...i,enabled:!0,forcedEnabledDate_1639893688790:Date.now()}}}}(r,e,t):r;var i}}function $s(e,t){chrome.runtime.lastError?t(chrome.runtime.lastError):e()}class Ws{constructor(){this._log=Xt.create("extension-api.managed-storage.validator")}validate(e,t){switch(e){case"GrammarlyEnrollmentToken":return"string"==typeof t&&t.length>0&&/^[a-z0-9_-]+$/i.test(t);case"GrammarlyBlockedClients":case"GrammarlyBlockedDomains":return"string"==typeof t;case"GrammarlyConfidentialModeEnabled":case"GrammarlyDlpEnabled":return"boolean"==typeof t;case"GrammarlyExtensionMode":return"string"==typeof t&&("limited"===t||"full"===t);default:return this._log.warn(`Unknown key: ${e}`),!1}}}class Vs{constructor(){this._log=Xt.create("extension-api.managed-storage.chrome"),this._validator=new Ws}get(e){return Wr.fromPromise(new Promise((t=>{chrome.storage.managed.get(e,(n=>{$s((()=>{const r=n[e];void 0===r||this._validator.validate(e,r)?t(r):(this._log.warn(`Invalid value for "${e}": ${JSON.stringify(n[e])}`),t(void 0))}),(n=>{this._log.error(`Could not get "${e}"`,n),t(void 0)}))}))})))}}const Gs="message:to-priv";var qs;!function(e){e[e.success=0]="success",e[e.successWithEmpty=1]="successWithEmpty",e[e.alreadyMigrated=2]="alreadyMigrated"}(qs||(qs={}));const zs=Xt.create("extension-api.message"),Ks=()=>`cs-bg-runtime-${Q()}`,Js=()=>{};class Ys{constructor(){this._listeners={},this._queue={},this.fire=(e,t,n=Js,r)=>{const i=this._listeners[e]||[];i.length?i.forEach((e=>e(t,n,r))):(this._queue[e]=this._queue[e]||[],this._queue[e].push({content:t,callback:n,sender:r}))},this.unlisten=(e,t)=>{const n=this._listeners[e]||[],r=n.indexOf(t);-1!==r&&(1===n.length?delete this._listeners[e]:n.splice(r,1))},this.listenOnce=(e,t)=>{const n=(r,i,s)=>{this.unlisten(e,n),t&&t(r,i,s)};this.listen(e,n)},this.listen=(e,t)=>{this._listeners[e]=this._listeners[e]||[],-1===this._listeners[e].indexOf(t)&&this._listeners[e].push(t);const n=this._queue[e]||[];if(n.length){for(const e of n)try{t(e.content,e.callback,e.sender)}catch(e){zs.error("exception during proccesing buffered messages",e)}delete this._queue[e]}}}}function Xs(e){return Number.isFinite(e)||e===Number.NEGATIVE_INFINITY||e===Number.POSITIVE_INFINITY}const Qs=Xt.create("extension-api.message.bg"),Zs="popup";function eo(e){const{browser:t,extensionType:n}=X().bundleInfo;if(!e)return"safariIOSWebExtension"===n||"safariWebExtension"===n;const r="firefox"===t?/^moz-extension:\/\/.*\/src\/popup.html$/:"safariWebExtension"===n||"safariIOSWebExtension"===n?/^safari-web-extension:\/\/.*\/src\/popup.html$/:"chrome"===t||"edge"===t?chrome&&chrome.runtime&&chrome.runtime.id?new RegExp(chrome.runtime.id+"/src/popup.html"):void 0:g(t);return void 0!==r&&r.test(e)}class to{constructor(e,t,n,r){this._getActiveTab=t,this._sendMessageToTab=n,this._getAllTabs=r,this.kind="background-message-api",this.topFrameId="0",this._callbacks={},this._tabPorts={popup:[],devtoolsPanel:[]},this._messageHelper=new Ys,this.toFocused=(e,t)=>Wr.fromPromise(this._getActiveTab().then((({id:n,url:r}={})=>{if(n)return eo(r)?Qs.warn(`toFocussed not allowed for popup when it open like regular tab ${e}`,t):void this._sendMessageToPorts({type:e,content:t,callid:Ts()},n)}))),this._initPortListener=e=>{if(e.name===Gs){const{sender:t}=e;if(t){if(t.tab){const{id:n,url:r}=t.tab;if(n){let t=this._tabPorts[n];void 0===t&&(t=this._tabPorts[n]=[]),t.push(e)}r&&0===r.indexOf("http")&&this._messageHelper.fire("tab-connected",{tab:n,url:r}),e.onDisconnect((()=>{if(!n)return;const t=this._tabPorts[n];t&&t.splice(t.indexOf(e),1)}))}const n=t.url?t.url:t.tab?t.tab.url:"",r=eo(n),i=function(e){const{browser:t}=X().bundleInfo;return e&&"chrome"===t&&chrome&&chrome.runtime&&chrome.runtime.id&&new RegExp(chrome.runtime.id+"/src/devtoolsPanel.html").test(e)}(n);if(r||i){const t=r?Zs:"devtoolsPanel";this._tabPorts[t]=this._tabPorts[t]||[],this._tabPorts[t].push(e),e.onDisconnect((()=>{const n=this._tabPorts[t];n.splice(n.indexOf(e),1)}))}}e.onMessage((n=>{const r=({callid:n,content:r,type:i})=>{this._callbacks[n]&&(this._callbacks[n](r),delete this._callbacks[n]);this._messageHelper.fire(i,r,(t=>e.postMessage({content:t,callid:n})),t&&t.tab?{tabId:String(t.tab.id),frameId:void 0===t.frameId?void 0:String(t.frameId)}:{tabId:Zs})};"tab-connected"===n.type?this._getActiveTab().then((({url:e}={})=>{n.content={tab:Zs,url:e},r(n)})):r(n)}))}},e(this._initPortListener)}async _findDestinationTab(e){return(await this._getAllTabs()).find((t=>String(t.id)===String(e)))}async _sendMessageToPorts(e,t,n){var r;try{const i=null===(r=this._tabPorts[t])||void 0===r?void 0:r.filter((e=>!Xs(n)||Xs(e.sender.frameId)&&e.sender.frameId===n));if(null==i?void 0:i.length)i.forEach((t=>t.postMessage(e)));else if(isNaN(Number(t)))Qs.warn(`tab with id ${t} couldn't be found and not valid to send a tab message`);else{const r=await this._findDestinationTab(t);if(!r||"complete"!==r.status)return;const i={type:Ks(),data:e};Qs.warn("no specified port on current destination"),this._sendMessageToTab(i,Number(t),n).catch((async e=>{const r=await this._findDestinationTab(t);throw{message:null==e?void 0:e.message,stack:null==e?void 0:e.stack,extra:{tabId:t,frameId:n,isOpen:!!r,status:null==r?void 0:r.status}}}))}}catch(r){Qs.error("send message to tab emit an error",r,{tabId:t,frameId:n,msg:e})}}getPortExists(e){return!!this._tabPorts[e]}sendTo(e,t,n,r){const{tabId:i,frameId:s=null}="object"==typeof e?e:{tabId:String(e)},o={type:t,content:n};r&&"function"==typeof r&&(o.callid=Ts(),this._callbacks[o.callid]=r),this._sendMessageToPorts(o,i,s?Number(s):void 0)}listen(e,t){this._messageHelper.listen(e,t)}}const no=Xt.create("Messaging.extension-api.content");class ro{constructor(e,t,n,r){this._bgIsWorking=t,this._extensionId=n,this._onRuntimeMessageFromBg=r,this.kind="content-script-message-api",this._callbacks={},this._messageHelper=new Ys,this._disconnected=!1,this.broadcastBackground=async(e,t,n)=>{var r,i;const s=Ts();n&&"function"==typeof n&&(this._callbacks[s]=n);try{if(!this.backgroundPort){if(!await this._bgIsWorking())throw new Error("lost connection to bg port");this.initPort(),no.trace("Content script connection was restored")}null===(r=this.backgroundPort)||void 0===r||r.postMessage({type:e,callid:s,content:t})}catch(n){if(!await this._bgIsWorking())return this._onDisconnect();try{this.initPort(),null===(i=this.backgroundPort)||void 0===i||i.postMessage({type:e,callid:s,content:t})}catch(n){throw no.error("failed to invoke postMessage() on bg port",n,{type:e,callid:s,content:t}),n}}},this._onRuntimeMessageHandler=async(e,t,n)=>{if(n({status:!0}),!await this._bgIsWorking())return this._onDisconnect();t.id!==this._extensionId&&e.type!==Ks()||(this._onBgPortMessage(e.data),this.initPort())},this._onBgPortMessage=({callid:e,content:t,type:n})=>{this._callbacks[e]?(this._callbacks[e](t),delete this._callbacks[e]):this._messageHelper.fire(n,t,(t=>{if(!this.backgroundPort)throw new Error("fail reply to bg page - connection lost");this.backgroundPort.postMessage({content:t,callid:e})}))},this._onDisconnect=async()=>{var e,t;if(null===(t=null===(e=this.backgroundPort)||void 0===e?void 0:e.removeMessageListeners)||void 0===t||t.call(e),this.backgroundPort=null,await this._bgIsWorking())return no.trace("BG SW is shutdown, but BG SW page is still available."),void this._messageHelper.fire("bgSW-shutdown",null);this._disconnected||(this._onRuntimeMessageFromBg.removeListener(this._onRuntimeMessageHandler),this._disconnected=!0,no.trace("Content script messaging went disconnected."),this._messageHelper.fire("contentScript-disconnected",null))},this._portInit=e,this.initPort(),this._onRuntimeMessageFromBg.addListener(this._onRuntimeMessageHandler)}initPort(){const e=this._portInit;this.backgroundPort||(this.backgroundPort=e(Gs),this.backgroundPort.onMessage(this._onBgPortMessage),this.backgroundPort.onDisconnect(this._onDisconnect))}listen(e,t){this._messageHelper.listen(e,t)}}class io{constructor(e,t){this.port=e.runtime.connect({name:t})}onMessage(e){this.port.onMessage.addListener(e)}onDisconnect(e){this.port.onDisconnect.addListener(e)}postMessage(e){this.port.postMessage(e)}}const so=e=>({get:t=>Wr.create(((n,r)=>e.storage.local.get(t,(e=>{$s((()=>n(e)),r)})))),set:t=>Wr.create(((n,r)=>e.storage.local.set(t,(()=>{$s(n,r)})))),getAll:()=>Wr.create(((t,n)=>e.storage.local.get(null,(e=>{$s((()=>t(e)),n)})))),remove:t=>Wr.create(((n,r)=>e.storage.local.remove(t,(()=>{$s(n,r)})))),removeAll:()=>Wr.create(((t,n)=>e.storage.local.clear((()=>{$s(t,n)}))))});class oo{constructor(e){this._chromeInstance=e,this.get=e=>Wr.create(((t,n)=>{this._chromeInstance.storage.session.get(e,(e=>{$s((()=>t(e)),n)}))})),this.set=e=>Wr.create(((t,n)=>{this._chromeInstance.storage.session.set(e,(()=>{$s(t,n)}))})),this.getAll=()=>Wr.create(((e,t)=>{this._chromeInstance.storage.session.get(null,(n=>{$s((()=>e(n)),t)}))})),this.remove=e=>Wr.create(((t,n)=>{this._chromeInstance.storage.session.remove(e,(()=>{$s(t,n)}))})),this.removeAll=()=>Wr.create(((e,t)=>{this._chromeInstance.storage.session.clear((()=>{$s(e,t)}))})),this.onChange=e=>{const t=()=>{this.getAll().then((t=>e(t)))};return this._chromeInstance.storage.session.onChanged.addListener(t),()=>this._chromeInstance.storage.session.onChanged.removeListener(t)}}}class ao{constructor(){this._data={},this._listeners=[],this.get=e=>Wr.sync((()=>(Array.isArray(e)?e:[e]).reduce(((e,t)=>({...e,[t]:this._data[t]})),{}))),this.set=e=>Wr.sync((()=>{this._data={...this._data,...e},this._callListeners()})),this.getAll=()=>Wr.sync((()=>this._data)),this.remove=e=>Wr.sync((()=>{(Array.isArray(e)?e:[e]).forEach((e=>{e in this._data&&delete this._data[e]})),this._callListeners()})),this.removeAll=()=>Wr.sync((()=>{this._data={},this._callListeners()})),this.onChange=e=>(this._listeners.push(e),()=>this._listeners.splice(this._listeners.indexOf(e),1))}_callListeners(){this._listeners.forEach((e=>e(this._data)))}}class co{constructor(e,t){this._chrome=e,this._manifestVersion=t,this.kind="web-extension",this.executeScript=(e,t,n)=>Wr.create(((r,i)=>{"3"!==this._manifestVersion?this._chrome.tabs.executeScript(t,{file:e,matchAboutBlank:!0,...n?{frameId:Number(n)}:{}},(e=>uo(null==e?void 0:e[0],r,i))):this._chrome.scripting.executeScript({files:[e],target:{tabId:t,...n?{frameIds:[Number(n)]}:{}}},(e=>{var t;return uo(null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.result,r,i)}))})),this.executeFunction=(e,t,n)=>Wr.create(((r,i)=>{"3"!==this._manifestVersion?this._chrome.tabs.executeScript(t,{code:`(${e.toString()})()`,matchAboutBlank:!0,...n?{frameId:Number(n)}:{}},(e=>uo(null==e?void 0:e[0],r,i))):this._chrome.scripting.executeScript({func:e,target:{tabId:t,...n?{frameIds:[Number(n)]}:{}}},(e=>{var t;return uo(null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.result,r,i)}))})),this.insertCSS=(e,t,n,r)=>Wr.create(((i,s)=>{"3"!==this._manifestVersion?this._chrome.tabs.insertCSS(e,{file:t,code:n,matchAboutBlank:!0,...r?{frameId:Number(r)}:{}},(()=>uo(void 0,i,s))):this._chrome.scripting.insertCSS({target:{tabId:e,...r?{frameIds:[Number(r)]}:{}},files:t?[t]:void 0,css:n},(()=>uo(void 0,i,s)))}))}open(e,t){return Wr.create(((n,r)=>{this._chrome.tabs.create({url:e,active:t},(e=>{$s((()=>n(e)),r)}))}))}updateCurrent(e){return Wr.create(((t,n)=>{this._chrome.tabs.update({url:e},(e=>{$s((()=>t(e)),n)}))}))}getActiveTab(){return Wr.create(((e,t)=>{const n=this._chrome.tabs;n.query({active:!0,lastFocusedWindow:!0},(r=>{$s((()=>{r&&r.length?e(r[0]):n.query({active:!0},(n=>{$s((()=>{e(n[0])}),t)}))}),t)}))}))}getAllTabs(){return Wr.create(((e,t)=>this._chrome.tabs.query({},(n=>$s((()=>e(n)),t)))))}getActiveTabUrl(){return Wr.create(((e,t)=>this.getActiveTab().then((n=>$s((()=>e(n&&n.url)),t)))))}onActiveTabChange(e,t){const n=n=>{$s((()=>{n&&e(n)}),(n=>{t(n),"Tabs cannot be edited right now (user may be dragging a tab)."===(null==n?void 0:n.message)&&setTimeout((()=>{this.getActiveTab().then((n=>{n&&$s((()=>e(n)),t)}))}),100)}))};this._chrome.tabs.onActivated.addListener((e=>this._chrome.tabs.get(e.tabId,(e=>n(e))))),this._chrome.tabs.onUpdated.addListener(((e,t)=>{this.getActiveTab().then((r=>{r&&r.id===e&&(t.url||t.favIconUrl||"complete"===t.status)&&this._chrome.tabs.get(e,(e=>n(e)))}))})),this._chrome.windows.onFocusChanged.addListener((e=>this._chrome.tabs.query({active:!0,windowId:e,lastFocusedWindow:!0},(e=>n(e[0]))))),this.getActiveTab().then((e=>n(e)))}reload(e){return Wr.create(((t,n)=>{const r=()=>$s((()=>t()),n);e.id?this._chrome.tabs.reload(e.id,{},r):this._chrome.tabs.reload(r)}))}focusTab(e){return Wr.create(((t,n)=>{this._chrome.tabs.update(e,{highlighted:!0},(()=>{$s((()=>t()),n)}))}))}sendMessageToTab(e,t,n){return Wr.create(((r,i)=>{this._chrome.tabs.sendMessage(t,e,{frameId:n},(()=>{$s((()=>r()),i)}))}))}}function uo(e,t,n){Ss()?n(Ss()):t(e)}var lo,ho,po=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new fo(e,this.notifier))},e}(),fo=function(e){function t(t,n){var r=e.call(this,t)||this;r.hasValue=!1;var i=new Rr(r);r.add(i),r.innerSubscription=i;var s=Fr(n,i);return s!==i&&(r.add(s),r.innerSubscription=s),r}return Ae(t,e),t.prototype._next=function(t){this.hasValue&&e.prototype._next.call(this,t)},t.prototype.notifyNext=function(){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()},t.prototype.notifyComplete=function(){},t}(kr);!function(e){e[e.nonEmptyMigration=0]="nonEmptyMigration",e[e.emptyMigration=1]="emptyMigration"}(lo||(lo={}));class go{constructor(e,t,n,r=[],i=((e,t,n)=>t)){this._name=e,this._source=t,this._destination=n,this._destValuesToKeep=r,this._valuesMapper=i,this._migrationFlagSuccessfulValue="ok",this._migrationFlagKey=`__migration-${go.migrationFlagUniqueKey}:(${this._name})`,this._migrationInProgress=!1,this.migrationAwareDestination=function(e,t){const{get:n,set:r,getAll:i,remove:s}=Se(e);return{get:n,set:r,getAll:i,remove:s,removeAll:Wr.fromAsync((async()=>{const n=await e.getAll();await e.removeAll(),await e.set(ue(t,n))})),changes:e.changes,dispose:()=>{}}}(this._destination,(e=>e===this._migrationFlagKey))}async _getMigrated(){return(await this._destination.get(this._migrationFlagKey))[this._migrationFlagKey]===this._migrationFlagSuccessfulValue}async _setMigrated(){await this._destination.set({[this._migrationFlagKey]:this._migrationFlagSuccessfulValue});const e=await this._destination.get(this._migrationFlagKey);if(e[this._migrationFlagKey]!==this._migrationFlagSuccessfulValue)throw new Error(`Could not verify status write, actual value: ${e}`)}async _runMigration(){S(!this._migrationInProgress,"migration already in progress"),this._migrationInProgress=!0;try{const e=await this._source.getAll(),t=ue(((e,t)=>void 0!==t),function(e,t){const n={};return Object.keys(t).forEach((r=>n[r]=e(r,t[r]))),n}(((t,n)=>this._valuesMapper(t,n,e)),e)),n=0===Object.keys(t).length,r=await this._destination.get(this._destValuesToKeep),i={...t,...r};if(await this._destination.removeAll(),await this._destination.set(i),!h(i,await this._destination.getAll()))throw new Error("Could not verify write");return this._migrationInProgress=!1,n?lo.emptyMigration:lo.nonEmptyMigration}catch(e){throw this._migrationInProgress=!1,e}}async ensureMigrationCompleted(){if(await this._getMigrated())return qs.alreadyMigrated;{const e=await this._runMigration();switch(await this._setMigrated(),e){case lo.nonEmptyMigration:return qs.success;case lo.emptyMigration:return qs.successWithEmpty;default:throw new Error(`Match not exhaustive: ${e}`)}}}}go.migrationFlagUniqueKey="104ccd8c-9919-9ae4-931f-782fb197486c",function(e){e.MigrationAwarePreferencesApiImpl=class{constructor(e,t,n,r=[],i){var s;this._source=t,this._destination=n,this._migrationCompleted=Wr.createCompletionSource(),this._ensureMigrationCompletedCalled=!1,this.get=this._getMigrationAwareMethod("get"),this.set=this._getMigrationAwareMethod("set"),this.getAll=this._getMigrationAwareMethod("getAll"),this.remove=this._getMigrationAwareMethod("remove"),this.removeAll=this._getMigrationAwareMethod("removeAll"),this._migration=new go(e,t,n,r,i),this.changes=Ar(n.changes).pipe((s=Ar(this._migrationCompleted.promise),function(e){return e.lift(new po(s))}))}dispose(){var e,t,n,r;null===(t=(e=this._source).dispose)||void 0===t||t.call(e),null===(r=(n=this._destination).dispose)||void 0===r||r.call(n)}ensureMigrationCompleted(){return this._ensureMigrationCompletedCalled=!0,Wr.fromPromise(this._migration.ensureMigrationCompleted().then((e=>{var t,n;return null===(n=(t=this._source).dispose)||void 0===n||n.call(t),this._migrationCompleted.resolve(!0),Promise.resolve(e)}),(e=>(this._migrationCompleted.resolve(!1),Promise.reject(e)))))}_getMigrationAwareMethod(e){return(...t)=>(S(!0===this._ensureMigrationCompletedCalled,"supposed to run data migration before accessing prefs with web-extensions API"),Wr.fromPromise(this._migrationCompleted.promise.then((n=>(n?this._migration.migrationAwareDestination:this._source)[e](...t)))))}},e.mapValueFromString=e=>{if("undefined"!==e)try{return e&&JSON.parse(e)}catch(t){return null!=e?e:void 0}},e.mapValueToString=e=>void 0===e?"undefined":JSON.stringify(e)}(ho||(ho={}));class mo{constructor(e){this._port=e,this.sender={};const{sender:t,name:n}=e;this.name=n,t&&(this.sender.url=t.url,this.sender.frameId=t.frameId,t.tab&&t.tab.url&&t.tab.id&&(this.sender.tab={url:t.tab.url,id:t.tab.id}))}onMessage(e){this._port.onMessage.addListener(e)}onDisconnect(e){this._port.onDisconnect.addListener(e)}postMessage(e){this._port.postMessage(e)}}class bo{get button(){const e=this._action;return{kind:"web-extension",setBadge(t){e.setBadgeText({text:t})},setIconByName(t,n){const r="./src/icon/icon",i=t?"-"+t:"standWithUkraine"===n.logo?"ua":"";e.setIcon({path:{16:`${r}16${i}.png`,32:`${r}32${i}.png`}})},setBadgeBackgroundColor(t){e.setBadgeBackgroundColor({color:t})}}}get baseUri(){var e;return null!==(e=this._baseUrl)&&void 0!==e?e:chrome.runtime.getURL("")}constructor(e){var t,n;this._isBg=e,this._manifestVersion="3",this._isManifestV3="3"===this._manifestVersion,this._action=this._isManifestV3?chrome.action:chrome.browserAction,this.managedStorage=new Vs,this.sessionStorage=this._isManifestV3&&(null===(t=chrome.storage)||void 0===t?void 0:t.session)?new oo(chrome):new ao,this.tabs=new co(chrome,this._manifestVersion),this.thirdPartyExtensionsInstalled={},this.notification={kind:"web-extension",create:e=>Wr.create(((t,n)=>{const r=chrome.notifications,i=Ts();r.create(i,Object.assign({type:"basic"},e),(()=>{$s((()=>{const e=new Ve((e=>{const t=t=>t===i&&e.next(t);return r.onClicked.addListener(t),()=>r.onClicked.removeListener(t)})),n=new Ve((e=>{const t=(t,n)=>t===i&&e.next({id:t,buttonIndex:n});return r.onButtonClicked.addListener(t),()=>r.onButtonClicked.removeListener(t)})),s=new Ve((e=>{const t=(t,n)=>t===i&&e.next({id:t,byUser:n});return r.onClosed.addListener(t),()=>r.onClosed.removeListener(t)}));t({id:i,click:e,buttonClick:n,close:s})}),n)}))})),clear:e=>Wr.create(((t,n)=>{chrome.notifications.clear(e,(e=>{$s((()=>t(e)),n)}))}))},this.cookies={kind:"web-extension",get:e=>Wr.create(((t,n)=>chrome.cookies.get(e,(e=>$s((()=>t(e)),n))))),remove:e=>Wr.fromPromise(new Promise(((t,n)=>chrome.cookies.remove(e,(()=>$s((()=>t(null)),n)))))),getAll:e=>Wr.create(((t,n)=>chrome.cookies.getAll(e,(e=>$s((()=>t(e)),n))))),set:e=>Wr.create(((t,n)=>chrome.cookies.set(e,(e=>$s((()=>t(e)),n))))),watch(e,t){const n=n=>{const{cookie:r,cause:i}=n;!r||!r.name||e.path&&e.path!==r.path||e.name!==r.name||e.domain&&-1===r.domain.indexOf(e.domain)||("explicit"===i&&t(r),"expired_overwrite"===i&&t())};return chrome.cookies.onChanged.addListener(n),()=>chrome.cookies.onChanged.removeListener(n)},getChanges(e){return new Ve((t=>this.watch(e,(e=>t.next(e)))))}},this._prefsBeforeMigration=function(){var e;const t=new Je;return null===(e=chrome.storage)||void 0===e||e.onChanged.addListener(((e,n)=>{"local"===n&&t.next(e)})),{...so(chrome),changes:t}}(),this.preferences=this._isBg?new ho.MigrationAwarePreferencesApiImpl("chromeGdocsForceEnableMigration",this._prefsBeforeMigration,this._prefsBeforeMigration,void 0,Hs((e=>Yn().gdocs.disabledBeforeForceEnable(e)),(()=>Yn().gdocs.enabledBeforeForceEnable()))):this._prefsBeforeMigration,this.management={uninstallSelf(){chrome.management.uninstallSelf()}},this._baseUrl=b((()=>chrome.runtime.getURL("")),(e=>null)),this.permissions=chrome.permissions?{watchAdded:e=>{chrome.permissions.onAdded.addListener(e)},added:new Ve((e=>{const t=t=>{e.next(t)};return chrome.permissions.onAdded.addListener(t),()=>{chrome.permissions.onAdded.removeListener(t)}})),watchRemoved:e=>{chrome.permissions.onRemoved.addListener(e)},removed:new Ve((e=>{const t=t=>{e.next(t)};return chrome.permissions.onRemoved.addListener(t),()=>{chrome.permissions.onRemoved.removeListener(t)}})),getAll:Wr.fromAsync((()=>new Promise((e=>chrome.permissions.getAll(e))))),request:Wr.fromAsync((e=>new Promise(((t,n)=>chrome.permissions.request(e,(e=>{chrome.runtime.lastError?n(chrome.runtime.lastError):t(e)})))))),contains:Wr.fromAsync((e=>new Promise(((t,n)=>{chrome.permissions.contains(e,(e=>{chrome.runtime.lastError?n(chrome.runtime.lastError):t(e)}))}))))}:void 0,this.fetchBlocklistConfig=()=>Wr.noop,this.getUrl=e=>this._baseUrl?this._baseUrl+e:chrome.runtime.getURL(e),this.fetchInternalResource=(e,t)=>Wr.fromPromise(fetch(this.getUrl(e)).then((e=>"json"===t?e.json():e.arrayBuffer()))),this.openUrl=e=>this.tabs.open(e,!0),this.openPopupSubscriptionDialog=e=>this.openUrl(Ls(e.utmSource,e.utmCampaign)),this.openSubscriptionDialog=e=>function(e){const t=X().appConfig.url;self.open(Ps(t.planComparison,[...e.isFromEmail?[ks("isFromEmail","1")]:[],ks("alerts",Ds(Us(e.currentAlerts))),ks("lensedAlerts",Ds(js(e.currentAlerts))),ks("app_type","popup"),ks("browser",ee()),...Ms({medium:"internal",source:e.isAnonymousUser?"signupHook":"upHook",campaign:e.forceUtmCampaign?e.forceUtmCampaign:e.isAnonymousUser?"extensionPremiumCta":"extensionGButton"})]))}(e),this.isExtensionUrl=(e,t)=>this.getUrl(e)===t,this.reload=()=>chrome.runtime.reload(),this.i18n={detectLanguage:e=>Wr.create(((t,n)=>chrome.i18n.detectLanguage(e,(e=>$s((()=>t(e)),n))))),getUILanguage:()=>chrome.i18n.getUILanguage(),getAcceptLanguages:()=>Wr.create(((e,t)=>chrome.i18n.getAcceptLanguages((n=>$s((()=>e(n)),t)))))},this.initCodeSplittingListener=()=>{return chrome.runtime.onMessage.addListener((e=this.tabs.executeScript,(t,n,r)=>{t&&"CODE_SPLITTING_INJECT"===t.type&&t.file&&n&&n.tab&&null!=n.tab.id&&(e(t.file,Number(n.tab.id),n.frameId),r())}));var e},this.isExtensionInstalled=Wr.fromAsync((async(e,t=!1)=>{if(!t&&void 0!==this.thirdPartyExtensionsInstalled[e])return this.thirdPartyExtensionsInstalled[e];if("undefined"==typeof fetch)return!1;const n=bo.thirdPartyExtensionsData[e].publicResources.reduce(((t,n)=>(Z()&&t.push(`chrome-extension://${bo.thirdPartyExtensionsData[e].MSStoreId}${n}`),t.concat(`chrome-extension://${bo.thirdPartyExtensionsData[e].id}${n}`))),[]);return(r=n.map((e=>fetch(e))),u(Promise.all([...r].map(u)))).then((e=>!0)).catch((e=>!1));var r})),this.setUninstallURL=e=>chrome.runtime.setUninstallURL(e),this.message=e?new to((e=>chrome.runtime.onConnect.addListener((t=>e(new mo(t))))),Se(this.tabs).getActiveTab,Se(this.tabs).sendMessageToTab,Se(this.tabs).getAllTabs):new ro((e=>new io(chrome,e)),(n=()=>this.preferences.getAll(),async()=>{try{return await n(),!0}catch(e){return!1}}),chrome.runtime.id,chrome.runtime.onMessage)}}bo.thirdPartyExtensionsData={mseditor:{id:"gpaiobkfhnonedkhhfjpmhdalgeoebfa",MSStoreId:"hokifickgkhplphjiodbggjmoafhignh",publicResources:["/fonts/fabric-icons.css"]},office:{id:"ndjpnladcallmjemlbaebfadecfhkepb",MSStoreId:"gggmmkjegpiggikcnhidnjjhmicpibll",publicResources:["/fonts/fabric-icons.css"]}},ys.start({browser:"chrome",extensionType:"chromiumWebExtension",deploymentType:"regular",browserApi:function(e){return new bo(e)}(!1)})})();